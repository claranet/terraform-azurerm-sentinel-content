{
    "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
    "contentVersion": "1.0.0.0",
    "parameters": {
        "location": {
            "type": "String",
            "minLength": 1,
            "defaultValue": "[resourceGroup().location]",
            "metadata": {
                "description": "Not used, but needed to pass arm-ttk test `Location-Should-Not-Be-Hardcoded`.  We instead use the `workspace-location` which is derived from the LA workspace"
            }
        },
        "workspace-location": {
            "type": "String",
            "defaultValue": "",
            "metadata": {
                "description": "[concat('Region to deploy solution resources -- separate from location selection',parameters('location'))]"
            }
        },
        "workspace": {
            "defaultValue": "",
            "type": "String",
            "metadata": {
                "description": "Workspace name for Log Analytics where Microsoft Sentinel is setup"
            }
        },
        "resourceGroupName": {
            "type": "String",
            "defaultValue": "[resourceGroup().name]",
            "metadata": {
                "description": "resource group name where Microsoft Sentinel is setup"
            }
        },
        "subscription": {
            "type": "String",
            "defaultValue": "[last(split(subscription().id, '/'))]",
            "metadata": {
                "description": "subscription id where Microsoft Sentinel is setup"
            }
        }
    },
    "resources": [
        {
            "name": "pid-de7b62cd-dc4b-44e8-ba88-e15abade5b01-partnercenter",
            "type": "Microsoft.Resources/deployments",
            "apiVersion": "2020-10-01",
            "properties": {
                "mode": "Incremental",
                "template": {
                    "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
                    "contentVersion": "1.0.0.0",
                    "resources": []
                }
            }
        },
        {
            "type": "Microsoft.OperationalInsights/workspaces/providers/contentTemplates",
            "apiVersion": "2023-04-01-preview",
            "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/', concat(parameters('workspace'),'-dc-',uniquestring('SentinelOneCCP')), '1.0.0')]",
            "location": "[parameters('workspace-location')]",
            "dependsOn": [
                "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/contentPackages', 'azuresentinel.azure-sentinel-solution-sentinelone')]"
            ],
            "properties": {
                "contentId": "SentinelOneCCP",
                "displayName": "SentinelOne",
                "contentKind": "DataConnector",
                "mainTemplate": {
                    "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
                    "contentVersion": "1.0.0",
                    "parameters": {},
                    "variables": {},
                    "resources": [
                        {
                            "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/','SentinelOneCCP')]",
                            "apiVersion": "2022-09-01-preview",
                            "type": "Microsoft.OperationalInsights/workspaces/providers/dataConnectorDefinitions",
                            "location": "[parameters('workspace-location')]",
                            "kind": "Customizable",
                            "properties": {
                                "connectorUiConfig": {
                                    "id": "SentinelOneCCP",
                                    "title": "SentinelOne",
                                    "publisher": "Microsoft",
                                    "descriptionMarkdown": "The [SentinelOne](https://usea1-nessat.sentinelone.net/api-doc/overview) data connector allows ingesting logs from the SentinelOne API into Microsoft Sentinel. The data connector is built on Microsoft Sentinel Codeless Connector Platform. It uses the SentinelOne API to fetch logs and it supports DCR-based [ingestion time transformations](https://docs.microsoft.com/azure/azure-monitor/logs/custom-logs-overview) that parses the received security data into a custom table so that queries don't need to parse it again, thus resulting in better performance.",
                                    "graphQueries": [
                                        {
                                            "metricName": "Total activities logs received",
                                            "legend": "SentinelOne Activities Logs",
                                            "baseQuery": "SentinelOneActivities_CL"
                                        },
                                        {
                                            "metricName": "Total agents logs received",
                                            "legend": "SentinelOne Agents Logs",
                                            "baseQuery": "SentinelOneAgents_CL"
                                        },
                                        {
                                            "metricName": "Total groups logs received",
                                            "legend": "SentinelOne Groups Logs",
                                            "baseQuery": "SentinelOneGroups_CL"
                                        },
                                        {
                                            "metricName": "Total threats logs received",
                                            "legend": "SentinelOne Threats Logs",
                                            "baseQuery": "SentinelOneThreats_CL"
                                        },
                                        {
                                            "metricName": "Total alerts logs received",
                                            "legend": "SentinelOne Alerts Logs",
                                            "baseQuery": "SentinelOneAlerts_CL"
                                        }
                                    ],
                                    "sampleQueries": [
                                        {
                                            "description": "Get Sample of SentinelOne activities logs",
                                            "query": "SentinelOneActivities_CL| take 10"
                                        },
                                        {
                                            "description": "Get Sample of SentinelOne groups logs",
                                            "query": "SentinelOneGroups_CL| take 10"
                                        },
                                        {
                                            "description": "Get Sample of SentinelOne threats logs",
                                            "query": "SentinelOneThreats_CL| take 10"
                                        },
                                        {
                                            "description": "Get Sample of SentinelOne agents logs",
                                            "query": "SentinelOneAgents_CL| take 10"
                                        },
                                        {
                                            "description": "Get Sample of SentinelOne alerts logs",
                                            "query": "SentinelOneAlerts_CL| take 10"
                                        }
                                    ],
                                    "dataTypes": [
                                        {
                                            "name": "SentinelOneActivities_CL",
                                            "lastDataReceivedQuery": "SentinelOneActivities_CL\n       | where TimeGenerated > ago(12h)                | summarize Time = max(TimeGenerated)\n            | where isnotempty(Time)"
                                        },
                                        {
                                            "name": "SentinelOneAgents_CL",
                                            "lastDataReceivedQuery": "SentinelOneAgents_CL\n       | where TimeGenerated > ago(12h)                | summarize Time = max(TimeGenerated)\n            | where isnotempty(Time)"
                                        },
                                        {
                                            "name": "SentinelOneGroups_CL",
                                            "lastDataReceivedQuery": "SentinelOneGroups_CL\n       | where TimeGenerated > ago(12h)                | summarize Time = max(TimeGenerated)\n            | where isnotempty(Time)"
                                        },
                                        {
                                            "name": "SentinelOneThreats_CL",
                                            "lastDataReceivedQuery": "SentinelOneThreats_CL\n       | where TimeGenerated > ago(12h)                | summarize Time = max(TimeGenerated)\n            | where isnotempty(Time)"
                                        },
                                        {
                                            "name": "SentinelOneAlerts_CL",
                                            "lastDataReceivedQuery": "SentinelOneAlerts_CL\n       | where TimeGenerated > ago(12h)                | summarize Time = max(TimeGenerated)\n            | where isnotempty(Time)"
                                        }
                                    ],
                                    "connectivityCriteria": [
                                        {
                                            "type": "HasDataConnectors",
                                            "value": null
                                        }
                                    ],
                                    "availability": {
                                        "status": 1,
                                        "isPreview": false
                                    },
                                    "permissions": {
                                        "resourceProvider": [
                                            {
                                                "provider": "Microsoft.OperationalInsights/workspaces",
                                                "permissionsDisplayText": "Read and Write permissions are required.",
                                                "providerDisplayName": "Workspace",
                                                "scope": "Workspace",
                                                "requiredPermissions": {
                                                    "read": true,
                                                    "write": true,
                                                    "delete": true,
                                                    "action": false
                                                }
                                            }
                                        ]
                                    },
                                    "instructionSteps": [
                                        {
                                            "instructions": [
                                                {
                                                    "type": "Markdown",
                                                    "parameters": {
                                                        "content": "#### Configuration steps for the SentinelOne API \n Follow the instructions to obtain the credentials. You can also follow the [guide](https://usea1-nessat.sentinelone.net/docs/en/how-to-automate-api-token-generation.html#how-to-automate-api-token-generation) to generate API key."
                                                    }
                                                },
                                                {
                                                    "type": "Markdown",
                                                    "parameters": {
                                                        "content": "#### 1. Retrieve SentinelOne Management URL\n   1.1. Log in to the SentinelOne [**Management Console**] with Admin user credentials\n   1.2. In the [**Management Console**] copy the URL link above without the URL path."
                                                    }
                                                },
                                                {
                                                    "type": "Markdown",
                                                    "parameters": {
                                                        "content": "#### 2. Retrieve API Token\n   2.1. Log in to the SentinelOne [**Management Console**] with Admin user credentials\n 2.2. In the [**Management Console**], click [**Settings**]\n  2.3. In [**Settings**] view click on [**USERS**].\n   2.4. In the [**USERS**] Page click on [**Service Users**] -> [**Actions**] -> [**Create new service user**].\n   2.5. Choose [**Expiration date**] and [**scope**] (by site) and click on [**Create User**].\n   2.6. Once the [**Service User**] is created copy the [**API Token**] from page and press [**Save**]"
                                                    }
                                                },
                                                {
                                                    "parameters": {
                                                        "label": "SentinelOne Management URL",
                                                        "placeholder": "https://example.sentinelone.net/",
                                                        "type": "text",
                                                        "name": "managementUrl"
                                                    },
                                                    "type": "Textbox"
                                                },
                                                {
                                                    "parameters": {
                                                        "label": "API Token",
                                                        "placeholder": "API Token",
                                                        "type": "securestring",
                                                        "name": "apitoken"
                                                    },
                                                    "type": "Textbox"
                                                },
                                                {
                                                    "parameters": {
                                                        "label": "toggle",
                                                        "name": "toggle"
                                                    },
                                                    "type": "ConnectionToggleButton"
                                                }
                                            ]
                                        }
                                    ],
                                    "isConnectivityCriteriasMatchSome": false
                                }
                            }
                        },
                        {
                            "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('DataConnector-', 'SentinelOneCCP'))]",
                            "apiVersion": "2022-01-01-preview",
                            "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
                            "properties": {
                                "parentId": "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/dataConnectorDefinitions', 'SentinelOneCCP')]",
                                "contentId": "SentinelOneCCP",
                                "kind": "DataConnector",
                                "version": "1.0.0",
                                "source": {
                                    "sourceId": "azuresentinel.azure-sentinel-solution-sentinelone",
                                    "name": "SentinelOne",
                                    "kind": "Solution"
                                },
                                "author": {
                                    "name": "Microsoft",
                                    "email": "support@microsoft.com"
                                },
                                "support": {
                                    "name": "Microsoft Corporation",
                                    "email": "support@microsoft.com",
                                    "tier": "Microsoft",
                                    "link": "https://support.microsoft.com"
                                },
                                "dependencies": {
                                    "criteria": [
                                        {
                                            "version": "1.0.0",
                                            "contentId": "SentinelOneCCPConnections",
                                            "kind": "ResourcesDataConnector"
                                        }
                                    ]
                                }
                            }
                        },
                        {
                            "name": "SentinelOneActivitiesDCR",
                            "apiVersion": "2022-06-01",
                            "type": "Microsoft.Insights/dataCollectionRules",
                            "location": "[parameters('workspace-location')]",
                            "kind": "[replace('b', 'b', '')]",
                            "properties": {
                                "streamDeclarations": {
                                    "Custom-SentinelOneActivities_API": {
                                        "columns": [
                                            {
                                                "name": "agentUpdatedVersion",
                                                "type": "string",
                                                "description": "The version of the agent that was updated."
                                            },
                                            {
                                                "name": "userId",
                                                "type": "string",
                                                "description": "The unique identifier for the user."
                                            },
                                            {
                                                "name": "threatId",
                                                "type": "string",
                                                "description": "The unique identifier for the threat."
                                            },
                                            {
                                                "name": "primaryDescription",
                                                "type": "string",
                                                "description": "The primary description of the event."
                                            },
                                            {
                                                "name": "secondaryDescription",
                                                "type": "string",
                                                "description": "The secondary description of the event."
                                            },
                                            {
                                                "name": "id",
                                                "type": "string",
                                                "description": "The unique identifier for the record."
                                            },
                                            {
                                                "name": "groupId",
                                                "type": "string",
                                                "description": "The unique identifier for the group."
                                            },
                                            {
                                                "name": "createdAt",
                                                "type": "datetime",
                                                "description": "The timestamp (UTC) when the record was created."
                                            },
                                            {
                                                "name": "accountName",
                                                "type": "string",
                                                "description": "The name of the account associated with the event."
                                            },
                                            {
                                                "name": "data",
                                                "type": "string",
                                                "description": "Activity metadata."
                                            },
                                            {
                                                "name": "agentId",
                                                "type": "string",
                                                "description": "The unique identifier for the agent."
                                            },
                                            {
                                                "name": "hash",
                                                "type": "string",
                                                "description": "The hash associated with the event."
                                            },
                                            {
                                                "name": "updatedAt",
                                                "type": "string",
                                                "description": "The timestamp (UTC) when the record was last updated."
                                            },
                                            {
                                                "name": "description",
                                                "type": "string",
                                                "description": "The description of the event."
                                            },
                                            {
                                                "name": "activityUuid",
                                                "type": "string",
                                                "description": "The UUID of the activity associated with the event."
                                            },
                                            {
                                                "name": "siteId",
                                                "type": "string",
                                                "description": "The unique identifier for the site."
                                            },
                                            {
                                                "name": "activityType",
                                                "type": "real",
                                                "description": "The type of activity represented by an integer."
                                            },
                                            {
                                                "name": "siteName",
                                                "type": "string",
                                                "description": "The name of the site associated with the event."
                                            },
                                            {
                                                "name": "accountId",
                                                "type": "string",
                                                "description": "The unique identifier for the account."
                                            },
                                            {
                                                "name": "osFamily",
                                                "type": "string",
                                                "description": "The operating system family, such as macOS."
                                            },
                                            {
                                                "name": "groupName",
                                                "type": "string",
                                                "description": "The name of the group associated with the event."
                                            },
                                            {
                                                "name": "comments",
                                                "type": "string",
                                                "description": "Any comments associated with the event."
                                            }
                                        ]
                                    },
                                    "Custom-SentinelOneAgents_API": {
                                        "columns": [
                                            {
                                                "name": "uuid",
                                                "type": "string",
                                                "description": "The unique identifier for the object."
                                            },
                                            {
                                                "name": "mitigationMode",
                                                "type": "string",
                                                "description": "The mitigation mode applied."
                                            },
                                            {
                                                "name": "networkStatus",
                                                "type": "string",
                                                "description": "The network status of the object."
                                            },
                                            {
                                                "name": "installerType",
                                                "type": "string",
                                                "description": "The type of installer used."
                                            },
                                            {
                                                "name": "mitigationModeSuspicious",
                                                "type": "string",
                                                "description": "The suspicious mitigation mode applied."
                                            },
                                            {
                                                "name": "isPendingUninstall",
                                                "type": "boolean",
                                                "description": "Indicates whether the object is pending uninstallation."
                                            },
                                            {
                                                "name": "inRemoteShellSession",
                                                "type": "boolean",
                                                "description": "Indicates whether the object is in a remote shell session."
                                            },
                                            {
                                                "name": "lastLoggedInUserName",
                                                "type": "string",
                                                "description": "The username of the last logged-in user."
                                            },
                                            {
                                                "name": "osRevision",
                                                "type": "string",
                                                "description": "The OS revision."
                                            },
                                            {
                                                "name": "osArch",
                                                "type": "string",
                                                "description": "The OS architecture."
                                            },
                                            {
                                                "name": "id",
                                                "type": "string",
                                                "description": "The unique identifier for the object."
                                            },
                                            {
                                                "name": "computerName",
                                                "type": "string",
                                                "description": "The name of the computer."
                                            },
                                            {
                                                "name": "totalMemory",
                                                "type": "real",
                                                "description": "The total memory available in MB."
                                            },
                                            {
                                                "name": "createdAt",
                                                "type": "datetime",
                                                "description": "The timestamp (UTC) when the object was created."
                                            },
                                            {
                                                "name": "groupId",
                                                "type": "string",
                                                "description": "The unique identifier for the group."
                                            },
                                            {
                                                "name": "lastActiveDate",
                                                "type": "string",
                                                "description": "The timestamp (UTC) when the object was last active."
                                            },
                                            {
                                                "name": "fullDiskScanLastUpdatedAt",
                                                "type": "datetime",
                                                "description": "The timestamp (UTC) when the full disk scan was last updated."
                                            },
                                            {
                                                "name": "allowRemoteShell",
                                                "type": "boolean",
                                                "description": "Indicates whether remote shell is allowed."
                                            },
                                            {
                                                "name": "rangerVersion",
                                                "type": "string",
                                                "description": "The version of the ranger."
                                            },
                                            {
                                                "name": "accountName",
                                                "type": "string",
                                                "description": "The account name."
                                            },
                                            {
                                                "name": "scanStatus",
                                                "type": "string",
                                                "description": "The scan status of the object."
                                            },
                                            {
                                                "name": "domain",
                                                "type": "string",
                                                "description": "The domain of the object."
                                            },
                                            {
                                                "name": "missingPermissions",
                                                "type": "string",
                                                "description": "Details of the missing permissions."
                                            },
                                            {
                                                "name": "isActive",
                                                "type": "boolean",
                                                "description": "Indicates whether the object is active."
                                            },
                                            {
                                                "name": "groupIp",
                                                "type": "string",
                                                "description": "The IP address of the group."
                                            },
                                            {
                                                "name": "threatRebootRequired",
                                                "type": "boolean",
                                                "description": "Indicates whether a reboot is required due to a threat."
                                            },
                                            {
                                                "name": "groupUpdatedAt",
                                                "type": "datetime",
                                                "description": "The timestamp (UTC) when the group was last updated."
                                            },
                                            {
                                                "name": "externalId",
                                                "type": "string",
                                                "description": "The external identifier associated with the object."
                                            },
                                            {
                                                "name": "machineType",
                                                "type": "string",
                                                "description": "The type of machine."
                                            },
                                            {
                                                "name": "registeredAt",
                                                "type": "string",
                                                "description": "The timestamp (UTC) when the object was registered."
                                            },
                                            {
                                                "name": "appsVulnerabilityStatus",
                                                "type": "string",
                                                "description": "The vulnerability status of the applications."
                                            },
                                            {
                                                "name": "coreCount",
                                                "type": "real",
                                                "description": "The number of CPU cores."
                                            },
                                            {
                                                "name": "locations",
                                                "type": "string",
                                                "description": "The locations associated with the object."
                                            },
                                            {
                                                "name": "scanFinishedAt",
                                                "type": "string",
                                                "description": "The timestamp (UTC) when the scan was finished."
                                            },
                                            {
                                                "name": "updatedAt",
                                                "type": "string",
                                                "description": "The timestamp (UTC) when the object was last updated."
                                            },
                                            {
                                                "name": "externalIp",
                                                "type": "string",
                                                "description": "The external IP address of the object."
                                            },
                                            {
                                                "name": "locationType",
                                                "type": "string",
                                                "description": "The type of location."
                                            },
                                            {
                                                "name": "policyUpdatedAt",
                                                "type": "datetime",
                                                "description": "The timestamp (UTC) when the policy was last updated."
                                            },
                                            {
                                                "name": "isDecommissioned",
                                                "type": "boolean",
                                                "description": "Indicates whether the object is decommissioned."
                                            },
                                            {
                                                "name": "cpuId",
                                                "type": "string",
                                                "description": "The identifier of the CPU."
                                            },
                                            {
                                                "name": "networkInterfaces",
                                                "type": "string",
                                                "description": "Details of the network interfaces."
                                            },
                                            {
                                                "name": "isUninstalled",
                                                "type": "boolean",
                                                "description": "Indicates whether the object is uninstalled."
                                            },
                                            {
                                                "name": "activeDirectory",
                                                "type": "string",
                                                "description": "Details about the active directory."
                                            },
                                            {
                                                "name": "scanStartedAt",
                                                "type": "string",
                                                "description": "The timestamp (UTC) when the scan was started."
                                            },
                                            {
                                                "name": "rangerStatus",
                                                "type": "string",
                                                "description": "The status of the ranger."
                                            },
                                            {
                                                "name": "siteId",
                                                "type": "string",
                                                "description": "The unique identifier for the site."
                                            },
                                            {
                                                "name": "agentVersion",
                                                "type": "string",
                                                "description": "The version of the agent."
                                            },
                                            {
                                                "name": "osUsername",
                                                "type": "string",
                                                "description": "The username associated with the operating system."
                                            },
                                            {
                                                "name": "encryptedApplications",
                                                "type": "boolean",
                                                "description": "Indicates whether the applications are encrypted."
                                            },
                                            {
                                                "name": "lastIpToMgmt",
                                                "type": "string",
                                                "description": "The last IP address used for management."
                                            },
                                            {
                                                "name": "cpuCount",
                                                "type": "real",
                                                "description": "The number of CPUs."
                                            },
                                            {
                                                "name": "scanAbortedAt",
                                                "type": "datetime",
                                                "description": "The timestamp (UTC) when the scan was aborted."
                                            },
                                            {
                                                "name": "siteName",
                                                "type": "string",
                                                "description": "The name of the site."
                                            },
                                            {
                                                "name": "activeThreats",
                                                "type": "real",
                                                "description": "The number of active threats."
                                            },
                                            {
                                                "name": "infected",
                                                "type": "boolean",
                                                "description": "Indicates whether the object is infected."
                                            },
                                            {
                                                "name": "consoleMigrationStatus",
                                                "type": "string",
                                                "description": "The status of the console migration."
                                            },
                                            {
                                                "name": "osType",
                                                "type": "string",
                                                "description": "The type of operating system."
                                            },
                                            {
                                                "name": "accountId",
                                                "type": "string",
                                                "description": "The unique identifier for the account."
                                            },
                                            {
                                                "name": "groupName",
                                                "type": "string",
                                                "description": "The name of the group."
                                            },
                                            {
                                                "name": "osName",
                                                "type": "string",
                                                "description": "The name of the operating system."
                                            },
                                            {
                                                "name": "isUpToDate",
                                                "type": "boolean",
                                                "description": "Indicates whether the object is up to date."
                                            },
                                            {
                                                "name": "licenseKey",
                                                "type": "string",
                                                "description": "The license key associated with the object."
                                            },
                                            {
                                                "name": "userActionsNeeded",
                                                "type": "string",
                                                "description": "Details of the user actions needed."
                                            },
                                            {
                                                "name": "modelName",
                                                "type": "string",
                                                "description": "The model name of the object."
                                            },
                                            {
                                                "name": "networkQuarantineEnabled",
                                                "type": "boolean",
                                                "description": "Is Network Quarantine Enabled on the device"
                                            },
                                            {
                                                "name": "operationalStateExpiration",
                                                "type": "string",
                                                "description": "Agent operational state."
                                            },
                                            {
                                                "name": "remoteProfilingState",
                                                "type": "string",
                                                "description": "Agent remote profiling state."
                                            },
                                            {
                                                "name": "osStartTime",
                                                "type": "string",
                                                "description": "The Start time of the os."
                                            }
                                        ]
                                    },
                                    "Custom-SentinelOneAlerts_API": {
                                        "columns": [
                                            {
                                                "name": "sourceProcessInfo",
                                                "type": "string",
                                                "description": "Information about the source process."
                                            },
                                            {
                                                "name": "alertInfo",
                                                "type": "string",
                                                "description": "Details about the alert."
                                            },
                                            {
                                                "name": "agentDetectionInfo",
                                                "type": "string",
                                                "description": "Detection information related to the agent."
                                            },
                                            {
                                                "name": "ruleInfo",
                                                "type": "string",
                                                "description": "Information regarding the applied rule."
                                            },
                                            {
                                                "name": "containerInfo",
                                                "type": "string",
                                                "description": "Information about the container."
                                            },
                                            {
                                                "name": "sourceParentProcessInfo",
                                                "type": "string",
                                                "description": "Information about the parent process of the source."
                                            },
                                            {
                                                "name": "targetProcessInfo",
                                                "type": "string",
                                                "description": "Details regarding the target process."
                                            },
                                            {
                                                "name": "kubernetesInfo",
                                                "type": "string",
                                                "description": "Kubernetes-related information."
                                            }
                                        ]
                                    },
                                    "Custom-SentinelOneGroups_API": {
                                        "columns": [
                                            {
                                                "name": "creator",
                                                "type": "string",
                                                "description": "The name of the creator."
                                            },
                                            {
                                                "name": "registrationToken",
                                                "type": "string",
                                                "description": "The token used for registration."
                                            },
                                            {
                                                "name": "isDefault",
                                                "type": "boolean",
                                                "description": "Indicates whether this is the default setting."
                                            },
                                            {
                                                "name": "updatedAt",
                                                "type": "string",
                                                "description": "The timestamp (UTC) when the object was last updated."
                                            },
                                            {
                                                "name": "totalAgents",
                                                "type": "real",
                                                "description": "The total number of agents."
                                            },
                                            {
                                                "name": "inherits",
                                                "type": "boolean",
                                                "description": "Indicates whether the object inherits properties."
                                            },
                                            {
                                                "name": "name",
                                                "type": "string",
                                                "description": "The name of the object."
                                            },
                                            {
                                                "name": "rank",
                                                "type": "real",
                                                "description": "The rank of the object."
                                            },
                                            {
                                                "name": "filterName",
                                                "type": "string",
                                                "description": "The name of the filter applied."
                                            },
                                            {
                                                "name": "type",
                                                "type": "string",
                                                "description": "The type of the object."
                                            },
                                            {
                                                "name": "id",
                                                "type": "string",
                                                "description": "The unique identifier for the object."
                                            },
                                            {
                                                "name": "createdAt",
                                                "type": "datetime",
                                                "description": "The timestamp (UTC) when the object was created."
                                            },
                                            {
                                                "name": "creatorId",
                                                "type": "string",
                                                "description": "The unique identifier of the creator."
                                            },
                                            {
                                                "name": "siteId",
                                                "type": "string",
                                                "description": "The unique identifier of the site."
                                            },
                                            {
                                                "name": "filterId",
                                                "type": "string",
                                                "description": "The unique identifier of the filter."
                                            }
                                        ]
                                    },
                                    "Custom-SentinelOneThreats_API": {
                                        "columns": [
                                            {
                                                "name": "threatInfo",
                                                "type": "string",
                                                "description": "The information regarding the threat."
                                            },
                                            {
                                                "name": "agentDetectionInfo",
                                                "type": "string",
                                                "description": "The information of the agent on detectino."
                                            },
                                            {
                                                "name": "agentRealtimeInfo",
                                                "type": "string",
                                                "description": "The information of the agent in real time."
                                            },
                                            {
                                                "name": "indicators",
                                                "type": "string",
                                                "description": "Details of the indicators."
                                            },
                                            {
                                                "name": "whiteningOptions",
                                                "type": "string",
                                                "description": "Details of the whitening options."
                                            },
                                            {
                                                "name": "id",
                                                "type": "string",
                                                "description": "Event Id."
                                            }
                                        ]
                                    }
                                },
                                "destinations": {
                                    "logAnalytics": [
                                        {
                                            "workspaceResourceId": "[resourceId('microsoft.OperationalInsights/Workspaces', parameters('workspace'))]",
                                            "name": "clv2ws1"
                                        }
                                    ]
                                },
                                "dataFlows": [
                                    {
                                        "streams": [
                                            "Custom-SentinelOneActivities_API"
                                        ],
                                        "destinations": [
                                            "clv2ws1"
                                        ],
                                        "transformKql": "source | project TimeGenerated = createdAt, AgentUpdatedVersion = agentUpdatedVersion, UserId = userId, ThreatId = threatId, PrimaryDescription = primaryDescription, SecondaryDescription = secondaryDescription, Id = id, GroupId = groupId, CreatedAt = createdAt, AccountName = accountName, Data = data, AgentId = agentId, Hash = hash, UpdatedAt = todatetime(updatedAt), Description = description, ActivityUuid = activityUuid, SiteId = siteId, ActivityType = activityType, SiteName = siteName, AccountId = accountId, OsFamily = osFamily, GroupName = groupName, Comments = comments",
                                        "outputStream": "Custom-SentinelOneActivities_CL"
                                    },
                                    {
                                        "streams": [
                                            "Custom-SentinelOneAgents_API"
                                        ],
                                        "destinations": [
                                            "clv2ws1"
                                        ],
                                        "transformKql": "source | project TimeGenerated = createdAt, Uuid = uuid, MitigationMode = mitigationMode, NetworkStatus = networkStatus, InstallerType = installerType, MitigationModeSuspicious = mitigationModeSuspicious, IsPendingUninstall = isPendingUninstall, InRemoteShellSession = inRemoteShellSession, LastLoggedInUserName = lastLoggedInUserName, OsRevision = osRevision, OsArch = osArch, Id = id, ComputerName = computerName, TotalMemory = totalMemory, CreatedAt = createdAt, GroupId = groupId, LastActiveDate = todatetime(lastActiveDate), FullDiskScanLastUpdatedAt = fullDiskScanLastUpdatedAt, AllowRemoteShell = allowRemoteShell, RangerVersion = rangerVersion, AccountName = accountName, ScanStatus = scanStatus, Domain = domain, MissingPermissions = missingPermissions, IsActive = isActive, GroupIp = groupIp, ThreatRebootRequired = threatRebootRequired, GroupUpdatedAt = groupUpdatedAt, ExternalId = externalId, MachineType = machineType, RegisteredAt = todatetime(registeredAt), AppsVulnerabilityStatus = appsVulnerabilityStatus, CoreCount = coreCount, Locations = locations, ScanFinishedAt = todatetime(scanFinishedAt), UpdatedAt = todatetime(updatedAt), ExternalIp = externalIp, LocationType = locationType, PolicyUpdatedAt = policyUpdatedAt, IsDecommissioned = isDecommissioned, CpuId = cpuId, NetworkInterfaces = networkInterfaces, IsUninstalled = isUninstalled, ActiveDirectory = activeDirectory, ScanStartedAt = todatetime(scanStartedAt), RangerStatus = rangerStatus, SiteId = siteId, AgentVersion = agentVersion, OsUsername = osUsername, EncryptedApplications = encryptedApplications, LastIpToMgmt = lastIpToMgmt, CpuCount = cpuCount, ScanAbortedAt = scanAbortedAt, SiteName = siteName, ActiveThreats = activeThreats, Infected = infected, ConsoleMigrationStatus = consoleMigrationStatus, OsType = osType, AccountId = accountId, GroupName = groupName, OsName = osName, IsUpToDate = isUpToDate, LicenseKey = licenseKey, UserActionsNeeded = userActionsNeeded, ModelName = modelName, OsStartTime = todatetime(osStartTime), NetworkQuarantineEnabled=networkQuarantineEnabled,OperationalStateExpiration=operationalStateExpiration,RemoteProfilingState=remoteProfilingState",
                                        "outputStream": "Custom-SentinelOneAgents_CL"
                                    },
                                    {
                                        "streams": [
                                            "Custom-SentinelOneAlerts_API"
                                        ],
                                        "destinations": [
                                            "clv2ws1"
                                        ],
                                        "transformKql": "source | project TimeGenerated = todatetime(parse_json(todynamic(alertInfo)).createdAt), SourceProcessInfo = sourceProcessInfo, AlertInfo = alertInfo, AgentDetectionInfo = agentDetectionInfo, RuleInfo = ruleInfo, ContainerInfo = containerInfo, SourceParentProcessInfo = sourceParentProcessInfo, TargetProcessInfo = targetProcessInfo, KubernetesInfo = kubernetesInfo",
                                        "outputStream": "Custom-SentinelOneAlerts_CL"
                                    },
                                    {
                                        "streams": [
                                            "Custom-SentinelOneGroups_API"
                                        ],
                                        "destinations": [
                                            "clv2ws1"
                                        ],
                                        "transformKql": "source | project TimeGenerated = createdAt, Creator = creator, RegistrationToken = registrationToken, IsDefault = tostring(isDefault), UpdatedAt = todatetime(updatedAt), TotalAgents = tostring(totalAgents), Inherits = tostring(inherits), Name = name, Rank = rank, FilterName = filterName, GroupType = type, Id = id, CreatedAt = createdAt, CreatorId = creatorId, SiteId = siteId, FilterId = filterId",
                                        "outputStream": "Custom-SentinelOneGroups_CL"
                                    },
                                    {
                                        "streams": [
                                            "Custom-SentinelOneThreats_API"
                                        ],
                                        "destinations": [
                                            "clv2ws1"
                                        ],
                                        "transformKql": "source | extend ThreatInfo = parse_json(todynamic(threatInfo)), AgentDetectionInfo=parse_json(todynamic(agentDetectionInfo)), AgentRealtimeInfo=parse_json(todynamic(agentRealtimeInfo)) | project TimeGenerated = todatetime(ThreatInfo.createdAt), FilePath = tostring(ThreatInfo.filePath), CloudVerdict = tostring(ThreatInfo.cloudVerdict), MitigationMode = tostring(AgentDetectionInfo.mitigationMode), AgentOsType = tostring(AgentRealtimeInfo.agentOsType), AgentInfected = tobool(AgentRealtimeInfo.agentInfected), InitiatingUserId = tostring(ThreatInfo.initiatingUserId), Engines = tostring(ThreatInfo.engines), Id = id, FileExtensionType = tostring(ThreatInfo.fileExtensionType), MitigationStatus = tostring(ThreatInfo.mitigationStatus), AgentDomain = tostring(AgentDetectionInfo.agentDomain), CreatedAt = todatetime(ThreatInfo.createdAt), IsCertValid = tobool(ThreatInfo.isValidCertificate), FileDisplayName = tostring(ThreatInfo.filePath), AgentIp = tostring(AgentDetectionInfo.agentIpV4), AccountName = tostring(AgentRealtimeInfo.accountName), AgentMachineType = tostring(AgentRealtimeInfo.agentMachineType), FileVerificationType = tostring(ThreatInfo.fileVerificationType), Indicators = indicators, InitiatedByDescription = tostring(ThreatInfo.initiatedByDescription), AutomaticallyResolved = tobool(ThreatInfo.automaticallyResolved), AgentId = tostring(AgentRealtimeInfo.agentId), ProcessArguments = tostring(ThreatInfo.maliciousProcessArguments), MitigationReport = tostring(AgentDetectionInfo.mitigationReport), ThreatName = tostring(ThreatInfo.threatName), ClassificationSource = tostring(ThreatInfo.classificationSource), UpdatedAt = todatetime(ThreatInfo.updatedAt), InitiatedBy = tostring(ThreatInfo.initiatedBy), AgentNetworkStatus = tostring(AgentRealtimeInfo.agentNetworkStatus), AgentComputerName = tostring(AgentRealtimeInfo.agentComputerName), Classification = tostring(ThreatInfo.classification), CertId = tostring(ThreatInfo.certificateId), AgentIsActive = tobool(AgentRealtimeInfo.agentIsActive), SiteId = tostring(AgentDetectionInfo.siteId), AgentVersion = tostring(AgentDetectionInfo.agentVersion), FileContentHash = tostring(ThreatInfo.md5), WhiteningOptions = whiteningOptions,FileSha256 = tostring(ThreatInfo.sha256), Username = tostring(ThreatInfo.initiatingUsername), AgentIsDecommissioned = tobool(AgentDetectionInfo.agentIsDecommissioned), CollectionId = tostring(ThreatInfo.collectionId), SiteName = tostring(AgentDetectionInfo.siteName), AccountId = tostring(AgentDetectionInfo.accountId), ThreatInfo, AgentDetectionInfo, AgentRealtimeInfo",
                                        "outputStream": "Custom-SentinelOneThreats_CL"
                                    }
                                ],
                                "dataCollectionEndpointId": "[concat('/subscriptions/',parameters('subscription'),'/resourceGroups/',parameters('resourceGroupName'),'/providers/Microsoft.Insights/dataCollectionEndpoints/',parameters('workspace'))]"
                            }
                        },
                        {
                            "name": "SentinelOneThreats_CL",
                            "apiVersion": "2022-10-01",
                            "type": "Microsoft.OperationalInsights/workspaces/tables",
                            "location": "[parameters('workspace-location')]",
                            "kind": null,
                            "properties": {
                                "schema": {
                                    "name": "SentinelOneThreats_CL",
                                    "columns": [
                                        {
                                            "name": "TimeGenerated",
                                            "type": "datetime",
                                            "isDefaultDisplay": true,
                                            "description": "The timestamp (UTC) reflecting the time in which the event was generated."
                                        },
                                        {
                                            "name": "FilePath",
                                            "type": "string",
                                            "description": "The path of the file."
                                        },
                                        {
                                            "name": "CloudVerdict",
                                            "type": "string",
                                            "description": "The cloud verdict for the file."
                                        },
                                        {
                                            "name": "MitigationMode",
                                            "type": "string",
                                            "description": "The mode of mitigation applied."
                                        },
                                        {
                                            "name": "AgentOsType",
                                            "type": "string",
                                            "description": "The operating system type of the agent."
                                        },
                                        {
                                            "name": "AgentInfected",
                                            "type": "boolean",
                                            "description": "Indicates whether the agent is infected."
                                        },
                                        {
                                            "name": "InitiatingUserId",
                                            "type": "string",
                                            "description": "The unique identifier for the initiating user."
                                        },
                                        {
                                            "name": "Engines",
                                            "type": "string",
                                            "description": "Details of the engines used."
                                        },
                                        {
                                            "name": "Id",
                                            "type": "string",
                                            "description": "The unique identifier for the record."
                                        },
                                        {
                                            "name": "FileExtensionType",
                                            "type": "string",
                                            "description": "The type of file extension."
                                        },
                                        {
                                            "name": "MitigationStatus",
                                            "type": "string",
                                            "description": "The status of mitigation."
                                        },
                                        {
                                            "name": "AgentDomain",
                                            "type": "string",
                                            "description": "The domain of the agent."
                                        },
                                        {
                                            "name": "CreatedAt",
                                            "type": "datetime",
                                            "description": "The timestamp (UTC) when the record was created."
                                        },
                                        {
                                            "name": "IsCertValid",
                                            "type": "boolean",
                                            "description": "Indicates whether the certificate is valid."
                                        },
                                        {
                                            "name": "FileDisplayName",
                                            "type": "string",
                                            "description": "The display name of the file."
                                        },
                                        {
                                            "name": "AgentIp",
                                            "type": "string",
                                            "description": "The IP address of the agent."
                                        },
                                        {
                                            "name": "AccountName",
                                            "type": "string",
                                            "description": "The name of the account associated with the event."
                                        },
                                        {
                                            "name": "AgentMachineType",
                                            "type": "string",
                                            "description": "The machine type of the agent."
                                        },
                                        {
                                            "name": "FileVerificationType",
                                            "type": "string",
                                            "description": "The type of file verification."
                                        },
                                        {
                                            "name": "Indicators",
                                            "type": "string",
                                            "description": "Details of the indicators."
                                        },
                                        {
                                            "name": "InitiatedByDescription",
                                            "type": "string",
                                            "description": "Description of the initiated by field."
                                        },
                                        {
                                            "name": "AutomaticallyResolved",
                                            "type": "boolean",
                                            "description": "Indicates whether the issue was automatically resolved."
                                        },
                                        {
                                            "name": "AgentId",
                                            "type": "string",
                                            "description": "The unique identifier for the agent."
                                        },
                                        {
                                            "name": "ProcessArguments",
                                            "type": "string",
                                            "description": "The unique identifier for the malicious group."
                                        },
                                        {
                                            "name": "MitigationReport",
                                            "type": "string",
                                            "description": "Report of the actions taken by the Agent."
                                        },
                                        {
                                            "name": "ThreatName",
                                            "type": "string",
                                            "description": "Details about the threat name."
                                        },
                                        {
                                            "name": "ClassificationSource",
                                            "type": "string",
                                            "description": "The source of the classification."
                                        },
                                        {
                                            "name": "UpdatedAt",
                                            "type": "datetime",
                                            "description": "The timestamp (UTC) when the record was last updated."
                                        },
                                        {
                                            "name": "InitiatedBy",
                                            "type": "string",
                                            "description": "Indicates by whom or what the action was initiated."
                                        },
                                        {
                                            "name": "AgentNetworkStatus",
                                            "type": "string",
                                            "description": "The network status of the agent."
                                        },
                                        {
                                            "name": "AgentComputerName",
                                            "type": "string",
                                            "description": "The computer name of the agent."
                                        },
                                        {
                                            "name": "Classification",
                                            "type": "string",
                                            "description": "The classification of the event."
                                        },
                                        {
                                            "name": "CertId",
                                            "type": "string",
                                            "description": "The certificate ID."
                                        },
                                        {
                                            "name": "AgentIsActive",
                                            "type": "boolean",
                                            "description": "Indicates whether the agent is active."
                                        },
                                        {
                                            "name": "SiteId",
                                            "type": "string",
                                            "description": "The unique identifier for the site."
                                        },
                                        {
                                            "name": "AgentVersion",
                                            "type": "string",
                                            "description": "The version of the agent."
                                        },
                                        {
                                            "name": "FileContentHash",
                                            "type": "string",
                                            "description": "The hash of the file content."
                                        },
                                        {
                                            "name": "WhiteningOptions",
                                            "type": "string",
                                            "description": "Details of the whitening options."
                                        },
                                        {
                                            "name": "Username",
                                            "type": "string",
                                            "description": "The username associated with the event."
                                        },
                                        {
                                            "name": "FileSha256",
                                            "type": "string",
                                            "description": "The SHA-256 hash of the file."
                                        },
                                        {
                                            "name": "AgentIsDecommissioned",
                                            "type": "boolean",
                                            "description": "Indicates whether the agent is decommissioned."
                                        },
                                        {
                                            "name": "CollectionId",
                                            "type": "string",
                                            "description": "The unique identifier for the collection."
                                        },
                                        {
                                            "name": "SiteName",
                                            "type": "string",
                                            "description": "The name of the site."
                                        },
                                        {
                                            "name": "AccountId",
                                            "type": "string",
                                            "description": "The unique identifier for the account."
                                        },
                                        {
                                            "name": "ThreatInfo",
                                            "type": "dynamic",
                                            "description": "The information about the threat."
                                        },
                                        {
                                            "name": "AgentDetectionInfo",
                                            "type": "dynamic",
                                            "description": "The information of the agent in detection."
                                        },
                                        {
                                            "name": "AgentRealtimeInfo",
                                            "type": "dynamic",
                                            "description": "The information of the agent in realtime."
                                        }
                                    ]
                                }
                            }
                        },
                        {
                            "name": "SentinelOneActivities_CL",
                            "apiVersion": "2022-10-01",
                            "type": "Microsoft.OperationalInsights/workspaces/tables",
                            "location": "[parameters('workspace-location')]",
                            "kind": null,
                            "properties": {
                                "schema": {
                                    "name": "SentinelOneActivities_CL",
                                    "columns": [
                                        {
                                            "name": "TimeGenerated",
                                            "type": "datetime",
                                            "isDefaultDisplay": true,
                                            "description": "The timestamp (UTC) reflecting the time in which the event was generated."
                                        },
                                        {
                                            "name": "AgentUpdatedVersion",
                                            "type": "string",
                                            "description": "The version of the agent that was updated."
                                        },
                                        {
                                            "name": "UserId",
                                            "type": "string",
                                            "description": "The unique identifier for the user."
                                        },
                                        {
                                            "name": "ThreatId",
                                            "type": "string",
                                            "description": "The unique identifier for the threat."
                                        },
                                        {
                                            "name": "PrimaryDescription",
                                            "type": "string",
                                            "description": "The primary description of the event."
                                        },
                                        {
                                            "name": "SecondaryDescription",
                                            "type": "string",
                                            "description": "The secondary description of the event."
                                        },
                                        {
                                            "name": "Id",
                                            "type": "string",
                                            "description": "The unique identifier for the record."
                                        },
                                        {
                                            "name": "GroupId",
                                            "type": "string",
                                            "description": "The unique identifier for the group."
                                        },
                                        {
                                            "name": "CreatedAt",
                                            "type": "datetime",
                                            "description": "The timestamp (UTC) when the record was created."
                                        },
                                        {
                                            "name": "AccountName",
                                            "type": "string",
                                            "description": "The name of the account associated with the event."
                                        },
                                        {
                                            "name": "Data",
                                            "type": "string",
                                            "description": "Activity metadata."
                                        },
                                        {
                                            "name": "AgentId",
                                            "type": "string",
                                            "description": "The unique identifier for the agent."
                                        },
                                        {
                                            "name": "Hash",
                                            "type": "string",
                                            "description": "The hash associated with the event."
                                        },
                                        {
                                            "name": "UpdatedAt",
                                            "type": "datetime",
                                            "description": "The timestamp (UTC) when the record was last updated."
                                        },
                                        {
                                            "name": "Description",
                                            "type": "string",
                                            "description": "The description of the event."
                                        },
                                        {
                                            "name": "ActivityUuid",
                                            "type": "string",
                                            "description": "The UUID of the activity associated with the event."
                                        },
                                        {
                                            "name": "SiteId",
                                            "type": "string",
                                            "description": "The unique identifier for the site."
                                        },
                                        {
                                            "name": "ActivityType",
                                            "type": "real",
                                            "description": "The type of activity represented by an integer."
                                        },
                                        {
                                            "name": "SiteName",
                                            "type": "string",
                                            "description": "The name of the site associated with the event."
                                        },
                                        {
                                            "name": "AccountId",
                                            "type": "string",
                                            "description": "The unique identifier for the account."
                                        },
                                        {
                                            "name": "OsFamily",
                                            "type": "string",
                                            "description": "The operating system family, such as macOS."
                                        },
                                        {
                                            "name": "GroupName",
                                            "type": "string",
                                            "description": "The name of the group associated with the event."
                                        },
                                        {
                                            "name": "Comments",
                                            "type": "string",
                                            "description": "Any comments associated with the event."
                                        }
                                    ]
                                }
                            }
                        },
                        {
                            "name": "SentinelOneAgents_CL",
                            "apiVersion": "2022-10-01",
                            "type": "Microsoft.OperationalInsights/workspaces/tables",
                            "location": "[parameters('workspace-location')]",
                            "kind": null,
                            "properties": {
                                "schema": {
                                    "name": "SentinelOneAgents_CL",
                                    "columns": [
                                        {
                                            "name": "TimeGenerated",
                                            "type": "datetime",
                                            "isDefaultDisplay": true,
                                            "description": "The timestamp (UTC) reflecting the time in which the event was generated."
                                        },
                                        {
                                            "name": "Uuid",
                                            "type": "string",
                                            "description": "The unique identifier for the object."
                                        },
                                        {
                                            "name": "MitigationMode",
                                            "type": "string",
                                            "description": "The mitigation mode applied."
                                        },
                                        {
                                            "name": "NetworkStatus",
                                            "type": "string",
                                            "description": "The network status of the object."
                                        },
                                        {
                                            "name": "InstallerType",
                                            "type": "string",
                                            "description": "The type of installer used."
                                        },
                                        {
                                            "name": "MitigationModeSuspicious",
                                            "type": "string",
                                            "description": "The suspicious mitigation mode applied."
                                        },
                                        {
                                            "name": "IsPendingUninstall",
                                            "type": "boolean",
                                            "description": "Indicates whether the object is pending uninstallation."
                                        },
                                        {
                                            "name": "InRemoteShellSession",
                                            "type": "boolean",
                                            "description": "Indicates whether the object is in a remote shell session."
                                        },
                                        {
                                            "name": "LastLoggedInUserName",
                                            "type": "string",
                                            "description": "The username of the last logged-in user."
                                        },
                                        {
                                            "name": "OsRevision",
                                            "type": "string",
                                            "description": "The OS revision."
                                        },
                                        {
                                            "name": "OsArch",
                                            "type": "string",
                                            "description": "The OS architecture."
                                        },
                                        {
                                            "name": "Id",
                                            "type": "string",
                                            "description": "The unique identifier for the object."
                                        },
                                        {
                                            "name": "ComputerName",
                                            "type": "string",
                                            "description": "The name of the computer."
                                        },
                                        {
                                            "name": "TotalMemory",
                                            "type": "real",
                                            "description": "The total memory available in MB."
                                        },
                                        {
                                            "name": "CreatedAt",
                                            "type": "datetime",
                                            "description": "The timestamp (UTC) when the object was created."
                                        },
                                        {
                                            "name": "GroupId",
                                            "type": "string",
                                            "description": "The unique identifier for the group."
                                        },
                                        {
                                            "name": "LastActiveDate",
                                            "type": "datetime",
                                            "description": "The timestamp (UTC) when the object was last active."
                                        },
                                        {
                                            "name": "FullDiskScanLastUpdatedAt",
                                            "type": "datetime",
                                            "description": "The timestamp (UTC) when the full disk scan was last updated."
                                        },
                                        {
                                            "name": "AllowRemoteShell",
                                            "type": "boolean",
                                            "description": "Indicates whether remote shell is allowed."
                                        },
                                        {
                                            "name": "RangerVersion",
                                            "type": "string",
                                            "description": "The version of the ranger."
                                        },
                                        {
                                            "name": "AccountName",
                                            "type": "string",
                                            "description": "The account name."
                                        },
                                        {
                                            "name": "ScanStatus",
                                            "type": "string",
                                            "description": "The scan status of the object."
                                        },
                                        {
                                            "name": "Domain",
                                            "type": "string",
                                            "description": "The domain of the object."
                                        },
                                        {
                                            "name": "MissingPermissions",
                                            "type": "string",
                                            "description": "Details of the missing permissions."
                                        },
                                        {
                                            "name": "IsActive",
                                            "type": "boolean",
                                            "description": "Indicates whether the object is active."
                                        },
                                        {
                                            "name": "GroupIp",
                                            "type": "string",
                                            "description": "The IP address of the group."
                                        },
                                        {
                                            "name": "ThreatRebootRequired",
                                            "type": "boolean",
                                            "description": "Indicates whether a reboot is required due to a threat."
                                        },
                                        {
                                            "name": "GroupUpdatedAt",
                                            "type": "datetime",
                                            "description": "The timestamp (UTC) when the group was last updated."
                                        },
                                        {
                                            "name": "ExternalId",
                                            "type": "string",
                                            "description": "The external identifier associated with the object."
                                        },
                                        {
                                            "name": "MachineType",
                                            "type": "string",
                                            "description": "The type of machine."
                                        },
                                        {
                                            "name": "RegisteredAt",
                                            "type": "datetime",
                                            "description": "The timestamp (UTC) when the object was registered."
                                        },
                                        {
                                            "name": "AppsVulnerabilityStatus",
                                            "type": "string",
                                            "description": "The vulnerability status of the applications."
                                        },
                                        {
                                            "name": "CoreCount",
                                            "type": "real",
                                            "description": "The number of CPU cores."
                                        },
                                        {
                                            "name": "Locations",
                                            "type": "string",
                                            "description": "The locations associated with the object."
                                        },
                                        {
                                            "name": "ScanFinishedAt",
                                            "type": "datetime",
                                            "description": "The timestamp (UTC) when the scan was finished."
                                        },
                                        {
                                            "name": "UpdatedAt",
                                            "type": "datetime",
                                            "description": "The timestamp (UTC) when the object was last updated."
                                        },
                                        {
                                            "name": "ExternalIp",
                                            "type": "string",
                                            "description": "The external IP address of the object."
                                        },
                                        {
                                            "name": "LocationType",
                                            "type": "string",
                                            "description": "The type of location."
                                        },
                                        {
                                            "name": "PolicyUpdatedAt",
                                            "type": "datetime",
                                            "description": "The timestamp (UTC) when the policy was last updated."
                                        },
                                        {
                                            "name": "IsDecommissioned",
                                            "type": "boolean",
                                            "description": "Indicates whether the object is decommissioned."
                                        },
                                        {
                                            "name": "CpuId",
                                            "type": "string",
                                            "description": "The identifier of the CPU."
                                        },
                                        {
                                            "name": "NetworkInterfaces",
                                            "type": "string",
                                            "description": "Details of the network interfaces."
                                        },
                                        {
                                            "name": "IsUninstalled",
                                            "type": "boolean",
                                            "description": "Indicates whether the object is uninstalled."
                                        },
                                        {
                                            "name": "ActiveDirectory",
                                            "type": "string",
                                            "description": "Details about the active directory."
                                        },
                                        {
                                            "name": "ScanStartedAt",
                                            "type": "datetime",
                                            "description": "The timestamp (UTC) when the scan was started."
                                        },
                                        {
                                            "name": "RangerStatus",
                                            "type": "string",
                                            "description": "The status of the ranger."
                                        },
                                        {
                                            "name": "SiteId",
                                            "type": "string",
                                            "description": "The unique identifier for the site."
                                        },
                                        {
                                            "name": "AgentVersion",
                                            "type": "string",
                                            "description": "The version of the agent."
                                        },
                                        {
                                            "name": "OsUsername",
                                            "type": "string",
                                            "description": "The username associated with the operating system."
                                        },
                                        {
                                            "name": "EncryptedApplications",
                                            "type": "boolean",
                                            "description": "Indicates whether the applications are encrypted."
                                        },
                                        {
                                            "name": "LastIpToMgmt",
                                            "type": "string",
                                            "description": "The last IP address used for management."
                                        },
                                        {
                                            "name": "CpuCount",
                                            "type": "real",
                                            "description": "The number of CPUs."
                                        },
                                        {
                                            "name": "ScanAbortedAt",
                                            "type": "datetime",
                                            "description": "The timestamp (UTC) when the scan was aborted."
                                        },
                                        {
                                            "name": "SiteName",
                                            "type": "string",
                                            "description": "The name of the site."
                                        },
                                        {
                                            "name": "ActiveThreats",
                                            "type": "real",
                                            "description": "The number of active threats."
                                        },
                                        {
                                            "name": "Infected",
                                            "type": "boolean",
                                            "description": "Indicates whether the object is infected."
                                        },
                                        {
                                            "name": "ConsoleMigrationStatus",
                                            "type": "string",
                                            "description": "The status of the console migration."
                                        },
                                        {
                                            "name": "OsType",
                                            "type": "string",
                                            "description": "The type of operating system."
                                        },
                                        {
                                            "name": "AccountId",
                                            "type": "string",
                                            "description": "The unique identifier for the account."
                                        },
                                        {
                                            "name": "GroupName",
                                            "type": "string",
                                            "description": "The name of the group."
                                        },
                                        {
                                            "name": "OsName",
                                            "type": "string",
                                            "description": "The name of the operating system."
                                        },
                                        {
                                            "name": "IsUpToDate",
                                            "type": "boolean",
                                            "description": "Indicates whether the object is up to date."
                                        },
                                        {
                                            "name": "LicenseKey",
                                            "type": "string",
                                            "description": "The license key associated with the object."
                                        },
                                        {
                                            "name": "UserActionsNeeded",
                                            "type": "string",
                                            "description": "Details of the user actions needed."
                                        },
                                        {
                                            "name": "ModelName",
                                            "type": "string",
                                            "description": "The model name of the object."
                                        },
                                        {
                                            "name": "OsStartTime",
                                            "type": "datetime",
                                            "description": "The timestamp (UTC) when the operating system started."
                                        },
                                        {
                                            "name": "NetworkQuarantineEnabled",
                                            "type": "boolean",
                                            "description": "Is Network Quarantine Enabled on the device."
                                        },
                                        {
                                            "name": "OperationalStateExpiration",
                                            "type": "string",
                                            "description": "Agent operational state."
                                        },
                                        {
                                            "name": "RemoteProfilingState",
                                            "type": "string",
                                            "description": "Agent remote profiling state."
                                        }
                                    ]
                                }
                            }
                        },
                        {
                            "name": "SentinelOneAlerts_CL",
                            "apiVersion": "2022-10-01",
                            "type": "Microsoft.OperationalInsights/workspaces/tables",
                            "location": "[parameters('workspace-location')]",
                            "kind": null,
                            "properties": {
                                "schema": {
                                    "name": "SentinelOneAlerts_CL",
                                    "columns": [
                                        {
                                            "name": "TimeGenerated",
                                            "type": "datetime",
                                            "isDefaultDisplay": true,
                                            "description": "The timestamp (UTC) reflecting the time in which the event was generated."
                                        },
                                        {
                                            "name": "SourceProcessInfo",
                                            "type": "string",
                                            "description": "Information about the source process."
                                        },
                                        {
                                            "name": "AlertInfo",
                                            "type": "string",
                                            "description": "Details about the alert."
                                        },
                                        {
                                            "name": "AgentDetectionInfo",
                                            "type": "string",
                                            "description": "Detection information related to the agent."
                                        },
                                        {
                                            "name": "RuleInfo",
                                            "type": "string",
                                            "description": "Information regarding the applied rule."
                                        },
                                        {
                                            "name": "ContainerInfo",
                                            "type": "string",
                                            "description": "Information about the container."
                                        },
                                        {
                                            "name": "SourceParentProcessInfo",
                                            "type": "string",
                                            "description": "Information about the parent process of the source."
                                        },
                                        {
                                            "name": "TargetProcessInfo",
                                            "type": "string",
                                            "description": "Details regarding the target process."
                                        },
                                        {
                                            "name": "KubernetesInfo",
                                            "type": "string",
                                            "description": "Kubernetes-related information."
                                        }
                                    ]
                                }
                            }
                        },
                        {
                            "name": "SentinelOneGroups_CL",
                            "apiVersion": "2022-10-01",
                            "type": "Microsoft.OperationalInsights/workspaces/tables",
                            "location": "[parameters('workspace-location')]",
                            "kind": null,
                            "properties": {
                                "schema": {
                                    "name": "SentinelOneGroups_CL",
                                    "columns": [
                                        {
                                            "name": "TimeGenerated",
                                            "type": "datetime",
                                            "isDefaultDisplay": true,
                                            "description": "The timestamp (UTC) reflecting the time in which the event was generated."
                                        },
                                        {
                                            "name": "Creator",
                                            "type": "string",
                                            "description": "The name of the creator."
                                        },
                                        {
                                            "name": "RegistrationToken",
                                            "type": "string",
                                            "description": "The token used for registration."
                                        },
                                        {
                                            "name": "IsDefault",
                                            "type": "string",
                                            "description": "Indicates whether this is the default setting."
                                        },
                                        {
                                            "name": "UpdatedAt",
                                            "type": "datetime",
                                            "description": "The timestamp (UTC) when the object was last updated."
                                        },
                                        {
                                            "name": "TotalAgents",
                                            "type": "string",
                                            "description": "The total number of agents."
                                        },
                                        {
                                            "name": "Inherits",
                                            "type": "string",
                                            "description": "Indicates whether the object inherits properties."
                                        },
                                        {
                                            "name": "Name",
                                            "type": "string",
                                            "description": "The name of the object."
                                        },
                                        {
                                            "name": "Rank",
                                            "type": "real",
                                            "description": "The rank of the object."
                                        },
                                        {
                                            "name": "FilterName",
                                            "type": "string",
                                            "description": "The name of the filter applied."
                                        },
                                        {
                                            "name": "GroupType",
                                            "type": "string",
                                            "description": "The type of the object."
                                        },
                                        {
                                            "name": "Id",
                                            "type": "string",
                                            "description": "The unique identifier for the object."
                                        },
                                        {
                                            "name": "CreatedAt",
                                            "type": "datetime",
                                            "description": "The timestamp (UTC) when the object was created."
                                        },
                                        {
                                            "name": "CreatorId",
                                            "type": "string",
                                            "description": "The unique identifier of the creator."
                                        },
                                        {
                                            "name": "SiteId",
                                            "type": "string",
                                            "description": "The unique identifier of the site."
                                        },
                                        {
                                            "name": "FilterId",
                                            "type": "string",
                                            "description": "The unique identifier of the filter."
                                        }
                                    ]
                                }
                            }
                        }
                    ]
                },
                "packageKind": "Solution",
                "packageVersion": "3.0.6",
                "packageName": "SentinelOne",
                "contentProductId": "azuresentinel.azure-sentinel-solution-sentinelone-dc-bi2frq64rnvnq",
                "packageId": "azuresentinel.azure-sentinel-solution-sentinelone",
                "contentSchemaVersion": "3.0.0",
                "version": "1.0.0",
                "id": "azuresentinel.azure-sentinel-solution-sentinelone-dc-bi2frq64rnvnq",
                "isDeprecated": false,
                "description": ""
            }
        },
        {
            "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/','SentinelOneCCP')]",
            "apiVersion": "2022-09-01-preview",
            "type": "Microsoft.OperationalInsights/workspaces/providers/dataConnectorDefinitions",
            "location": "[parameters('workspace-location')]",
            "kind": "Customizable",
            "properties": {
                "connectorUiConfig": {
                    "id": "SentinelOneCCP",
                    "title": "SentinelOne",
                    "publisher": "Microsoft",
                    "descriptionMarkdown": "The [SentinelOne](https://usea1-nessat.sentinelone.net/api-doc/overview) data connector allows ingesting logs from the SentinelOne API into Microsoft Sentinel. The data connector is built on Microsoft Sentinel Codeless Connector Platform. It uses the SentinelOne API to fetch logs and it supports DCR-based [ingestion time transformations](https://docs.microsoft.com/azure/azure-monitor/logs/custom-logs-overview) that parses the received security data into a custom table so that queries don't need to parse it again, thus resulting in better performance.",
                    "graphQueries": [
                        {
                            "metricName": "Total activities logs received",
                            "legend": "SentinelOne Activities Logs",
                            "baseQuery": "SentinelOneActivities_CL"
                        },
                        {
                            "metricName": "Total agents logs received",
                            "legend": "SentinelOne Agents Logs",
                            "baseQuery": "SentinelOneAgents_CL"
                        },
                        {
                            "metricName": "Total groups logs received",
                            "legend": "SentinelOne Groups Logs",
                            "baseQuery": "SentinelOneGroups_CL"
                        },
                        {
                            "metricName": "Total threats logs received",
                            "legend": "SentinelOne Threats Logs",
                            "baseQuery": "SentinelOneThreats_CL"
                        },
                        {
                            "metricName": "Total alerts logs received",
                            "legend": "SentinelOne Alerts Logs",
                            "baseQuery": "SentinelOneAlerts_CL"
                        }
                    ],
                    "sampleQueries": [
                        {
                            "description": "Get Sample of SentinelOne activities logs",
                            "query": "SentinelOneActivities_CL| take 10"
                        },
                        {
                            "description": "Get Sample of SentinelOne groups logs",
                            "query": "SentinelOneGroups_CL| take 10"
                        },
                        {
                            "description": "Get Sample of SentinelOne threats logs",
                            "query": "SentinelOneThreats_CL| take 10"
                        },
                        {
                            "description": "Get Sample of SentinelOne agents logs",
                            "query": "SentinelOneAgents_CL| take 10"
                        },
                        {
                            "description": "Get Sample of SentinelOne alerts logs",
                            "query": "SentinelOneAlerts_CL| take 10"
                        }
                    ],
                    "dataTypes": [
                        {
                            "name": "SentinelOneActivities_CL",
                            "lastDataReceivedQuery": "SentinelOneActivities_CL\n       | where TimeGenerated > ago(12h)                | summarize Time = max(TimeGenerated)\n            | where isnotempty(Time)"
                        },
                        {
                            "name": "SentinelOneAgents_CL",
                            "lastDataReceivedQuery": "SentinelOneAgents_CL\n       | where TimeGenerated > ago(12h)                | summarize Time = max(TimeGenerated)\n            | where isnotempty(Time)"
                        },
                        {
                            "name": "SentinelOneGroups_CL",
                            "lastDataReceivedQuery": "SentinelOneGroups_CL\n       | where TimeGenerated > ago(12h)                | summarize Time = max(TimeGenerated)\n            | where isnotempty(Time)"
                        },
                        {
                            "name": "SentinelOneThreats_CL",
                            "lastDataReceivedQuery": "SentinelOneThreats_CL\n       | where TimeGenerated > ago(12h)                | summarize Time = max(TimeGenerated)\n            | where isnotempty(Time)"
                        },
                        {
                            "name": "SentinelOneAlerts_CL",
                            "lastDataReceivedQuery": "SentinelOneAlerts_CL\n       | where TimeGenerated > ago(12h)                | summarize Time = max(TimeGenerated)\n            | where isnotempty(Time)"
                        }
                    ],
                    "connectivityCriteria": [
                        {
                            "type": "HasDataConnectors"
                        }
                    ],
                    "availability": {
                        "status": 1,
                        "isPreview": false
                    },
                    "permissions": {
                        "resourceProvider": [
                            {
                                "provider": "Microsoft.OperationalInsights/workspaces",
                                "permissionsDisplayText": "Read and Write permissions are required.",
                                "providerDisplayName": "Workspace",
                                "scope": "Workspace",
                                "requiredPermissions": {
                                    "read": true,
                                    "write": true,
                                    "delete": true,
                                    "action": false
                                }
                            }
                        ]
                    },
                    "instructionSteps": [
                        {
                            "instructions": [
                                {
                                    "type": "Markdown",
                                    "parameters": {
                                        "content": "#### Configuration steps for the SentinelOne API \n Follow the instructions to obtain the credentials. You can also follow the [guide](https://usea1-nessat.sentinelone.net/docs/en/how-to-automate-api-token-generation.html#how-to-automate-api-token-generation) to generate API key."
                                    }
                                },
                                {
                                    "type": "Markdown",
                                    "parameters": {
                                        "content": "#### 1. Retrieve SentinelOne Management URL\n   1.1. Log in to the SentinelOne [**Management Console**] with Admin user credentials\n   1.2. In the [**Management Console**] copy the URL link above without the URL path."
                                    }
                                },
                                {
                                    "type": "Markdown",
                                    "parameters": {
                                        "content": "#### 2. Retrieve API Token\n   2.1. Log in to the SentinelOne [**Management Console**] with Admin user credentials\n 2.2. In the [**Management Console**], click [**Settings**]\n  2.3. In [**Settings**] view click on [**USERS**].\n   2.4. In the [**USERS**] Page click on [**Service Users**] -> [**Actions**] -> [**Create new service user**].\n   2.5. Choose [**Expiration date**] and [**scope**] (by site) and click on [**Create User**].\n   2.6. Once the [**Service User**] is created copy the [**API Token**] from page and press [**Save**]"
                                    }
                                },
                                {
                                    "parameters": {
                                        "label": "SentinelOne Management URL",
                                        "placeholder": "https://example.sentinelone.net/",
                                        "type": "text",
                                        "name": "managementUrl"
                                    },
                                    "type": "Textbox"
                                },
                                {
                                    "parameters": {
                                        "label": "API Token",
                                        "placeholder": "API Token",
                                        "type": "securestring",
                                        "name": "apitoken"
                                    },
                                    "type": "Textbox"
                                },
                                {
                                    "parameters": {
                                        "label": "toggle",
                                        "name": "toggle"
                                    },
                                    "type": "ConnectionToggleButton"
                                }
                            ]
                        }
                    ],
                    "isConnectivityCriteriasMatchSome": false
                }
            }
        },
        {
            "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('DataConnector-', 'SentinelOneCCP'))]",
            "apiVersion": "2022-01-01-preview",
            "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
            "properties": {
                "parentId": "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/dataConnectorDefinitions', 'SentinelOneCCP')]",
                "contentId": "SentinelOneCCP",
                "kind": "DataConnector",
                "version": "1.0.0",
                "source": {
                    "sourceId": "azuresentinel.azure-sentinel-solution-sentinelone",
                    "name": "SentinelOne",
                    "kind": "Solution"
                },
                "author": {
                    "name": "Microsoft",
                    "email": "support@microsoft.com"
                },
                "support": {
                    "name": "Microsoft Corporation",
                    "email": "support@microsoft.com",
                    "tier": "Microsoft",
                    "link": "https://support.microsoft.com"
                },
                "dependencies": {
                    "criteria": [
                        {
                            "version": "1.0.0",
                            "contentId": "SentinelOneCCPConnections",
                            "kind": "ResourcesDataConnector"
                        }
                    ]
                }
            }
        },
        {
            "type": "Microsoft.OperationalInsights/workspaces/providers/contentTemplates",
            "apiVersion": "2023-04-01-preview",
            "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/', concat(parameters('workspace'),'-dc-',uniquestring('SentinelOneCCPConnections')), '1.0.0')]",
            "location": "[parameters('workspace-location')]",
            "dependsOn": [
                "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/contentPackages', 'azuresentinel.azure-sentinel-solution-sentinelone')]"
            ],
            "properties": {
                "contentId": "SentinelOneCCPConnections",
                "displayName": "SentinelOne",
                "contentKind": "ResourcesDataConnector",
                "mainTemplate": {
                    "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
                    "contentVersion": "1.0.0",
                    "parameters": {
                        "connectorDefinitionName": {
                            "defaultValue": "SentinelOne",
                            "type": "string",
                            "minLength": 1
                        },
                        "workspace": {
                            "defaultValue": "[parameters('workspace')]",
                            "type": "string"
                        },
                        "dcrConfig": {
                            "defaultValue": {
                                "dataCollectionEndpoint": "data collection Endpoint",
                                "dataCollectionRuleImmutableId": "data collection rule immutableId"
                            },
                            "type": "object"
                        },
                        "managementUrl": {
                            "defaultValue": "managementUrl",
                            "type": "string",
                            "minLength": 1
                        },
                        "apitoken": {
                            "defaultValue": "apitoken",
                            "type": "securestring",
                            "minLength": 1
                        }
                    },
                    "variables": {
                        "_dataConnectorContentIdConnections1": "SentinelOneCCPConnections"
                    },
                    "resources": [
                        {
                            "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('DataConnector-', 'SentinelOneCCPConnections'))]",
                            "apiVersion": "2022-01-01-preview",
                            "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
                            "properties": {
                                "parentId": "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/dataConnectors', 'SentinelOneCCPConnections')]",
                                "contentId": "SentinelOneCCPConnections",
                                "kind": "ResourcesDataConnector",
                                "version": "1.0.0",
                                "source": {
                                    "sourceId": "azuresentinel.azure-sentinel-solution-sentinelone",
                                    "name": "SentinelOne",
                                    "kind": "Solution"
                                },
                                "author": {
                                    "name": "Microsoft",
                                    "email": "support@microsoft.com"
                                },
                                "support": {
                                    "name": "Microsoft Corporation",
                                    "email": "support@microsoft.com",
                                    "tier": "Microsoft",
                                    "link": "https://support.microsoft.com"
                                }
                            }
                        },
                        {
                            "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/', 'SentinelOnePoller_activities_created_events')]",
                            "apiVersion": "2023-02-01-preview",
                            "type": "Microsoft.OperationalInsights/workspaces/providers/dataConnectors",
                            "location": "[parameters('workspace-location')]",
                            "kind": "RestApiPoller",
                            "properties": {
                                "connectorDefinitionName": "SentinelOneCCP",
                                "dcrConfig": {
                                    "streamName": "Custom-SentinelOneActivities_API",
                                    "dataCollectionEndpoint": "[[parameters('dcrConfig').dataCollectionEndpoint]",
                                    "dataCollectionRuleImmutableId": "[[parameters('dcrConfig').dataCollectionRuleImmutableId]"
                                },
                                "dataType": "SentinelOne API",
                                "auth": {
                                    "type": "APIKey",
                                    "ApiKey": "[[parameters('apitoken')]",
                                    "ApiKeyName": "Authorization",
                                    "ApiKeyIdentifier": "ApiToken"
                                },
                                "request": {
                                    "apiEndpoint": "[[concat(parameters('managementUrl'), '/web/api/','v2.1', '/', 'activities')]",
                                    "rateLimitQPS": 10,
                                    "queryWindowInMin": 5,
                                    "httpMethod": "GET",
                                    "queryTimeFormat": "yyyy-MM-ddTHH:mm:ssZ",
                                    "queryParameters": {
                                        "createdAt__gt": "{_QueryWindowStartTime}",
                                        "createdAt__lt": "{_QueryWindowEndTime}"
                                    },
                                    "retryCount": 3,
                                    "timeoutInSeconds": 60,
                                    "headers": {
                                        "Accept": "application/json",
                                        "User-Agent": "Scuba"
                                    }
                                },
                                "paging": {
                                    "pagingType": "NextPageToken",
                                    "PageSize": "1000",
                                    "PageSizeParameterName": "limit",
                                    "NextPageTokenJsonPath": "$.pagination.nextCursor",
                                    "NextPageParaName": "cursor"
                                },
                                "response": {
                                    "eventsJsonPaths": [
                                        "$.data"
                                    ]
                                }
                            }
                        },
                        {
                            "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/', 'SentinelOnePoller_agents_created_events')]",
                            "apiVersion": "2023-02-01-preview",
                            "type": "Microsoft.OperationalInsights/workspaces/providers/dataConnectors",
                            "location": "[parameters('workspace-location')]",
                            "kind": "RestApiPoller",
                            "properties": {
                                "connectorDefinitionName": "SentinelOneCCP",
                                "dcrConfig": {
                                    "streamName": "Custom-SentinelOneAgents_API",
                                    "dataCollectionEndpoint": "[[parameters('dcrConfig').dataCollectionEndpoint]",
                                    "dataCollectionRuleImmutableId": "[[parameters('dcrConfig').dataCollectionRuleImmutableId]"
                                },
                                "dataType": "SentinelOne API",
                                "auth": {
                                    "type": "APIKey",
                                    "ApiKey": "[[parameters('apitoken')]",
                                    "ApiKeyName": "Authorization",
                                    "ApiKeyIdentifier": "ApiToken"
                                },
                                "request": {
                                    "apiEndpoint": "[[concat(parameters('managementUrl'), '/web/api/','v2.1', '/', 'agents')]",
                                    "rateLimitQPS": 10,
                                    "queryWindowInMin": 5,
                                    "httpMethod": "GET",
                                    "queryTimeFormat": "yyyy-MM-ddTHH:mm:ssZ",
                                    "queryParameters": {
                                        "createdAt__gt": "{_QueryWindowStartTime}",
                                        "createdAt__lt": "{_QueryWindowEndTime}"
                                    },
                                    "retryCount": 3,
                                    "timeoutInSeconds": 60,
                                    "headers": {
                                        "Accept": "application/json",
                                        "User-Agent": "Scuba"
                                    }
                                },
                                "paging": {
                                    "pagingType": "NextPageToken",
                                    "PageSize": "1000",
                                    "PageSizeParameterName": "limit",
                                    "NextPageTokenJsonPath": "$.pagination.nextCursor",
                                    "NextPageParaName": "cursor"
                                },
                                "response": {
                                    "eventsJsonPaths": [
                                        "$.data"
                                    ]
                                }
                            }
                        },
                        {
                            "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/', 'SentinelOnePoller_agents_updated_events')]",
                            "apiVersion": "2023-02-01-preview",
                            "type": "Microsoft.OperationalInsights/workspaces/providers/dataConnectors",
                            "location": "[parameters('workspace-location')]",
                            "kind": "RestApiPoller",
                            "properties": {
                                "connectorDefinitionName": "SentinelOneCCP",
                                "dcrConfig": {
                                    "streamName": "Custom-SentinelOneAgents_API",
                                    "dataCollectionEndpoint": "[[parameters('dcrConfig').dataCollectionEndpoint]",
                                    "dataCollectionRuleImmutableId": "[[parameters('dcrConfig').dataCollectionRuleImmutableId]"
                                },
                                "dataType": "SentinelOne API",
                                "auth": {
                                    "type": "APIKey",
                                    "ApiKey": "[[parameters('apitoken')]",
                                    "ApiKeyName": "Authorization",
                                    "ApiKeyIdentifier": "ApiToken"
                                },
                                "request": {
                                    "apiEndpoint": "[[concat(parameters('managementUrl'), '/web/api/','v2.1', '/', 'agents')]",
                                    "rateLimitQPS": 10,
                                    "queryWindowInMin": 5,
                                    "httpMethod": "GET",
                                    "queryTimeFormat": "yyyy-MM-ddTHH:mm:ssZ",
                                    "queryParameters": {
                                        "updatedAt__gt": "{_QueryWindowStartTime}",
                                        "updatedAt__lt": "{_QueryWindowEndTime}"
                                    },
                                    "retryCount": 3,
                                    "timeoutInSeconds": 60,
                                    "headers": {
                                        "Accept": "application/json",
                                        "User-Agent": "Scuba"
                                    }
                                },
                                "paging": {
                                    "pagingType": "NextPageToken",
                                    "PageSize": "200",
                                    "PageSizeParameterName": "limit",
                                    "NextPageTokenJsonPath": "$.pagination.nextCursor",
                                    "NextPageParaName": "cursor"
                                },
                                "response": {
                                    "eventsJsonPaths": [
                                        "$.data"
                                    ]
                                }
                            }
                        },
                        {
                            "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/', 'SentinelOnePoller_alerts_created_events')]",
                            "apiVersion": "2023-02-01-preview",
                            "type": "Microsoft.OperationalInsights/workspaces/providers/dataConnectors",
                            "location": "[parameters('workspace-location')]",
                            "kind": "RestApiPoller",
                            "properties": {
                                "connectorDefinitionName": "SentinelOneCCP",
                                "dcrConfig": {
                                    "streamName": "Custom-SentinelOneAlerts_API",
                                    "dataCollectionEndpoint": "[[parameters('dcrConfig').dataCollectionEndpoint]",
                                    "dataCollectionRuleImmutableId": "[[parameters('dcrConfig').dataCollectionRuleImmutableId]"
                                },
                                "dataType": "SentinelOne API",
                                "auth": {
                                    "type": "APIKey",
                                    "ApiKey": "[[parameters('apitoken')]",
                                    "ApiKeyName": "Authorization",
                                    "ApiKeyIdentifier": "ApiToken"
                                },
                                "request": {
                                    "apiEndpoint": "[[concat(parameters('managementUrl'), '/web/api/','v2.1', '/', 'cloud-detection/alerts')]",
                                    "rateLimitQPS": 10,
                                    "queryWindowInMin": 5,
                                    "httpMethod": "GET",
                                    "queryTimeFormat": "yyyy-MM-ddTHH:mm:ssZ",
                                    "queryParameters": {
                                        "createdAt__gt": "{_QueryWindowStartTime}",
                                        "createdAt__lt": "{_QueryWindowEndTime}"
                                    },
                                    "retryCount": 3,
                                    "timeoutInSeconds": 60,
                                    "headers": {
                                        "Accept": "application/json",
                                        "User-Agent": "Scuba"
                                    }
                                },
                                "paging": {
                                    "pagingType": "NextPageToken",
                                    "PageSize": "1000",
                                    "PageSizeParameterName": "limit",
                                    "NextPageTokenJsonPath": "$.pagination.nextCursor",
                                    "NextPageParaName": "cursor"
                                },
                                "response": {
                                    "eventsJsonPaths": [
                                        "$.data"
                                    ]
                                }
                            }
                        },
                        {
                            "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/', 'SentinelOnePoller_groups_updated_events')]",
                            "apiVersion": "2023-02-01-preview",
                            "type": "Microsoft.OperationalInsights/workspaces/providers/dataConnectors",
                            "location": "[parameters('workspace-location')]",
                            "kind": "RestApiPoller",
                            "properties": {
                                "connectorDefinitionName": "SentinelOneCCP",
                                "dcrConfig": {
                                    "streamName": "Custom-SentinelOneGroups_API",
                                    "dataCollectionEndpoint": "[[parameters('dcrConfig').dataCollectionEndpoint]",
                                    "dataCollectionRuleImmutableId": "[[parameters('dcrConfig').dataCollectionRuleImmutableId]"
                                },
                                "dataType": "SentinelOne API",
                                "auth": {
                                    "type": "APIKey",
                                    "ApiKey": "[[parameters('apitoken')]",
                                    "ApiKeyName": "Authorization",
                                    "ApiKeyIdentifier": "ApiToken"
                                },
                                "request": {
                                    "apiEndpoint": "[[concat(parameters('managementUrl'), '/web/api/','v2.1', '/', 'groups')]",
                                    "rateLimitQPS": 10,
                                    "queryWindowInMin": 5,
                                    "httpMethod": "GET",
                                    "queryTimeFormat": "yyyy-MM-ddTHH:mm:ssZ",
                                    "queryParameters": {
                                        "updatedAt__gt": "{_QueryWindowStartTime}",
                                        "updatedAt__lt": "{_QueryWindowEndTime}"
                                    },
                                    "retryCount": 3,
                                    "timeoutInSeconds": 60,
                                    "headers": {
                                        "Accept": "application/json",
                                        "User-Agent": "Scuba"
                                    }
                                },
                                "paging": {
                                    "pagingType": "NextPageToken",
                                    "PageSize": "200",
                                    "PageSizeParameterName": "limit",
                                    "NextPageTokenJsonPath": "$.pagination.nextCursor",
                                    "NextPageParaName": "cursor"
                                },
                                "response": {
                                    "eventsJsonPaths": [
                                        "$.data"
                                    ]
                                }
                            }
                        },
                        {
                            "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/', 'SentinelOnePoller_threats_created_events')]",
                            "apiVersion": "2023-02-01-preview",
                            "type": "Microsoft.OperationalInsights/workspaces/providers/dataConnectors",
                            "location": "[parameters('workspace-location')]",
                            "kind": "RestApiPoller",
                            "properties": {
                                "connectorDefinitionName": "SentinelOneCCP",
                                "dcrConfig": {
                                    "streamName": "Custom-SentinelOneThreats_API",
                                    "dataCollectionEndpoint": "[[parameters('dcrConfig').dataCollectionEndpoint]",
                                    "dataCollectionRuleImmutableId": "[[parameters('dcrConfig').dataCollectionRuleImmutableId]"
                                },
                                "dataType": "SentinelOne API",
                                "auth": {
                                    "type": "APIKey",
                                    "ApiKey": "[[parameters('apitoken')]",
                                    "ApiKeyName": "Authorization",
                                    "ApiKeyIdentifier": "ApiToken"
                                },
                                "request": {
                                    "apiEndpoint": "[[concat(parameters('managementUrl'), '/web/api/','v2.1', '/', 'threats')]",
                                    "rateLimitQPS": 10,
                                    "queryWindowInMin": 5,
                                    "httpMethod": "GET",
                                    "queryTimeFormat": "yyyy-MM-ddTHH:mm:ssZ",
                                    "queryParameters": {
                                        "createdAt__gt": "{_QueryWindowStartTime}",
                                        "createdAt__lt": "{_QueryWindowEndTime}"
                                    },
                                    "retryCount": 3,
                                    "timeoutInSeconds": 60,
                                    "headers": {
                                        "Accept": "application/json",
                                        "User-Agent": "Scuba"
                                    }
                                },
                                "paging": {
                                    "pagingType": "NextPageToken",
                                    "PageSize": "1000",
                                    "PageSizeParameterName": "limit",
                                    "NextPageTokenJsonPath": "$.pagination.nextCursor",
                                    "NextPageParaName": "cursor"
                                },
                                "response": {
                                    "eventsJsonPaths": [
                                        "$.data"
                                    ]
                                }
                            }
                        },
                        {
                            "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/', 'SentinelOnePoller_threats_updated_events')]",
                            "apiVersion": "2023-02-01-preview",
                            "type": "Microsoft.OperationalInsights/workspaces/providers/dataConnectors",
                            "location": "[parameters('workspace-location')]",
                            "kind": "RestApiPoller",
                            "properties": {
                                "connectorDefinitionName": "SentinelOneCCP",
                                "dcrConfig": {
                                    "streamName": "Custom-SentinelOneThreats_API",
                                    "dataCollectionEndpoint": "[[parameters('dcrConfig').dataCollectionEndpoint]",
                                    "dataCollectionRuleImmutableId": "[[parameters('dcrConfig').dataCollectionRuleImmutableId]"
                                },
                                "dataType": "SentinelOne API",
                                "auth": {
                                    "type": "APIKey",
                                    "ApiKey": "[[parameters('apitoken')]",
                                    "ApiKeyName": "Authorization",
                                    "ApiKeyIdentifier": "ApiToken"
                                },
                                "request": {
                                    "apiEndpoint": "[[concat(parameters('managementUrl'), '/web/api/','v2.1', '/', 'threats')]",
                                    "rateLimitQPS": 10,
                                    "queryWindowInMin": 5,
                                    "httpMethod": "GET",
                                    "queryTimeFormat": "yyyy-MM-ddTHH:mm:ssZ",
                                    "queryParameters": {
                                        "updatedAt__gt": "{_QueryWindowStartTime}",
                                        "updatedAt__lt": "{_QueryWindowEndTime}"
                                    },
                                    "retryCount": 3,
                                    "timeoutInSeconds": 60,
                                    "headers": {
                                        "Accept": "application/json",
                                        "User-Agent": "Scuba"
                                    }
                                },
                                "paging": {
                                    "pagingType": "NextPageToken",
                                    "PageSize": "200",
                                    "PageSizeParameterName": "limit",
                                    "NextPageTokenJsonPath": "$.pagination.nextCursor",
                                    "NextPageParaName": "cursor"
                                },
                                "response": {
                                    "eventsJsonPaths": [
                                        "$.data"
                                    ]
                                }
                            }
                        }
                    ]
                },
                "packageKind": "Solution",
                "packageVersion": "3.0.6",
                "packageName": "SentinelOne",
                "contentProductId": "azuresentinel.azure-sentinel-solution-sentinelone-rdc-ooli7lyno5ceo",
                "packageId": "azuresentinel.azure-sentinel-solution-sentinelone",
                "contentSchemaVersion": "3.0.0",
                "version": "1.0.0",
                "id": "azuresentinel.azure-sentinel-solution-sentinelone-rdc-ooli7lyno5ceo",
                "isDeprecated": false,
                "description": ""
            }
        },
        {
            "type": "Microsoft.OperationalInsights/workspaces/providers/contentTemplates",
            "apiVersion": "2023-04-01-preview",
            "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat(parameters('workspace'),'-dc-',uniquestring('SentinelOne')))]",
            "location": "[parameters('workspace-location')]",
            "dependsOn": [
                "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/contentPackages', 'azuresentinel.azure-sentinel-solution-sentinelone')]"
            ],
            "properties": {
                "description": "The [SentinelOne](https://www.sentinelone.com/) data connector provides the capability to ingest common SentinelOne server objects such as Threats. Agents. Applications. Activities. Policies. Groups. and more events into Microsoft Sentinel through the REST API. Refer to API documentation: `https://.sentinelone.net/api-doc/overview` for more information. The connector provides ability to get events which helps to examine potential security risks. analyze your team's use of collaboration. diagnose configuration problems and more.",
                "mainTemplate": {
                    "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
                    "contentVersion": "1.0.0",
                    "parameters": {},
                    "variables": {},
                    "resources": [
                        {
                            "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/','SentinelOne')]",
                            "apiVersion": "2021-03-01-preview",
                            "type": "Microsoft.OperationalInsights/workspaces/providers/dataConnectors",
                            "location": "[parameters('workspace-location')]",
                            "kind": "GenericUI",
                            "properties": {
                                "connectorUiConfig": {
                                    "id": "SentinelOne",
                                    "title": "SentinelOne (using Azure Functions)",
                                    "publisher": "SentinelOne",
                                    "descriptionMarkdown": "The [SentinelOne](https://www.sentinelone.com/) data connector provides the capability to ingest common SentinelOne server objects such as Threats, Agents, Applications, Activities, Policies, Groups, and more events into Microsoft Sentinel through the REST API. Refer to API documentation: `https://<SOneInstanceDomain>.sentinelone.net/api-doc/overview` for more information. The connector provides ability to get events which helps to examine potential security risks, analyze your team's use of collaboration, diagnose configuration problems and more.",
                                    "additionalRequirementBanner": "These queries are dependent on a parser based on a Kusto Function deployed as part of the solution.",
                                    "graphQueries": [
                                        {
                                            "metricName": "Total data received",
                                            "legend": "SentinelOne_CL",
                                            "baseQuery": "SentinelOne_CL"
                                        }
                                    ],
                                    "sampleQueries": [
                                        {
                                            "description": "SentinelOne Events - All Activities.",
                                            "query": "SentinelOne\n | sort by TimeGenerated desc"
                                        }
                                    ],
                                    "dataTypes": [
                                        {
                                            "name": "SentinelOne_CL",
                                            "lastDataReceivedQuery": "SentinelOne_CL\n            | summarize Time = max(TimeGenerated)\n            | where isnotempty(Time)"
                                        }
                                    ],
                                    "connectivityCriterias": [
                                        {
                                            "type": "IsConnectedQuery",
                                            "value": [
                                                "SentinelOne_CL\n            | summarize LastLogReceived = max(TimeGenerated)\n            | project IsConnected = LastLogReceived > ago(30d)"
                                            ]
                                        }
                                    ],
                                    "availability": {
                                        "status": 1,
                                        "isPreview": false
                                    },
                                    "permissions": {
                                        "resourceProvider": [
                                            {
                                                "provider": "Microsoft.OperationalInsights/workspaces",
                                                "permissionsDisplayText": "read and write permissions on the workspace are required.",
                                                "providerDisplayName": "Workspace",
                                                "scope": "Workspace",
                                                "requiredPermissions": {
                                                    "write": true,
                                                    "read": true,
                                                    "delete": true
                                                }
                                            },
                                            {
                                                "provider": "Microsoft.OperationalInsights/workspaces/sharedKeys",
                                                "permissionsDisplayText": "read permissions to shared keys for the workspace are required. [See the documentation to learn more about workspace keys](https://docs.microsoft.com/azure/azure-monitor/platform/agent-windows#obtain-workspace-id-and-key).",
                                                "providerDisplayName": "Keys",
                                                "scope": "Workspace",
                                                "requiredPermissions": {
                                                    "action": true
                                                }
                                            }
                                        ],
                                        "customs": [
                                            {
                                                "name": "Microsoft.Web/sites permissions",
                                                "description": "Read and write permissions to Azure Functions to create a Function App is required. [See the documentation to learn more about Azure Functions](https://docs.microsoft.com/azure/azure-functions/)."
                                            },
                                            {
                                                "name": "REST API Credentials/permissions",
                                                "description": "**SentinelOneAPIToken** is required.  See the documentation to learn more about API on the `https://<SOneInstanceDomain>.sentinelone.net/api-doc/overview`."
                                            }
                                        ]
                                    },
                                    "instructionSteps": [
                                        {
                                            "description": ">**NOTE:** This connector uses Azure Functions to connect to the SentinelOne API to pull its logs into Microsoft Sentinel. This might result in additional data ingestion costs. Check the [Azure Functions pricing page](https://azure.microsoft.com/pricing/details/functions/) for details."
                                        },
                                        {
                                            "description": ">**(Optional Step)** Securely store workspace and API authorization key(s) or token(s) in Azure Key Vault. Azure Key Vault provides a secure mechanism to store and retrieve key values. [Follow these instructions](https://docs.microsoft.com/azure/app-service/app-service-key-vault-references) to use Azure Key Vault with an Azure Function App."
                                        },
                                        {
                                            "description": ">**NOTE:** This data connector depends on a parser based on a Kusto Function to work as expected which is deployed as part of the solution. To view the function code in Log Analytics, open Log Analytics/Microsoft Sentinel Logs blade, click Functions and search for the alias SentinelOne and load the function code or click [here](https://github.com/Azure/Azure-Sentinel/blob/master/Solutions/SentinelOne/Parsers/SentinelOne.txt). The function usually takes 10-15 minutes to activate after solution installation/update."
                                        },
                                        {
                                            "description": "**STEP 1 - Configuration steps for the SentinelOne API**\n\n Follow the instructions to obtain the credentials.\n\n1. Log in to the SentinelOne Management Console with Admin user credentials.\n2. In the Management Console, click **Settings**.\n3. In the **SETTINGS** view, click **USERS**\n4. Click **New User**.\n5. Enter the information for the new console user.\n5. In Role, select **Admin**.\n6. Click **SAVE**\n7. Save credentials of the new user for using in the data connector."
                                        },
                                        {
                                            "description": "**NOTE :-** Admin access can be delegated using custom roles. Please review SentinelOne [documentation](https://www.sentinelone.com/blog/feature-spotlight-fully-custom-role-based-access-control/) to learn more about custom RBAC."
                                        },
                                        {
                                            "description": "**STEP 2 - Choose ONE from the following two deployment options to deploy the connector and the associated Azure Function**\n\n>**IMPORTANT:** Before deploying the SentinelOne data connector, have the Workspace ID and Workspace Primary Key (can be copied from the following).",
                                            "instructions": [
                                                {
                                                    "parameters": {
                                                        "fillWith": [
                                                            "WorkspaceId"
                                                        ],
                                                        "label": "Workspace ID"
                                                    },
                                                    "type": "CopyableLabel"
                                                },
                                                {
                                                    "parameters": {
                                                        "fillWith": [
                                                            "PrimaryKey"
                                                        ],
                                                        "label": "Primary Key"
                                                    },
                                                    "type": "CopyableLabel"
                                                }
                                            ]
                                        },
                                        {
                                            "description": "Use this method for automated deployment of the SentinelOne Audit data connector using an ARM Tempate.\n\n1. Click the **Deploy to Azure** button below. \n\n\t[![Deploy To Azure](https://aka.ms/deploytoazurebutton)](https://aka.ms/sentinel-SentinelOneAPI-azuredeploy) [![Deploy to Azure Gov](https://aka.ms/deploytoazuregovbutton)](https://aka.ms/sentinel-SentinelOneAPI-azuredeploy-gov)\n2. Select the preferred **Subscription**, **Resource Group** and **Location**. \n> **NOTE:** Within the same resource group, you can't mix Windows and Linux apps in the same region. Select existing resource group without Windows apps in it or create new resource group.\n3. Enter the **SentinelOneAPIToken**, **SentinelOneUrl** `(https://<SOneInstanceDomain>.sentinelone.net)` and deploy. \n4. Mark the checkbox labeled **I agree to the terms and conditions stated above**. \n5. Click **Purchase** to deploy.",
                                            "title": "Option 1 - Azure Resource Manager (ARM) Template"
                                        },
                                        {
                                            "description": "Use the following step-by-step instructions to deploy the SentinelOne Reports data connector manually with Azure Functions (Deployment via Visual Studio Code).",
                                            "title": "Option 2 - Manual Deployment of Azure Functions"
                                        },
                                        {
                                            "description": "**1. Deploy a Function App**\n\n> **NOTE:** You will need to [prepare VS code](https://docs.microsoft.com/azure/azure-functions/functions-create-first-function-python#prerequisites) for Azure function development.\n\n1. Download the [Azure Function App](https://aka.ms/sentinel-SentinelOneAPI-functionapp) file. Extract archive to your local development computer.\n2. Start VS Code. Choose File in the main menu and select Open Folder.\n3. Select the top level folder from extracted files.\n4. Choose the Azure icon in the Activity bar, then in the **Azure: Functions** area, choose the **Deploy to function app** button.\nIf you aren't already signed in, choose the Azure icon in the Activity bar, then in the **Azure: Functions** area, choose **Sign in to Azure**\nIf you're already signed in, go to the next step.\n5. Provide the following information at the prompts:\n\n\ta. **Select folder:** Choose a folder from your workspace or browse to one that contains your function app.\n\n\tb. **Select Subscription:** Choose the subscription to use.\n\n\tc. Select **Create new Function App in Azure** (Don't choose the Advanced option)\n\n\td. **Enter a globally unique name for the function app:** Type a name that is valid in a URL path. The name you type is validated to make sure that it's unique in Azure Functions. (e.g. SOneXXXXX).\n\n\te. **Select a runtime:** Choose Python 3.11.\n\n\tf. Select a location for new resources. For better performance and lower costs choose the same [region](https://azure.microsoft.com/regions/) where Microsoft Sentinel is located.\n\n6. Deployment will begin. A notification is displayed after your function app is created and the deployment package is applied.\n7. Go to Azure Portal for the Function App configuration."
                                        },
                                        {
                                            "description": "**2. Configure the Function App**\n\n 1. In the Function App, select the Function App Name and select **Configuration**.\n\n 2. In the **Application settings** tab, select ** New application setting**.\n\n 3. Add each of the following application settings individually, with their respective string values (case-sensitive): \n\t\t SentinelOneAPIToken\n\t\t SentinelOneUrl\n\t\t WorkspaceID\n\t\t WorkspaceKey\n\t\t logAnalyticsUri (optional)\n\n> - Use logAnalyticsUri to override the log analytics API endpoint for dedicated cloud. For example, for public cloud, leave the value empty; for Azure GovUS cloud environment, specify the value in the following format: `https://<CustomerId>.ods.opinsights.azure.us`.\n\n 4. Once all application settings have been entered, click **Save**."
                                        }
                                    ]
                                }
                            }
                        },
                        {
                            "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
                            "apiVersion": "2023-04-01-preview",
                            "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('DataConnector-', last(split(extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/dataConnectors', 'SentinelOne'),'/'))))]",
                            "properties": {
                                "parentId": "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/dataConnectors', 'SentinelOne')]",
                                "contentId": "SentinelOne",
                                "kind": "DataConnector",
                                "version": "1.0.0",
                                "source": {
                                    "kind": "Solution",
                                    "name": "SentinelOne",
                                    "sourceId": "azuresentinel.azure-sentinel-solution-sentinelone"
                                },
                                "author": {
                                    "name": "Microsoft",
                                    "email": "support@microsoft.com"
                                },
                                "support": {
                                    "name": "Microsoft Corporation",
                                    "email": "support@microsoft.com",
                                    "tier": "Microsoft",
                                    "link": "https://support.microsoft.com"
                                }
                            }
                        }
                    ]
                },
                "packageKind": "Solution",
                "packageVersion": "3.0.6",
                "packageName": "SentinelOne",
                "packageId": "azuresentinel.azure-sentinel-solution-sentinelone",
                "contentSchemaVersion": "3.0.0",
                "contentId": "SentinelOne",
                "contentKind": "DataConnector",
                "displayName": "SentinelOne (using Azure Functions)",
                "contentProductId": "azuresentinel.azure-sentinel-solution-sentinelone-dc-g2abyuk6lyd6s",
                "id": "azuresentinel.azure-sentinel-solution-sentinelone-dc-g2abyuk6lyd6s",
                "version": "1.0.0",
                "isDeprecated": false
            }
        },
        {
            "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
            "apiVersion": "2023-04-01-preview",
            "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('DataConnector-', last(split(extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/dataConnectors', 'SentinelOne'),'/'))))]",
            "dependsOn": [
                "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/dataConnectors', 'SentinelOne')]"
            ],
            "location": "[parameters('workspace-location')]",
            "properties": {
                "parentId": "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/dataConnectors', 'SentinelOne')]",
                "contentId": "SentinelOne",
                "kind": "DataConnector",
                "version": "1.0.0",
                "source": {
                    "kind": "Solution",
                    "name": "SentinelOne",
                    "sourceId": "azuresentinel.azure-sentinel-solution-sentinelone"
                },
                "author": {
                    "name": "Microsoft",
                    "email": "support@microsoft.com"
                },
                "support": {
                    "name": "Microsoft Corporation",
                    "email": "support@microsoft.com",
                    "tier": "Microsoft",
                    "link": "https://support.microsoft.com"
                }
            }
        },
        {
            "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/','SentinelOne')]",
            "apiVersion": "2021-03-01-preview",
            "type": "Microsoft.OperationalInsights/workspaces/providers/dataConnectors",
            "location": "[parameters('workspace-location')]",
            "kind": "GenericUI",
            "properties": {
                "connectorUiConfig": {
                    "title": "SentinelOne (using Azure Functions)",
                    "publisher": "SentinelOne",
                    "descriptionMarkdown": "The [SentinelOne](https://www.sentinelone.com/) data connector provides the capability to ingest common SentinelOne server objects such as Threats, Agents, Applications, Activities, Policies, Groups, and more events into Microsoft Sentinel through the REST API. Refer to API documentation: `https://<SOneInstanceDomain>.sentinelone.net/api-doc/overview` for more information. The connector provides ability to get events which helps to examine potential security risks, analyze your team's use of collaboration, diagnose configuration problems and more.",
                    "graphQueries": [
                        {
                            "metricName": "Total data received",
                            "legend": "SentinelOne_CL",
                            "baseQuery": "SentinelOne_CL"
                        }
                    ],
                    "dataTypes": [
                        {
                            "name": "SentinelOne_CL",
                            "lastDataReceivedQuery": "SentinelOne_CL\n            | summarize Time = max(TimeGenerated)\n            | where isnotempty(Time)"
                        }
                    ],
                    "connectivityCriterias": [
                        {
                            "type": "IsConnectedQuery",
                            "value": [
                                "SentinelOne_CL\n            | summarize LastLogReceived = max(TimeGenerated)\n            | project IsConnected = LastLogReceived > ago(30d)"
                            ]
                        }
                    ],
                    "sampleQueries": [
                        {
                            "description": "SentinelOne Events - All Activities.",
                            "query": "SentinelOne\n | sort by TimeGenerated desc"
                        }
                    ],
                    "availability": {
                        "status": 1,
                        "isPreview": false
                    },
                    "permissions": {
                        "resourceProvider": [
                            {
                                "provider": "Microsoft.OperationalInsights/workspaces",
                                "permissionsDisplayText": "read and write permissions on the workspace are required.",
                                "providerDisplayName": "Workspace",
                                "scope": "Workspace",
                                "requiredPermissions": {
                                    "write": true,
                                    "read": true,
                                    "delete": true
                                }
                            },
                            {
                                "provider": "Microsoft.OperationalInsights/workspaces/sharedKeys",
                                "permissionsDisplayText": "read permissions to shared keys for the workspace are required. [See the documentation to learn more about workspace keys](https://docs.microsoft.com/azure/azure-monitor/platform/agent-windows#obtain-workspace-id-and-key).",
                                "providerDisplayName": "Keys",
                                "scope": "Workspace",
                                "requiredPermissions": {
                                    "action": true
                                }
                            }
                        ],
                        "customs": [
                            {
                                "name": "Microsoft.Web/sites permissions",
                                "description": "Read and write permissions to Azure Functions to create a Function App is required. [See the documentation to learn more about Azure Functions](https://docs.microsoft.com/azure/azure-functions/)."
                            },
                            {
                                "name": "REST API Credentials/permissions",
                                "description": "**SentinelOneAPIToken** is required.  See the documentation to learn more about API on the `https://<SOneInstanceDomain>.sentinelone.net/api-doc/overview`."
                            }
                        ]
                    },
                    "instructionSteps": [
                        {
                            "description": ">**NOTE:** This connector uses Azure Functions to connect to the SentinelOne API to pull its logs into Microsoft Sentinel. This might result in additional data ingestion costs. Check the [Azure Functions pricing page](https://azure.microsoft.com/pricing/details/functions/) for details."
                        },
                        {
                            "description": ">**(Optional Step)** Securely store workspace and API authorization key(s) or token(s) in Azure Key Vault. Azure Key Vault provides a secure mechanism to store and retrieve key values. [Follow these instructions](https://docs.microsoft.com/azure/app-service/app-service-key-vault-references) to use Azure Key Vault with an Azure Function App."
                        },
                        {
                            "description": ">**NOTE:** This data connector depends on a parser based on a Kusto Function to work as expected which is deployed as part of the solution. To view the function code in Log Analytics, open Log Analytics/Microsoft Sentinel Logs blade, click Functions and search for the alias SentinelOne and load the function code or click [here](https://github.com/Azure/Azure-Sentinel/blob/master/Solutions/SentinelOne/Parsers/SentinelOne.txt). The function usually takes 10-15 minutes to activate after solution installation/update."
                        },
                        {
                            "description": "**STEP 1 - Configuration steps for the SentinelOne API**\n\n Follow the instructions to obtain the credentials.\n\n1. Log in to the SentinelOne Management Console with Admin user credentials.\n2. In the Management Console, click **Settings**.\n3. In the **SETTINGS** view, click **USERS**\n4. Click **New User**.\n5. Enter the information for the new console user.\n5. In Role, select **Admin**.\n6. Click **SAVE**\n7. Save credentials of the new user for using in the data connector."
                        },
                        {
                            "description": "**NOTE :-** Admin access can be delegated using custom roles. Please review SentinelOne [documentation](https://www.sentinelone.com/blog/feature-spotlight-fully-custom-role-based-access-control/) to learn more about custom RBAC."
                        },
                        {
                            "description": "**STEP 2 - Choose ONE from the following two deployment options to deploy the connector and the associated Azure Function**\n\n>**IMPORTANT:** Before deploying the SentinelOne data connector, have the Workspace ID and Workspace Primary Key (can be copied from the following).",
                            "instructions": [
                                {
                                    "parameters": {
                                        "fillWith": [
                                            "WorkspaceId"
                                        ],
                                        "label": "Workspace ID"
                                    },
                                    "type": "CopyableLabel"
                                },
                                {
                                    "parameters": {
                                        "fillWith": [
                                            "PrimaryKey"
                                        ],
                                        "label": "Primary Key"
                                    },
                                    "type": "CopyableLabel"
                                }
                            ]
                        },
                        {
                            "description": "Use this method for automated deployment of the SentinelOne Audit data connector using an ARM Tempate.\n\n1. Click the **Deploy to Azure** button below. \n\n\t[![Deploy To Azure](https://aka.ms/deploytoazurebutton)](https://aka.ms/sentinel-SentinelOneAPI-azuredeploy) [![Deploy to Azure Gov](https://aka.ms/deploytoazuregovbutton)](https://aka.ms/sentinel-SentinelOneAPI-azuredeploy-gov)\n2. Select the preferred **Subscription**, **Resource Group** and **Location**. \n> **NOTE:** Within the same resource group, you can't mix Windows and Linux apps in the same region. Select existing resource group without Windows apps in it or create new resource group.\n3. Enter the **SentinelOneAPIToken**, **SentinelOneUrl** `(https://<SOneInstanceDomain>.sentinelone.net)` and deploy. \n4. Mark the checkbox labeled **I agree to the terms and conditions stated above**. \n5. Click **Purchase** to deploy.",
                            "title": "Option 1 - Azure Resource Manager (ARM) Template"
                        },
                        {
                            "description": "Use the following step-by-step instructions to deploy the SentinelOne Reports data connector manually with Azure Functions (Deployment via Visual Studio Code).",
                            "title": "Option 2 - Manual Deployment of Azure Functions"
                        },
                        {
                            "description": "**1. Deploy a Function App**\n\n> **NOTE:** You will need to [prepare VS code](https://docs.microsoft.com/azure/azure-functions/functions-create-first-function-python#prerequisites) for Azure function development.\n\n1. Download the [Azure Function App](https://aka.ms/sentinel-SentinelOneAPI-functionapp) file. Extract archive to your local development computer.\n2. Start VS Code. Choose File in the main menu and select Open Folder.\n3. Select the top level folder from extracted files.\n4. Choose the Azure icon in the Activity bar, then in the **Azure: Functions** area, choose the **Deploy to function app** button.\nIf you aren't already signed in, choose the Azure icon in the Activity bar, then in the **Azure: Functions** area, choose **Sign in to Azure**\nIf you're already signed in, go to the next step.\n5. Provide the following information at the prompts:\n\n\ta. **Select folder:** Choose a folder from your workspace or browse to one that contains your function app.\n\n\tb. **Select Subscription:** Choose the subscription to use.\n\n\tc. Select **Create new Function App in Azure** (Don't choose the Advanced option)\n\n\td. **Enter a globally unique name for the function app:** Type a name that is valid in a URL path. The name you type is validated to make sure that it's unique in Azure Functions. (e.g. SOneXXXXX).\n\n\te. **Select a runtime:** Choose Python 3.11.\n\n\tf. Select a location for new resources. For better performance and lower costs choose the same [region](https://azure.microsoft.com/regions/) where Microsoft Sentinel is located.\n\n6. Deployment will begin. A notification is displayed after your function app is created and the deployment package is applied.\n7. Go to Azure Portal for the Function App configuration."
                        },
                        {
                            "description": "**2. Configure the Function App**\n\n 1. In the Function App, select the Function App Name and select **Configuration**.\n\n 2. In the **Application settings** tab, select ** New application setting**.\n\n 3. Add each of the following application settings individually, with their respective string values (case-sensitive): \n\t\t SentinelOneAPIToken\n\t\t SentinelOneUrl\n\t\t WorkspaceID\n\t\t WorkspaceKey\n\t\t logAnalyticsUri (optional)\n\n> - Use logAnalyticsUri to override the log analytics API endpoint for dedicated cloud. For example, for public cloud, leave the value empty; for Azure GovUS cloud environment, specify the value in the following format: `https://<CustomerId>.ods.opinsights.azure.us`.\n\n 4. Once all application settings have been entered, click **Save**."
                        }
                    ],
                    "id": "SentinelOne",
                    "additionalRequirementBanner": "These queries are dependent on a parser based on a Kusto Function deployed as part of the solution."
                }
            }
        },
        {
            "type": "Microsoft.OperationalInsights/workspaces/providers/contentTemplates",
            "apiVersion": "2023-04-01-preview",
            "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat(parameters('workspace'),'-wb-',uniquestring('SentinelOneWorkbook')))]",
            "location": "[parameters('workspace-location')]",
            "dependsOn": [
                "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/contentPackages', 'azuresentinel.azure-sentinel-solution-sentinelone')]"
            ],
            "properties": {
                "description": "Sets the time name for analysis.",
                "mainTemplate": {
                    "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
                    "contentVersion": "1.0.0",
                    "parameters": {},
                    "variables": {},
                    "resources": [
                        {
                            "type": "Microsoft.Insights/workbooks",
                            "name": "SentinelOneWorkbook",
                            "location": "[parameters('workspace-location')]",
                            "kind": "shared",
                            "apiVersion": "2021-08-01",
                            "metadata": {
                                "description": "Sets the time name for analysis."
                            },
                            "properties": {
                                "displayName": "SentinelOneWorkbook",
                                "serializedData": "{\"version\":\"Notebook/1.0\",\"items\":[{\"type\":1,\"content\":{\"json\":\"**NOTE**: This data connector depends on a parser based on Kusto Function **SentinelOne** to work as expected. [Follow steps to get this Kusto Function](https://aka.ms/sentinel-sentinelone-parser)\"},\"name\":\"text - 8\"},{\"type\":9,\"content\":{\"version\":\"KqlParameterItem/1.0\",\"parameters\":[{\"id\":\"cd8447d9-b096-4673-92d8-2a1e8291a125\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"TimeRange\",\"type\":4,\"description\":\"Sets the time name for analysis\",\"value\":{\"durationMs\":604800000},\"typeSettings\":{\"selectableValues\":[{\"durationMs\":900000},{\"durationMs\":3600000},{\"durationMs\":86400000},{\"durationMs\":604800000},{\"durationMs\":2592000000},{\"durationMs\":7776000000}]},\"timeContext\":{\"durationMs\":86400000}}],\"style\":\"pills\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\"},\"name\":\"parameters - 11\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"SentinelOne\\r\\n| make-series TotalEvents = count() default = 0 on TimeGenerated from {TimeRange:start} to {TimeRange:end} step {TimeRange:grain};\",\"size\":0,\"title\":\"Events over time\",\"color\":\"orange\",\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"timechart\",\"graphSettings\":{\"type\":0}},\"customWidth\":\"50\",\"name\":\"query - 12\",\"styleSettings\":{\"maxWidth\":\"55\"}},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"SentinelOne\\r\\n| where EventType =~ 'Agents.'\\r\\n| summarize count() by AgentVersion\\r\\n\\r\\n\",\"size\":3,\"title\":\"Agents by version\",\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"piechart\",\"tileSettings\":{\"titleContent\":{\"columnMatch\":\"Title\",\"formatter\":1},\"leftContent\":{\"columnMatch\":\"e_count\",\"formatter\":12,\"formatOptions\":{\"palette\":\"auto\"},\"numberFormat\":{\"unit\":17,\"options\":{\"style\":\"decimal\",\"maximumFractionDigits\":2,\"maximumSignificantDigits\":3}}},\"secondaryContent\":{\"columnMatch\":\"Trend\",\"formatter\":9,\"formatOptions\":{\"palette\":\"purple\"}},\"showBorder\":false}},\"customWidth\":\"35\",\"name\":\"query - 0\",\"styleSettings\":{\"maxWidth\":\"30\"}},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"let usr1 = SentinelOne\\n| where isnotempty(SrcUserName)\\n| project usr=SrcUserName;\\nlet usr2 = SentinelOne\\n| where isnotempty(DataUserName)\\n| project usr=DataUserName;\\nlet all_usr =\\nunion isfuzzy=true usr1, usr2\\n| summarize cnt = dcount(usr)\\n| extend title = 'Users';\\nlet agnt = SentinelOne\\n| where isnotempty(AgentId)\\n| summarize cnt = dcount(AgentId)\\n| extend title = 'Agents';\\nlet alerts = SentinelOne\\n| where ActivityType == 3608\\n| summarize cnt = count()\\n| extend title = 'Alerts';\\nunion isfuzzy=true all_usr, agnt, alerts\",\"size\":3,\"title\":\"SentinelOne Summary\",\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"tiles\",\"tileSettings\":{\"titleContent\":{\"columnMatch\":\"title\",\"formatter\":1},\"leftContent\":{\"columnMatch\":\"cnt\",\"formatter\":12,\"formatOptions\":{\"palette\":\"auto\"},\"numberFormat\":{\"unit\":17,\"options\":{\"style\":\"decimal\",\"maximumFractionDigits\":2,\"maximumSignificantDigits\":3}}},\"showBorder\":false}},\"customWidth\":\"15\",\"name\":\"query - 10\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"SentinelOne\\r\\n  | where ActivityType == 27\\r\\n  | where DataRole =~ 'Admin'\\r\\n  | extend SrcIpAddr = extract(@'Address\\\\s(\\\\d{1,3}\\\\.\\\\d{1,3}\\\\.\\\\d{1,3}\\\\.\\\\d{1,3})', 1, EventOriginalMessage)\\r\\n  | where isnotempty(SrcIpAddr)\\r\\n  | summarize Events=count() by SrcIpAddr\",\"size\":3,\"title\":\"Admin Sources\",\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"piechart\"},\"customWidth\":\"35\",\"name\":\"query - 3\",\"styleSettings\":{\"margin\":\"10\",\"padding\":\"10\"}},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"SentinelOne\\r\\n| where isnotempty(DataRole)\\r\\n| where DataRole =~ 'Admin'\\r\\n| order by EventCreationTime\\r\\n| limit 100\\r\\n| project EventCreationTime, User=case(isnotempty(SrcUserName), SrcUserName, DataUserName), Action=EventOriginalMessage\",\"size\":1,\"title\":\"Admin activities\",\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"table\",\"gridSettings\":{\"filter\":true}},\"customWidth\":\"55\",\"name\":\"query - 2\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"SentinelOne\\r\\n| where ActivityType == 3608\\r\\n| extend RuleName = extract(@'Custom Rule:\\\\s(.*?)\\\\sin Group', 1, EventOriginalMessage)\\r\\n| summarize Hits=count() by RuleName\\r\\n| top 10 by Hits\\r\\n\",\"size\":1,\"title\":\"Top rules fired\",\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"table\",\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"Hits\",\"formatter\":8,\"formatOptions\":{\"palette\":\"redGreen\"}}],\"rowLimit\":50}},\"customWidth\":\"40\",\"name\":\"query - 8\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"SentinelOne\\r\\n| where ActivityType == 3608\\r\\n| extend AlertTrigger = extract(@'Alert created for\\\\s+(.*?)\\\\sfrom Custom', 1, EventOriginalMessage)\\r\\n| summarize Events=count() by AlertTrigger\\r\\n\",\"size\":3,\"title\":\"Alert triggers\",\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"piechart\"},\"customWidth\":\"30\",\"name\":\"query - 1\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"SentinelOne\\n| where ActivityType == 3608\\n| extend Host = extract(@'detected on\\\\s(\\\\S+)\\\\.', 1, EventOriginalMessage)\\n| summarize AlertCount=count() by Host\\n\",\"size\":1,\"title\":\"Hosts by alert count\",\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"table\"},\"customWidth\":\"30\",\"name\":\"query - 10\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"SentinelOne\\r\\n| where ActivityType == 3002\\r\\n| order by EventCreationTime\\r\\n| project Hash=EventSubStatus\",\"size\":1,\"title\":\"Recent black hashes\",\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"table\",\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"Hash\",\"formatter\":0,\"formatOptions\":{\"customColumnWidthSetting\":\"100%\"}}],\"rowLimit\":100,\"filter\":true}},\"customWidth\":\"30\",\"name\":\"query - 12\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"SentinelOne\\n| where ActivityType == 3608\\n| order by EventCreationTime\\n| extend AlertRule = extract(@'Custom Rule:\\\\s(.*?)\\\\sin Group', 1, EventOriginalMessage)\\n| extend AffectedHost = extract(@'detected on\\\\s(\\\\S+)\\\\.', 1, EventOriginalMessage)\\n| project EventCreationTime, AffectedHost, AlertRule\",\"size\":1,\"title\":\"Latest alerts\",\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"table\"},\"customWidth\":\"70\",\"name\":\"query - 11\"}],\"fromTemplateId\":\"sentinel-SentinelOneWorkbook\",\"$schema\":\"https://github.com/Microsoft/Application-Insights-Workbooks/blob/master/schema/workbook.json\"}\r\n",
                                "version": "1.0",
                                "sourceId": "[resourceId('microsoft.OperationalInsights/Workspaces', parameters('workspace'))]",
                                "category": "sentinel"
                            }
                        },
                        {
                            "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
                            "apiVersion": "2022-01-01-preview",
                            "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('Workbook-', last(split(resourceId('Microsoft.Insights/workbooks', 'SentinelOneWorkbook'),'/'))))]",
                            "properties": {
                                "description": "@{workbookKey=SentinelOneWorkbook; logoFileName=Azure_Sentinel.svg; description=Sets the time name for analysis.; dataTypesDependencies=System.Object[]; dataConnectorsDependencies=System.Object[]; previewImagesFileNames=System.Object[]; version=1.0.0; title=SentinelOneWorkbook; templateRelativePath=SentinelOne.json; subtitle=; provider=Microsoft}.description",
                                "parentId": "[resourceId('Microsoft.Insights/workbooks', 'SentinelOneWorkbook')]",
                                "contentId": "SentinelOneWorkbook",
                                "kind": "Workbook",
                                "version": "1.0.0",
                                "source": {
                                    "kind": "Solution",
                                    "name": "SentinelOne",
                                    "sourceId": "azuresentinel.azure-sentinel-solution-sentinelone"
                                },
                                "author": {
                                    "name": "Microsoft",
                                    "email": "support@microsoft.com"
                                },
                                "support": {
                                    "name": "Microsoft Corporation",
                                    "email": "support@microsoft.com",
                                    "tier": "Microsoft",
                                    "link": "https://support.microsoft.com"
                                },
                                "dependencies": {
                                    "operator": "AND",
                                    "criteria": [
                                        {
                                            "contentId": "SentinelOne_CL",
                                            "kind": "DataType"
                                        },
                                        {
                                            "contentId": "SentinelOne",
                                            "kind": "DataConnector"
                                        }
                                    ]
                                }
                            }
                        }
                    ]
                },
                "packageKind": "Solution",
                "packageVersion": "3.0.6",
                "packageName": "SentinelOne",
                "packageId": "azuresentinel.azure-sentinel-solution-sentinelone",
                "contentSchemaVersion": "3.0.0",
                "contentId": "SentinelOneWorkbook",
                "contentKind": "Workbook",
                "displayName": "SentinelOneWorkbook",
                "contentProductId": "azuresentinel.azure-sentinel-solution-sentinelone-wb-5uqx2obodjkdu",
                "id": "azuresentinel.azure-sentinel-solution-sentinelone-wb-5uqx2obodjkdu",
                "version": "1.0.0",
                "isDeprecated": false
            }
        },
        {
            "type": "Microsoft.OperationalInsights/workspaces/providers/contentTemplates",
            "apiVersion": "2023-04-01-preview",
            "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat(parameters('workspace'),'-pr-',uniquestring('SentinelOne-Parser')))]",
            "location": "[parameters('workspace-location')]",
            "dependsOn": [
                "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/contentPackages', 'azuresentinel.azure-sentinel-solution-sentinelone')]"
            ],
            "properties": {
                "description": "",
                "mainTemplate": {
                    "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
                    "contentVersion": "1.0.1",
                    "parameters": {},
                    "variables": {},
                    "resources": [
                        {
                            "name": "[concat(parameters('workspace'),'/','SentinelOne')]",
                            "apiVersion": "2022-10-01",
                            "type": "Microsoft.OperationalInsights/workspaces/savedSearches",
                            "location": "[parameters('workspace-location')]",
                            "properties": {
                                "eTag": "*",
                                "displayName": "Parser for SentinelOne",
                                "category": "Microsoft Sentinel Parser",
                                "functionAlias": "SentinelOne",
                                "query": "let SentinelOne_view  = view () { \nlet SentinelOneV2_Empty = datatable(\n    AccountId:string,\n    AccountName:string,\n    ActivityType:real ,\n    EventCreationTime:datetime,\n    DataAccountName:string,\n    DataFullScopeDetails:string,\n    DataScopeLevel:string,\n    DataScopeName:string,\n    DataSiteId:int,\n    SecondaryDescription:string ,\n    DataSiteName:string,\n    SourceProcessInfo:string,\n    SrcUserName:string,\n    EventId:string,\n    EventOriginalMessage:string,\n    SiteId:string,\n    SiteName:string,\n    UpdatedAt:datetime ,\n    UserIdentity:string,\n    EventType:string,\n    DataByUser:string,\n    DataRole:string,\n    DataUserScope:string,\n    EventTypeDetailed:string,\n    DataSource:string,\n    DataExpiryDateStr:string,\n    DataExpiryTime:int,\n    DataNetworkquarantine:bool,\n    DataRuleCreationTime:int,\n    DataRuleDescription:string,\n    DataRuleExpirationMode:string,\n    DataRuleId:int,\n    DataRuleName:string,\n    DataRuleQueryDetails:string,\n    DataRuleQueryType:string,\n    DataRuleSeverity:string,\n    DataScopeId:int,\n    DataStatus:string,\n    DataSystemUser:int,\n    DataTreatasthreat:string,\n    DataUserId:int,\n    RuleInfo:string,\n    DataUserName:string,\n    EventSubStatus:string,\n    AgentId:string,\n    DataComputerName:string,\n    DataExternalIp:string,\n    DataGroupName:string,\n    DataSystem:bool,\n    DataUuid:string,\n    GroupId:string,\n    GroupName:string,\n    DataGroup:string,\n    UserId:string ,\n    DataOptionalGroups:string,\n    DataCreatedAt:string,\n    DataDownloadUrl:string,\n    DataFilePath:string,\n    DataFilename:string,\n    DataUploadedFilename:string,\n    Comments:string,\n    DataNewValue:string,\n    DataPolicyId:string,\n    DataPolicyName:string,\n    DataNewValueb:string,\n    DataShouldReboot:bool,\n    DataRoleName:string,\n    DataScopeLevelName:string,\n    ActiveDirectoryComputerDistinguishedName:string,\n    ActiveDirectoryComputerMemberOf:string,\n    ActiveDirectoryLastUserDistinguishedName:string,\n    ActiveDirectoryLastUserMemberOf:string,\n    ActiveThreats:int,\n    AgentVersion:string,\n    AllowRemoteShell:bool,\n    AppsVulnerabilityStatus:string,\n    ComputerName:string,\n    ConsoleMigrationStatus:string,\n    CoreCount:int,\n    CpuCount:int,\n    CpuId:string,\n    SrcDvcDomain:string,\n    EncryptedApplications:bool,\n    ExternalId:string,\n    ExternalIp:string,\n    FirewallEnabled:bool,\n    GroupIp:string,\n    InRemoteShellSession:bool,\n    Infected:bool,\n    InstallerType:string,\n    IsActive:bool,\n    IsDecommissioned:bool,\n    IsPendingUninstall:bool,\n    IsUninstalled:bool,\n    IsUpToDate:bool,\n    LastActiveDate:string,\n    TargetProcessInfo:string ,\n    LastIpToMgmt:string,\n    LastLoggedInUserName:string,\n    LicenseKey:string,\n    LocationEnabled:bool,\n    LocationType:string,\n    Locations:string,\n    MachineType:string,\n    MitigationMode:string,\n    MitigationModeSuspicious:string,\n    SrcDvcModelName:string,\n    NetworkInterfaces:string,\n    NetworkQuarantineEnabled:bool,\n    NetworkStatus:string,\n    OperationalState:string,\n    OsArch:string,\n    SrcDvcOs:string,\n    OsRevision:string,\n    OsStartTime:datetime ,\n    OsType:string,\n    RangerStatus:string,\n    RangerVersion:string,\n    RegisteredAt:string,\n    RemoteProfilingState:string,\n    ScanFinishedAt:string,\n    ScanStartedAt:string,\n    ScanStatus:string,\n    ThreatRebootRequired:bool,\n    TotalMemory:int,\n    SourceParentProcessInfo:string ,\n    UserActionsNeeded:string,\n    Uuid:string,\n    Creator:string,\n    ContainerInfo:string,\n    CreatorId:string,\n    Inherits:string ,\n    IsDefault:string ,\n    Name:string,\n    RegistrationToken:string,\n    AlertInfo:string,\n    PrimaryDescription:string ,\n    TotalAgents:real ,\n    CreatedAt:datetime ,\n    Id:string,\n    Type:string\n      )[];  \n  let SentinelOneV1_Empty = datatable (\n    accountId_s:string,\n    accountName_s:string,\n    activityType_d:real,\n    createdAt_t:datetime  ,\n    data_accountName_s:string,\n    data_fullScopeDetails_s:string,\n    data_scopeLevel_s:string,\n    data_scopeName_s:string,\n    data_siteId_d:int,\n    data_siteName_s:string,\n    data_username_s:string,\n    id_s:string,\n    primaryDescription_s:string,\n    siteId_s:string,\n    siteName_s:string,\n    updatedAt_t:datetime ,\n    userId_s:string,\n    event_name_s:string,\n    data_byUser_s:string,\n    data_role_s:string,\n    data_userScope_s:string,\n    description_s:string,\n    data_source_s:string,\n    data_expiryDateStr_s:string,\n    data_expiryTime_d:int,\n    data_networkquarantine_b:bool,\n    data_ruleCreationTime_d:int,\n    data_ruleDescription_s:string,\n    data_ruleExpirationMode_s:string,\n    data_ruleId_d:int,\n    data_ruleName_s:string,\n    data_ruleQueryDetails_s:string,\n    data_ruleQueryType_s:string,\n    data_ruleSeverity_s:string,\n    data_scopeId_d:int,\n    data_status_s:string,\n    data_systemUser_d:int,\n    data_treatasthreat_s:string,\n    data_userId_d:int,\n    data_userName_s:string,\n    secondaryDescription_s:string,\n    agentId_s:string,\n    data_computerName_s:string,\n    data_externalIp_s:string,\n    data_groupName_s:string,\n    data_system_b:bool,\n    data_uuid_g:string,\n    groupId_s:string,\n    groupName_s:string,\n    data_group_s:string,\n    data_optionalGroups_s:string,\n    data_createdAt_t:string,\n    data_downloadUrl_s:string,\n    data_filePath_s:string,\n    data_filename_s:string,\n    data_uploadedFilename_s:string,\n    comments_s:string,\n    data_newValue_s:string,\n    data_policy_id_s:string,\n    data_policyName_s:string,\n    data_newValue_b:bool,\n    data_shouldReboot_b:bool,\n    data_roleName_s:string,\n    data_scopeLevelName_s:string,\n    activeDirectory_computerDistinguishedName_s:string,\n    activeDirectory_computerMemberOf_s:string,\n    activeDirectory_lastUserDistinguishedName_s:string,\n    activeDirectory_lastUserMemberOf_s:string,\n    activeThreats_d:real,\n    agentVersion_s:string,\n    allowRemoteShell_b:bool,\n    appsVulnerabilityStatus_s:string,\n    computerName_s:string,\n    consoleMigrationStatus_s:string,\n    coreCount_d:real,\n    cpuCount_d:real ,\n    cpuId_s:string,\n    domain_s:string,\n    encryptedApplications_b:bool,\n    externalId_s:string,\n    externalIp_s:string,\n    firewallEnabled_b:bool,\n    groupIp_s:string,\n    inRemoteShellSession_b:bool,\n    infected_b:bool,\n    installerType_s:string,\n    isActive_b:bool,\n    isDecommissioned_b:bool,\n    isPendingUninstall_b:bool,\n    isUninstalled_b:bool,\n    isUpToDate_b:bool,\n    lastActiveDate_t:string,\n    lastIpToMgmt_s:string,\n    lastLoggedInUserName_s:string,\n    licenseKey_s:string,\n    locationEnabled_b:bool,\n    locationType_s:string,\n    locations_s:string,\n    machineType_s:string,\n    mitigationMode_s:string,\n    mitigationModeSuspicious_s:string,\n    modelName_s:string,\n    networkInterfaces_s:string,\n    networkQuarantineEnabled_b:bool,\n    networkStatus_s:string,\n    operationalState_s:string,\n    osArch_s:string,\n    osName_s:string,\n    osRevision_s:string,\n    osStartTime_t:datetime ,\n    osType_s:string,\n    rangerStatus_s:string,\n    rangerVersion_s:string,\n    registeredAt_t:string,\n    remoteProfilingState_s:string,\n    scanFinishedAt_t:string,\n    scanStartedAt_t:string,\n    scanStatus_s:string,\n    threatRebootRequired_b:bool,\n    totalMemory_d:real ,\n    userActionsNeeded_s:string,\n    uuid_g:string,\n    creator_s:string,\n    creatorId_s:string,\n    inherits_b:string ,\n    isDefault_b:string ,\n    name_s:string,\n    registrationToken_s:string,\n    totalAgents_d:real ,\n    AlertInfo:string,\n    type_s:string\n    )[];\nlet SentinelOneV1Empty_Union= union isfuzzy=true SentinelOne_CL,SentinelOneV1_Empty\n    | extend  \n            EventVendor=\"SentinelOne\",\n            EventProduct=\"SentinelOne\",\n        AccountId=column_ifexists('accountId_s', ''),\n        AccountName=column_ifexists('accountName_s', ''),\n        ActivityType=toreal(column_ifexists('activityType_d', '')),\n        EventCreationTime=todatetime(column_ifexists('createdAt_t', 'CreatedAt')),\n        DataAccountName=column_ifexists('data_accountName_s', ''),\n        DataFullScopeDetails=column_ifexists('data_fullScopeDetails_s', ''),\n        DataScopeLevel=column_ifexists('data_scopeLevel_s', ''),\n        DataScopeName=column_ifexists('data_scopeName_s', ''),\n        DataSiteId=column_ifexists('data_siteId_d', ''),\n        DataSiteName=column_ifexists('data_siteName_s', ''),\n        SrcUserName=column_ifexists('data_username_s', ''),\n        EventId=column_ifexists('id_s', ''),\n        EventOriginalMessage=column_ifexists('primaryDescription_s', ''),\n        PrimaryDescription=column_ifexists('primaryDescription_s', ''),\n        SiteId=column_ifexists('siteId_s', ''),\n        SiteName=column_ifexists('siteName_s', ''),\n        UpdatedAt=column_ifexists('updatedAt_t', ''),\n        UserIdentity=column_ifexists('userId_s', ''),\n        UserId=column_ifexists('userId_s', ''),\n        EventType=column_ifexists('event_name_s', ''),\n        DataByUser=column_ifexists('data_byUser_s', ''),\n        DataRole=column_ifexists('data_role_s', ''),\n        DataUserScope=column_ifexists('data_userScope_s', ''),\n        EventTypeDetailed=column_ifexists('description_s', ''),\n        DataSource=column_ifexists('data_source_s', ''),\n        DataExpiryDateStr=column_ifexists('data_expiryDateStr_s', ''),\n        DataExpiryTime=column_ifexists('data_expiryTime_d', ''),\n        DataNetworkquarantine=column_ifexists('data_networkquarantine_b', ''),\n        DataRuleCreationTime=column_ifexists('data_ruleCreationTime_d', ''),\n        DataRuleDescription=column_ifexists('data_ruleDescription_s', ''),\n        DataRuleExpirationMode=column_ifexists('data_ruleExpirationMode_s', ''),\n        DataRuleId=column_ifexists('data_ruleId_d', ''),\n        DataRuleName=column_ifexists('data_ruleName_s', ''),\n        DataRuleQueryDetails=column_ifexists('data_ruleQueryDetails_s', ''),\n        DataRuleQueryType=column_ifexists('data_ruleQueryType_s', ''),\n        DataRuleSeverity=column_ifexists('data_ruleSeverity_s', ''),\n        DataScopeId=column_ifexists('data_scopeId_d', ''),\n        Id=column_ifexists('id_s', ''),\n        DataStatus=column_ifexists('data_status_s', ''),\n        DataSystemUser=column_ifexists('data_systemUser_d', ''),\n        DataTreatasthreat=column_ifexists('data_treatasthreat_s', ''),\n        DataUserId=column_ifexists('data_userId_d', ''),\n        DataUserName=column_ifexists('data_userName_s', ''),\n        EventSubStatus=column_ifexists('secondaryDescription_s', ''),\n        SecondaryDescription=column_ifexists('secondaryDescription_s', ''),\n        AgentId=column_ifexists('agentId_s', ''),\n        DataComputerName=column_ifexists('data_computerName_s', ''),\n        DataExternalIp=column_ifexists('data_externalIp_s', ''),\n        DataGroupName=column_ifexists('data_groupName_s', ''),\n        DataSystem=column_ifexists('data_system_b', ''),\n        DataUuid=column_ifexists('data_uuid_g', ''),\n        GroupId=column_ifexists('groupId_s', ''),\n        GroupName=column_ifexists('groupName_s', ''),\n        DataGroup=column_ifexists('data_group_s', ''),\n        DataOptionalGroups=column_ifexists('data_optionalGroups_s', ''),\n        DataCreatedAt=column_ifexists('data_createdAt_t', ''),\n        DataDownloadUrl=column_ifexists('data_downloadUrl_s', ''),\n        DataFilePath=column_ifexists('data_filePath_s', ''),\n        DataFilename=column_ifexists('data_filename_s', ''),\n        DataUploadedFilename=column_ifexists('data_uploadedFilename_s', ''),\n        Comments=column_ifexists('comments_s', ''),\n        DataNewValue=column_ifexists('data_newValue_s', ''),\n        DataPolicyId=column_ifexists('data_policy_id_s', ''),\n        DataPolicyName=column_ifexists('data_policyName_s', ''),\n        DataNewValueb=column_ifexists('data_newValue_b', ''),\n        DataShouldReboot=column_ifexists('data_shouldReboot_b', ''),\n        DataRoleName=column_ifexists('data_roleName_s', ''),\n        DataScopeLevelName=column_ifexists('data_scopeLevelName_s', ''),\n        ActiveDirectoryComputerDistinguishedName=column_ifexists('activeDirectory_computerDistinguishedName_s', ''),\n        ActiveDirectoryComputerMemberOf=column_ifexists('activeDirectory_computerMemberOf_s', ''),\n        ActiveDirectoryLastUserDistinguishedName=column_ifexists('activeDirectory_lastUserDistinguishedName_s', ''),\n        ActiveDirectoryLastUserMemberOf=column_ifexists('activeDirectory_lastUserMemberOf_s', ''),\n        ActiveThreats=column_ifexists('activeThreats_d', ''),\n        AgentVersion=column_ifexists('agentVersion_s', ''),\n        AllowRemoteShell=column_ifexists('allowRemoteShell_b', ''),\n        AppsVulnerabilityStatus=column_ifexists('appsVulnerabilityStatus_s', ''),\n        ComputerName=column_ifexists('computerName_s', ''),\n        ConsoleMigrationStatus=column_ifexists('consoleMigrationStatus_s', ''),\n        CoreCount=column_ifexists('coreCount_d', ''),\n        CpuCount=column_ifexists('cpuCount_d', ''),\n        CpuId=column_ifexists('cpuId_s', ''),\n        SrcDvcDomain=column_ifexists('domain_s', ''),\n        EncryptedApplications=column_ifexists('encryptedApplications_b', ''),\n        ExternalId=column_ifexists('externalId_s', ''),\n        ExternalIp=column_ifexists('externalIp_s', ''),\n        FirewallEnabled=column_ifexists('firewallEnabled_b', ''),\n        GroupIp=column_ifexists('groupIp_s', ''),\n        InRemoteShellSession=column_ifexists('inRemoteShellSession_b', ''),\n        Infected=column_ifexists('infected_b', ''),\n        InstallerType=column_ifexists('installerType_s', ''),\n        IsActive=column_ifexists('isActive_b', ''),\n        IsDecommissioned=column_ifexists('isDecommissioned_b', ''),\n        IsPendingUninstall=column_ifexists('isPendingUninstall_b', ''),\n        IsUninstalled=column_ifexists('isUninstalled_b', ''),\n        IsUpToDate=column_ifexists('isUpToDate_b', ''),\n        LastActiveDate=column_ifexists('lastActiveDate_t', ''),\n        LastIpToMgmt=column_ifexists('lastIpToMgmt_s', ''),\n        LastLoggedInUserName=column_ifexists('lastLoggedInUserName_s', ''),\n        LicenseKey=column_ifexists('licenseKey_s', ''),\n        LocationEnabled=column_ifexists('locationEnabled_b', ''),\n        LocationType=column_ifexists('locationType_s', ''),\n        Locations=column_ifexists('locations_s', ''),\n        MachineType=column_ifexists('machineType_s', ''),\n        MitigationMode=column_ifexists('mitigationMode_s', ''),\n        MitigationModeSuspicious=column_ifexists('mitigationModeSuspicious_s', ''),\n        SrcDvcModelName=column_ifexists('modelName_s', ''),\n        NetworkInterfaces=column_ifexists('networkInterfaces_s', ''),\n        NetworkQuarantineEnabled=column_ifexists('networkQuarantineEnabled_b', ''),\n        NetworkStatus=column_ifexists('networkStatus_s', ''),\n        OperationalState=column_ifexists('operationalState_s', ''),\n        OsArch=column_ifexists('osArch_s', ''),\n        SrcDvcOs=column_ifexists('osName_s', ''),\n        OsRevision=column_ifexists('osRevision_s', ''),\n        OsStartTime=column_ifexists('osStartTime_t', ''),\n        OsType=column_ifexists('osType_s', ''),\n        RangerStatus=column_ifexists('rangerStatus_s', ''),\n        RangerVersion=column_ifexists('rangerVersion_s', ''),\n        RegisteredAt=column_ifexists('registeredAt_t', ''),\n        RemoteProfilingState=column_ifexists('remoteProfilingState_s', ''),\n        ScanFinishedAt=column_ifexists('scanFinishedAt_t', ''),\n        ScanStartedAt=column_ifexists('scanStartedAt_t', ''),\n        ScanStatus=column_ifexists('scanStatus_s', ''),\n        ThreatRebootRequired=column_ifexists('threatRebootRequired_b', ''),\n        TotalMemory=column_ifexists('totalMemory_d', ''),\n        UserActionsNeeded=column_ifexists('userActionsNeeded_s', ''),\n        Uuid=column_ifexists('uuid_g', ''),\n        Creator=column_ifexists('creator_s', ''),\n        CreatedAt=column_ifexists('createdAt_t',''),\n        CreatorId=column_ifexists('creatorId_s', ''),\n        Inherits=column_ifexists('inherits_b', ''),\n        IsDefault=column_ifexists('isDefault_b', ''),\n        Name=column_ifexists('name_s', ''),\n        RegistrationToken=column_ifexists('registrationToken_s', ''),\n        TotalAgents=column_ifexists('totalAgents_d', ''),\n        Type=column_ifexists('type_s', '');\n        union isfuzzy=true SentinelOneActivities_CL,SentinelOneAgents_CL,SentinelOneAlerts_CL,SentinelOneGroups_CL,SentinelOneThreats_CL,SentinelOneV1Empty_Union\n        | extend \n        ActivityType,\n        EventVendor=\"SentinelOne\",\n        EventProduct=\"SentinelOne\",\n        DataAccountName=tostring(parse_json(todynamic(Data)).accountName),\n        DataFullScopeDetails=tostring(parse_json(todynamic(Data)).fullScopeDetails),\n        DataScopeLevel=tostring(parse_json(todynamic(Data)).scopeLevel),\n        DataScopeName=tostring(parse_json(todynamic(Data)).scopeName),\n        DataSiteId=tostring(parse_json(todynamic(Data)).siteId),\n        DataSiteName=tostring(parse_json(todynamic(Data)).siteName),\n        SrcUserName=tostring(parse_json(todynamic(Data)).userName),\n        EventId=Id,\n        SourceParentProcessInfo,\n        EventOriginalMessage=PrimaryDescription,\n        UserIdentity=UserId,\n        EventTypeDetailed=Description,\n        DataRuleId=tostring(parse_json(todynamic(Data)).ruleId),\n        DataRuleName=tostring(parse_json(todynamic(Data)).rulename),\n        DataScopeId=tostring(parse_json(todynamic(Data)).scopeId),\n        DataSystemUser=tostring(parse_json(todynamic(Data)).systemUser),\n        DataUserId=tostring(parse_json(todynamic(Data)).userId),\n        DataUserName=tostring(parse_json(todynamic(Data)).userName),\n        EventSubStatus=SecondaryDescription,\n        DataComputerName=tostring(parse_json(todynamic(Data)).computerName),\n        DataExternalIp=tostring(parse_json(todynamic(Data)).externalIp),\n        DataGroupName=tostring(parse_json(todynamic(Data)).groupName),\n        DataStatus=tostring(parse_json(todynamic(Data)).status),\n        DataByUser=tostring(parse_json(todynamic(Data)).byUser),\n        DataRole=tostring(parse_json(todynamic(Data)).role),\n        DataUserScope=tostring(parse_json(todynamic(Data)).userScope),\n        DataSource=tostring(parse_json(todynamic(Data)).source),\n        DataExpiryDateStr=tostring(parse_json(todynamic(Data)).expiryDateStr),\n        DataExpiryTime=tostring(parse_json(todynamic(Data)).expiryTime),\n        DataNetworkquarantine=tostring(parse_json(todynamic(Data)).networkquarantine),\n        DataRuleCreationTime=tostring(parse_json(todynamic(Data)).ruleCreationTime),\n        DataUuid=Uuid,\n        DataGroup=tostring(parse_json(todynamic(Data)).group),\n        DataRuleDescription=tostring(parse_json(todynamic(Data)).ruleDescription),\n        EventType=tostring(parse_json(todynamic(AlertInfo)).eventType),\n        DataRuleExpirationMode=tostring(parse_json(todynamic(Data)).ruleExpirationMode),\n        DataRuleQueryDetails=tostring(parse_json(todynamic(Data)).ruleQueryDetails),\n        DataRuleQueryType=tostring(parse_json(todynamic(Data)).ruleQueryType),\n        DataRuleSeverity=tostring(parse_json(todynamic(Data)).ruleSeverity),\n        DataSystem=tostring(parse_json(todynamic(Data)).system),\n        DataOptionalGroups=tostring(parse_json(todynamic(Data)).optionalGroups),\n        DataCreatedAt=tostring(parse_json(todynamic(Data)).createdAt),\n        DataDownloadUrl=tostring(parse_json(todynamic(Data)).downloadUrl),\n        DataFilePath=tostring(parse_json(todynamic(Data)).filePath),\n        DataFilename=tostring(parse_json(todynamic(Data)).filename),\n        DataUploadedFilename=tostring(parse_json(todynamic(Data)).uploadedFilename),\n        DataNewValue=tostring(parse_json(todynamic(Data)).newValue),\n        DataPolicyId=tostring(parse_json(todynamic(Data)).policyId),\n        DataPolicyName=tostring(parse_json(todynamic(Data)).policyName),\n        DataShouldReboot=tostring(parse_json(todynamic(Data)).shouldReboot),\n        DataRoleName=tostring(parse_json(todynamic(Data)).roleName),\n        DataScopeLevelName=tostring(parse_json(todynamic(Data)).scopeLevelName),\n        ActiveDirectoryComputerDistinguishedName=tostring(parse_json(todynamic(ActiveDirectory)).computerDistinguishedName),\n        ActiveDirectoryComputerMemberOf=tostring(parse_json(todynamic(ActiveDirectory)).computerMemberOf),\n        ActiveDirectoryLastUserDistinguishedName=tostring(parse_json(todynamic(ActiveDirectory)).lastUserDistinguishedName),\n        ActiveDirectoryLastUserMemberOf=tostring(parse_json(todynamic(ActiveDirectory)).lastUserMemberOf),\n        SrcDvcDomain=Domain,\n        AlertInfo=tostring(AlertInfo),\n        FirewallEnabled=column_ifexists('FirewallEnabled',''),\n        IsUninstalled=column_ifexists('IsUninstalled',''),\n        EncryptedApplications=column_ifexists('EncryptedApplications',''),\n        OsStartTime=column_ifexists('OsStartTime',''),\n        InRemoteShellSession=column_ifexists('InRemoteShellSession',''),\n        ThreatRebootRequired=column_ifexists('ThreatRebootRequired',''),\n        IsPendingUninstall=column_ifexists('IsPendingUninstall',''),\n        IsUpToDate=column_ifexists('IsUpToDate',''),\n        IsDecommissioned=column_ifexists('IsDecommissioned',''),\n        IsActive=column_ifexists('IsActive',''),\n        Infected=column_ifexists('Infected',''),\n        AllowRemoteShell=column_ifexists('AllowRemoteShell',''),\n        LocationEnabled=column_ifexists('LocationEnabled',''),\n        SrcDvcModelName=ModelName,\n        NetworkQuarantineEnabled=column_ifexists('NetworkQuarantineEnabled',''),\n        SrcDvcOs=OsName,\n        SourceProcessInfo,\n        RuleInfo,\n        TargetProcessInfo,\n        ContainerInfo,\n        EventCreationTime=CreatedAt,\n        RemoteProfilingState=column_ifexists('RemoteProfilingState','')\n        | project\n        TimeGenerated, \n        EventVendor,\n        EventProduct,\n        AccountName,\n        SourceParentProcessInfo,\n        TargetProcessInfo,\n        ActivityType,\n        EventCreationTime,\n        DataAccountName,\n        DataFullScopeDetails,\n        DataScopeLevel,\n        DataScopeName,\n        DataSiteId,\n        SourceProcessInfo,\n        DataSiteName,\n        SrcUserName,\n        EventId,\n        EventOriginalMessage,\n        SiteId,\n        SiteName,\n        UpdatedAt,\n        UserIdentity,\n        EventType,\n        DataByUser,\n        DataRole,\n        DataUserScope,\n        EventTypeDetailed,\n        DataSource,\n        DataExpiryDateStr,\n        DataExpiryTime,\n        DataNetworkquarantine,\n        DataRuleCreationTime,\n        DataRuleDescription,\n        DataRuleExpirationMode,\n        DataRuleId,\n        DataRuleName,\n        DataRuleQueryDetails,\n        DataRuleQueryType,\n        DataRuleSeverity,\n        DataScopeId,\n        DataStatus,\n        DataSystemUser,\n        DataTreatasthreat,\n        DataUserId,\n        DataUserName,\n        EventSubStatus,\n        AgentId,\n        DataComputerName,\n        DataExternalIp,\n        DataGroupName,\n        DataSystem,\n        DataUuid,\n        GroupId,\n        GroupName,\n        DataGroup,\n        DataOptionalGroups,\n        DataCreatedAt,\n        DataDownloadUrl,\n        DataFilePath,\n        DataFilename,\n        DataUploadedFilename,\n        Comments,\n        DataNewValue,\n        DataPolicyId,\n        DataPolicyName,\n        DataNewValueb,\n        DataShouldReboot,\n        DataRoleName,\n        DataScopeLevelName,\n        ActiveDirectoryComputerDistinguishedName,\n        ActiveDirectoryComputerMemberOf,\n        ActiveDirectoryLastUserDistinguishedName,\n        ActiveDirectoryLastUserMemberOf,\n        ActiveThreats=toreal(activeThreats_d),\n        AgentVersion,\n        AllowRemoteShell,\n        AppsVulnerabilityStatus,\n        ComputerName,\n        ConsoleMigrationStatus,\n        CoreCount=toreal(coreCount_d),\n        CpuCount=toreal(cpuCount_d),\n        CpuId,\n        SrcDvcDomain,\n        EncryptedApplications,\n        ExternalId,\n        ExternalIp,\n        FirewallEnabled,\n        GroupIp,\n        InRemoteShellSession,\n        Infected,\n        InstallerType,\n        IsActive,\n        IsDecommissioned,\n        IsPendingUninstall,\n        IsUninstalled,\n        IsUpToDate,\n        LastActiveDate=tostring(LastActiveDate_datetime),\n        LastIpToMgmt,\n        LastLoggedInUserName,\n        LicenseKey,\n        LocationEnabled,\n        LocationType,\n        Locations,\n        MachineType,\n        MitigationMode,\n        MitigationModeSuspicious,\n        SrcDvcModelName,\n        NetworkInterfaces,\n        NetworkQuarantineEnabled,\n        NetworkStatus,\n        OperationalState,\n        OsArch,\n        SrcDvcOs,\n        OsRevision,\n        OsStartTime,\n        OsType,\n        RangerStatus,\n        RangerVersion,\n        RegisteredAt=tostring(RegisteredAt_datetime),\n        RemoteProfilingState,\n        ScanFinishedAt=tostring(ScanFinishedAt_datetime),\n        ScanStartedAt=tostring(ScanStartedAt_datetime),\n        ScanStatus,\n        ThreatRebootRequired,\n        TotalMemory=toreal(totalMemory_d),\n        UserActionsNeeded,\n        Uuid,\n        Creator,\n        CreatorId,\n        Inherits,\n        IsDefault,\n        Name,\n        AlertInfo,\n        RuleInfo,\n        ContainerInfo,\n        RegistrationToken,\n        TotalAgents=totalAgents_d,\n        Type;\n    };\n    SentinelOne_view\n",
                                "functionParameters": "",
                                "version": 2,
                                "tags": [
                                    {
                                        "name": "description",
                                        "value": ""
                                    }
                                ]
                            }
                        },
                        {
                            "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
                            "apiVersion": "2022-01-01-preview",
                            "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('Parser-', last(split(resourceId('Microsoft.OperationalInsights/workspaces/savedSearches', parameters('workspace'), 'SentinelOne'),'/'))))]",
                            "dependsOn": [
                                "[resourceId('Microsoft.OperationalInsights/workspaces/savedSearches', parameters('workspace'), 'SentinelOne')]"
                            ],
                            "properties": {
                                "parentId": "[resourceId('Microsoft.OperationalInsights/workspaces/savedSearches', parameters('workspace'), 'SentinelOne')]",
                                "contentId": "SentinelOne-Parser",
                                "kind": "Parser",
                                "version": "1.0.1",
                                "source": {
                                    "name": "SentinelOne",
                                    "kind": "Solution",
                                    "sourceId": "azuresentinel.azure-sentinel-solution-sentinelone"
                                },
                                "author": {
                                    "name": "Microsoft",
                                    "email": "support@microsoft.com"
                                },
                                "support": {
                                    "name": "Microsoft Corporation",
                                    "email": "support@microsoft.com",
                                    "tier": "Microsoft",
                                    "link": "https://support.microsoft.com"
                                }
                            }
                        }
                    ]
                },
                "packageKind": "Solution",
                "packageVersion": "3.0.6",
                "packageName": "SentinelOne",
                "packageId": "azuresentinel.azure-sentinel-solution-sentinelone",
                "contentSchemaVersion": "3.0.0",
                "contentId": "SentinelOne-Parser",
                "contentKind": "Parser",
                "displayName": "Parser for SentinelOne",
                "contentProductId": "azuresentinel.azure-sentinel-solution-sentinelone-pr-i6vnwuyza4jlc",
                "id": "azuresentinel.azure-sentinel-solution-sentinelone-pr-i6vnwuyza4jlc",
                "version": "1.0.1",
                "isDeprecated": false
            }
        },
        {
            "type": "Microsoft.OperationalInsights/workspaces/savedSearches",
            "apiVersion": "2022-10-01",
            "name": "[concat(parameters('workspace'),'/','SentinelOne')]",
            "location": "[parameters('workspace-location')]",
            "properties": {
                "eTag": "*",
                "displayName": "Parser for SentinelOne",
                "category": "Microsoft Sentinel Parser",
                "functionAlias": "SentinelOne",
                "query": "let SentinelOne_view  = view () { \nlet SentinelOneV2_Empty = datatable(\n    AccountId:string,\n    AccountName:string,\n    ActivityType:real ,\n    EventCreationTime:datetime,\n    DataAccountName:string,\n    DataFullScopeDetails:string,\n    DataScopeLevel:string,\n    DataScopeName:string,\n    DataSiteId:int,\n    SecondaryDescription:string ,\n    DataSiteName:string,\n    SourceProcessInfo:string,\n    SrcUserName:string,\n    EventId:string,\n    EventOriginalMessage:string,\n    SiteId:string,\n    SiteName:string,\n    UpdatedAt:datetime ,\n    UserIdentity:string,\n    EventType:string,\n    DataByUser:string,\n    DataRole:string,\n    DataUserScope:string,\n    EventTypeDetailed:string,\n    DataSource:string,\n    DataExpiryDateStr:string,\n    DataExpiryTime:int,\n    DataNetworkquarantine:bool,\n    DataRuleCreationTime:int,\n    DataRuleDescription:string,\n    DataRuleExpirationMode:string,\n    DataRuleId:int,\n    DataRuleName:string,\n    DataRuleQueryDetails:string,\n    DataRuleQueryType:string,\n    DataRuleSeverity:string,\n    DataScopeId:int,\n    DataStatus:string,\n    DataSystemUser:int,\n    DataTreatasthreat:string,\n    DataUserId:int,\n    RuleInfo:string,\n    DataUserName:string,\n    EventSubStatus:string,\n    AgentId:string,\n    DataComputerName:string,\n    DataExternalIp:string,\n    DataGroupName:string,\n    DataSystem:bool,\n    DataUuid:string,\n    GroupId:string,\n    GroupName:string,\n    DataGroup:string,\n    UserId:string ,\n    DataOptionalGroups:string,\n    DataCreatedAt:string,\n    DataDownloadUrl:string,\n    DataFilePath:string,\n    DataFilename:string,\n    DataUploadedFilename:string,\n    Comments:string,\n    DataNewValue:string,\n    DataPolicyId:string,\n    DataPolicyName:string,\n    DataNewValueb:string,\n    DataShouldReboot:bool,\n    DataRoleName:string,\n    DataScopeLevelName:string,\n    ActiveDirectoryComputerDistinguishedName:string,\n    ActiveDirectoryComputerMemberOf:string,\n    ActiveDirectoryLastUserDistinguishedName:string,\n    ActiveDirectoryLastUserMemberOf:string,\n    ActiveThreats:int,\n    AgentVersion:string,\n    AllowRemoteShell:bool,\n    AppsVulnerabilityStatus:string,\n    ComputerName:string,\n    ConsoleMigrationStatus:string,\n    CoreCount:int,\n    CpuCount:int,\n    CpuId:string,\n    SrcDvcDomain:string,\n    EncryptedApplications:bool,\n    ExternalId:string,\n    ExternalIp:string,\n    FirewallEnabled:bool,\n    GroupIp:string,\n    InRemoteShellSession:bool,\n    Infected:bool,\n    InstallerType:string,\n    IsActive:bool,\n    IsDecommissioned:bool,\n    IsPendingUninstall:bool,\n    IsUninstalled:bool,\n    IsUpToDate:bool,\n    LastActiveDate:string,\n    TargetProcessInfo:string ,\n    LastIpToMgmt:string,\n    LastLoggedInUserName:string,\n    LicenseKey:string,\n    LocationEnabled:bool,\n    LocationType:string,\n    Locations:string,\n    MachineType:string,\n    MitigationMode:string,\n    MitigationModeSuspicious:string,\n    SrcDvcModelName:string,\n    NetworkInterfaces:string,\n    NetworkQuarantineEnabled:bool,\n    NetworkStatus:string,\n    OperationalState:string,\n    OsArch:string,\n    SrcDvcOs:string,\n    OsRevision:string,\n    OsStartTime:datetime ,\n    OsType:string,\n    RangerStatus:string,\n    RangerVersion:string,\n    RegisteredAt:string,\n    RemoteProfilingState:string,\n    ScanFinishedAt:string,\n    ScanStartedAt:string,\n    ScanStatus:string,\n    ThreatRebootRequired:bool,\n    TotalMemory:int,\n    SourceParentProcessInfo:string ,\n    UserActionsNeeded:string,\n    Uuid:string,\n    Creator:string,\n    ContainerInfo:string,\n    CreatorId:string,\n    Inherits:string ,\n    IsDefault:string ,\n    Name:string,\n    RegistrationToken:string,\n    AlertInfo:string,\n    PrimaryDescription:string ,\n    TotalAgents:real ,\n    CreatedAt:datetime ,\n    Id:string,\n    Type:string\n      )[];  \n  let SentinelOneV1_Empty = datatable (\n    accountId_s:string,\n    accountName_s:string,\n    activityType_d:real,\n    createdAt_t:datetime  ,\n    data_accountName_s:string,\n    data_fullScopeDetails_s:string,\n    data_scopeLevel_s:string,\n    data_scopeName_s:string,\n    data_siteId_d:int,\n    data_siteName_s:string,\n    data_username_s:string,\n    id_s:string,\n    primaryDescription_s:string,\n    siteId_s:string,\n    siteName_s:string,\n    updatedAt_t:datetime ,\n    userId_s:string,\n    event_name_s:string,\n    data_byUser_s:string,\n    data_role_s:string,\n    data_userScope_s:string,\n    description_s:string,\n    data_source_s:string,\n    data_expiryDateStr_s:string,\n    data_expiryTime_d:int,\n    data_networkquarantine_b:bool,\n    data_ruleCreationTime_d:int,\n    data_ruleDescription_s:string,\n    data_ruleExpirationMode_s:string,\n    data_ruleId_d:int,\n    data_ruleName_s:string,\n    data_ruleQueryDetails_s:string,\n    data_ruleQueryType_s:string,\n    data_ruleSeverity_s:string,\n    data_scopeId_d:int,\n    data_status_s:string,\n    data_systemUser_d:int,\n    data_treatasthreat_s:string,\n    data_userId_d:int,\n    data_userName_s:string,\n    secondaryDescription_s:string,\n    agentId_s:string,\n    data_computerName_s:string,\n    data_externalIp_s:string,\n    data_groupName_s:string,\n    data_system_b:bool,\n    data_uuid_g:string,\n    groupId_s:string,\n    groupName_s:string,\n    data_group_s:string,\n    data_optionalGroups_s:string,\n    data_createdAt_t:string,\n    data_downloadUrl_s:string,\n    data_filePath_s:string,\n    data_filename_s:string,\n    data_uploadedFilename_s:string,\n    comments_s:string,\n    data_newValue_s:string,\n    data_policy_id_s:string,\n    data_policyName_s:string,\n    data_newValue_b:bool,\n    data_shouldReboot_b:bool,\n    data_roleName_s:string,\n    data_scopeLevelName_s:string,\n    activeDirectory_computerDistinguishedName_s:string,\n    activeDirectory_computerMemberOf_s:string,\n    activeDirectory_lastUserDistinguishedName_s:string,\n    activeDirectory_lastUserMemberOf_s:string,\n    activeThreats_d:real,\n    agentVersion_s:string,\n    allowRemoteShell_b:bool,\n    appsVulnerabilityStatus_s:string,\n    computerName_s:string,\n    consoleMigrationStatus_s:string,\n    coreCount_d:real,\n    cpuCount_d:real ,\n    cpuId_s:string,\n    domain_s:string,\n    encryptedApplications_b:bool,\n    externalId_s:string,\n    externalIp_s:string,\n    firewallEnabled_b:bool,\n    groupIp_s:string,\n    inRemoteShellSession_b:bool,\n    infected_b:bool,\n    installerType_s:string,\n    isActive_b:bool,\n    isDecommissioned_b:bool,\n    isPendingUninstall_b:bool,\n    isUninstalled_b:bool,\n    isUpToDate_b:bool,\n    lastActiveDate_t:string,\n    lastIpToMgmt_s:string,\n    lastLoggedInUserName_s:string,\n    licenseKey_s:string,\n    locationEnabled_b:bool,\n    locationType_s:string,\n    locations_s:string,\n    machineType_s:string,\n    mitigationMode_s:string,\n    mitigationModeSuspicious_s:string,\n    modelName_s:string,\n    networkInterfaces_s:string,\n    networkQuarantineEnabled_b:bool,\n    networkStatus_s:string,\n    operationalState_s:string,\n    osArch_s:string,\n    osName_s:string,\n    osRevision_s:string,\n    osStartTime_t:datetime ,\n    osType_s:string,\n    rangerStatus_s:string,\n    rangerVersion_s:string,\n    registeredAt_t:string,\n    remoteProfilingState_s:string,\n    scanFinishedAt_t:string,\n    scanStartedAt_t:string,\n    scanStatus_s:string,\n    threatRebootRequired_b:bool,\n    totalMemory_d:real ,\n    userActionsNeeded_s:string,\n    uuid_g:string,\n    creator_s:string,\n    creatorId_s:string,\n    inherits_b:string ,\n    isDefault_b:string ,\n    name_s:string,\n    registrationToken_s:string,\n    totalAgents_d:real ,\n    AlertInfo:string,\n    type_s:string\n    )[];\nlet SentinelOneV1Empty_Union= union isfuzzy=true SentinelOne_CL,SentinelOneV1_Empty\n    | extend  \n            EventVendor=\"SentinelOne\",\n            EventProduct=\"SentinelOne\",\n        AccountId=column_ifexists('accountId_s', ''),\n        AccountName=column_ifexists('accountName_s', ''),\n        ActivityType=toreal(column_ifexists('activityType_d', '')),\n        EventCreationTime=todatetime(column_ifexists('createdAt_t', 'CreatedAt')),\n        DataAccountName=column_ifexists('data_accountName_s', ''),\n        DataFullScopeDetails=column_ifexists('data_fullScopeDetails_s', ''),\n        DataScopeLevel=column_ifexists('data_scopeLevel_s', ''),\n        DataScopeName=column_ifexists('data_scopeName_s', ''),\n        DataSiteId=column_ifexists('data_siteId_d', ''),\n        DataSiteName=column_ifexists('data_siteName_s', ''),\n        SrcUserName=column_ifexists('data_username_s', ''),\n        EventId=column_ifexists('id_s', ''),\n        EventOriginalMessage=column_ifexists('primaryDescription_s', ''),\n        PrimaryDescription=column_ifexists('primaryDescription_s', ''),\n        SiteId=column_ifexists('siteId_s', ''),\n        SiteName=column_ifexists('siteName_s', ''),\n        UpdatedAt=column_ifexists('updatedAt_t', ''),\n        UserIdentity=column_ifexists('userId_s', ''),\n        UserId=column_ifexists('userId_s', ''),\n        EventType=column_ifexists('event_name_s', ''),\n        DataByUser=column_ifexists('data_byUser_s', ''),\n        DataRole=column_ifexists('data_role_s', ''),\n        DataUserScope=column_ifexists('data_userScope_s', ''),\n        EventTypeDetailed=column_ifexists('description_s', ''),\n        DataSource=column_ifexists('data_source_s', ''),\n        DataExpiryDateStr=column_ifexists('data_expiryDateStr_s', ''),\n        DataExpiryTime=column_ifexists('data_expiryTime_d', ''),\n        DataNetworkquarantine=column_ifexists('data_networkquarantine_b', ''),\n        DataRuleCreationTime=column_ifexists('data_ruleCreationTime_d', ''),\n        DataRuleDescription=column_ifexists('data_ruleDescription_s', ''),\n        DataRuleExpirationMode=column_ifexists('data_ruleExpirationMode_s', ''),\n        DataRuleId=column_ifexists('data_ruleId_d', ''),\n        DataRuleName=column_ifexists('data_ruleName_s', ''),\n        DataRuleQueryDetails=column_ifexists('data_ruleQueryDetails_s', ''),\n        DataRuleQueryType=column_ifexists('data_ruleQueryType_s', ''),\n        DataRuleSeverity=column_ifexists('data_ruleSeverity_s', ''),\n        DataScopeId=column_ifexists('data_scopeId_d', ''),\n        Id=column_ifexists('id_s', ''),\n        DataStatus=column_ifexists('data_status_s', ''),\n        DataSystemUser=column_ifexists('data_systemUser_d', ''),\n        DataTreatasthreat=column_ifexists('data_treatasthreat_s', ''),\n        DataUserId=column_ifexists('data_userId_d', ''),\n        DataUserName=column_ifexists('data_userName_s', ''),\n        EventSubStatus=column_ifexists('secondaryDescription_s', ''),\n        SecondaryDescription=column_ifexists('secondaryDescription_s', ''),\n        AgentId=column_ifexists('agentId_s', ''),\n        DataComputerName=column_ifexists('data_computerName_s', ''),\n        DataExternalIp=column_ifexists('data_externalIp_s', ''),\n        DataGroupName=column_ifexists('data_groupName_s', ''),\n        DataSystem=column_ifexists('data_system_b', ''),\n        DataUuid=column_ifexists('data_uuid_g', ''),\n        GroupId=column_ifexists('groupId_s', ''),\n        GroupName=column_ifexists('groupName_s', ''),\n        DataGroup=column_ifexists('data_group_s', ''),\n        DataOptionalGroups=column_ifexists('data_optionalGroups_s', ''),\n        DataCreatedAt=column_ifexists('data_createdAt_t', ''),\n        DataDownloadUrl=column_ifexists('data_downloadUrl_s', ''),\n        DataFilePath=column_ifexists('data_filePath_s', ''),\n        DataFilename=column_ifexists('data_filename_s', ''),\n        DataUploadedFilename=column_ifexists('data_uploadedFilename_s', ''),\n        Comments=column_ifexists('comments_s', ''),\n        DataNewValue=column_ifexists('data_newValue_s', ''),\n        DataPolicyId=column_ifexists('data_policy_id_s', ''),\n        DataPolicyName=column_ifexists('data_policyName_s', ''),\n        DataNewValueb=column_ifexists('data_newValue_b', ''),\n        DataShouldReboot=column_ifexists('data_shouldReboot_b', ''),\n        DataRoleName=column_ifexists('data_roleName_s', ''),\n        DataScopeLevelName=column_ifexists('data_scopeLevelName_s', ''),\n        ActiveDirectoryComputerDistinguishedName=column_ifexists('activeDirectory_computerDistinguishedName_s', ''),\n        ActiveDirectoryComputerMemberOf=column_ifexists('activeDirectory_computerMemberOf_s', ''),\n        ActiveDirectoryLastUserDistinguishedName=column_ifexists('activeDirectory_lastUserDistinguishedName_s', ''),\n        ActiveDirectoryLastUserMemberOf=column_ifexists('activeDirectory_lastUserMemberOf_s', ''),\n        ActiveThreats=column_ifexists('activeThreats_d', ''),\n        AgentVersion=column_ifexists('agentVersion_s', ''),\n        AllowRemoteShell=column_ifexists('allowRemoteShell_b', ''),\n        AppsVulnerabilityStatus=column_ifexists('appsVulnerabilityStatus_s', ''),\n        ComputerName=column_ifexists('computerName_s', ''),\n        ConsoleMigrationStatus=column_ifexists('consoleMigrationStatus_s', ''),\n        CoreCount=column_ifexists('coreCount_d', ''),\n        CpuCount=column_ifexists('cpuCount_d', ''),\n        CpuId=column_ifexists('cpuId_s', ''),\n        SrcDvcDomain=column_ifexists('domain_s', ''),\n        EncryptedApplications=column_ifexists('encryptedApplications_b', ''),\n        ExternalId=column_ifexists('externalId_s', ''),\n        ExternalIp=column_ifexists('externalIp_s', ''),\n        FirewallEnabled=column_ifexists('firewallEnabled_b', ''),\n        GroupIp=column_ifexists('groupIp_s', ''),\n        InRemoteShellSession=column_ifexists('inRemoteShellSession_b', ''),\n        Infected=column_ifexists('infected_b', ''),\n        InstallerType=column_ifexists('installerType_s', ''),\n        IsActive=column_ifexists('isActive_b', ''),\n        IsDecommissioned=column_ifexists('isDecommissioned_b', ''),\n        IsPendingUninstall=column_ifexists('isPendingUninstall_b', ''),\n        IsUninstalled=column_ifexists('isUninstalled_b', ''),\n        IsUpToDate=column_ifexists('isUpToDate_b', ''),\n        LastActiveDate=column_ifexists('lastActiveDate_t', ''),\n        LastIpToMgmt=column_ifexists('lastIpToMgmt_s', ''),\n        LastLoggedInUserName=column_ifexists('lastLoggedInUserName_s', ''),\n        LicenseKey=column_ifexists('licenseKey_s', ''),\n        LocationEnabled=column_ifexists('locationEnabled_b', ''),\n        LocationType=column_ifexists('locationType_s', ''),\n        Locations=column_ifexists('locations_s', ''),\n        MachineType=column_ifexists('machineType_s', ''),\n        MitigationMode=column_ifexists('mitigationMode_s', ''),\n        MitigationModeSuspicious=column_ifexists('mitigationModeSuspicious_s', ''),\n        SrcDvcModelName=column_ifexists('modelName_s', ''),\n        NetworkInterfaces=column_ifexists('networkInterfaces_s', ''),\n        NetworkQuarantineEnabled=column_ifexists('networkQuarantineEnabled_b', ''),\n        NetworkStatus=column_ifexists('networkStatus_s', ''),\n        OperationalState=column_ifexists('operationalState_s', ''),\n        OsArch=column_ifexists('osArch_s', ''),\n        SrcDvcOs=column_ifexists('osName_s', ''),\n        OsRevision=column_ifexists('osRevision_s', ''),\n        OsStartTime=column_ifexists('osStartTime_t', ''),\n        OsType=column_ifexists('osType_s', ''),\n        RangerStatus=column_ifexists('rangerStatus_s', ''),\n        RangerVersion=column_ifexists('rangerVersion_s', ''),\n        RegisteredAt=column_ifexists('registeredAt_t', ''),\n        RemoteProfilingState=column_ifexists('remoteProfilingState_s', ''),\n        ScanFinishedAt=column_ifexists('scanFinishedAt_t', ''),\n        ScanStartedAt=column_ifexists('scanStartedAt_t', ''),\n        ScanStatus=column_ifexists('scanStatus_s', ''),\n        ThreatRebootRequired=column_ifexists('threatRebootRequired_b', ''),\n        TotalMemory=column_ifexists('totalMemory_d', ''),\n        UserActionsNeeded=column_ifexists('userActionsNeeded_s', ''),\n        Uuid=column_ifexists('uuid_g', ''),\n        Creator=column_ifexists('creator_s', ''),\n        CreatedAt=column_ifexists('createdAt_t',''),\n        CreatorId=column_ifexists('creatorId_s', ''),\n        Inherits=column_ifexists('inherits_b', ''),\n        IsDefault=column_ifexists('isDefault_b', ''),\n        Name=column_ifexists('name_s', ''),\n        RegistrationToken=column_ifexists('registrationToken_s', ''),\n        TotalAgents=column_ifexists('totalAgents_d', ''),\n        Type=column_ifexists('type_s', '');\n        union isfuzzy=true SentinelOneActivities_CL,SentinelOneAgents_CL,SentinelOneAlerts_CL,SentinelOneGroups_CL,SentinelOneThreats_CL,SentinelOneV1Empty_Union\n        | extend \n        ActivityType,\n        EventVendor=\"SentinelOne\",\n        EventProduct=\"SentinelOne\",\n        DataAccountName=tostring(parse_json(todynamic(Data)).accountName),\n        DataFullScopeDetails=tostring(parse_json(todynamic(Data)).fullScopeDetails),\n        DataScopeLevel=tostring(parse_json(todynamic(Data)).scopeLevel),\n        DataScopeName=tostring(parse_json(todynamic(Data)).scopeName),\n        DataSiteId=tostring(parse_json(todynamic(Data)).siteId),\n        DataSiteName=tostring(parse_json(todynamic(Data)).siteName),\n        SrcUserName=tostring(parse_json(todynamic(Data)).userName),\n        EventId=Id,\n        SourceParentProcessInfo,\n        EventOriginalMessage=PrimaryDescription,\n        UserIdentity=UserId,\n        EventTypeDetailed=Description,\n        DataRuleId=tostring(parse_json(todynamic(Data)).ruleId),\n        DataRuleName=tostring(parse_json(todynamic(Data)).rulename),\n        DataScopeId=tostring(parse_json(todynamic(Data)).scopeId),\n        DataSystemUser=tostring(parse_json(todynamic(Data)).systemUser),\n        DataUserId=tostring(parse_json(todynamic(Data)).userId),\n        DataUserName=tostring(parse_json(todynamic(Data)).userName),\n        EventSubStatus=SecondaryDescription,\n        DataComputerName=tostring(parse_json(todynamic(Data)).computerName),\n        DataExternalIp=tostring(parse_json(todynamic(Data)).externalIp),\n        DataGroupName=tostring(parse_json(todynamic(Data)).groupName),\n        DataStatus=tostring(parse_json(todynamic(Data)).status),\n        DataByUser=tostring(parse_json(todynamic(Data)).byUser),\n        DataRole=tostring(parse_json(todynamic(Data)).role),\n        DataUserScope=tostring(parse_json(todynamic(Data)).userScope),\n        DataSource=tostring(parse_json(todynamic(Data)).source),\n        DataExpiryDateStr=tostring(parse_json(todynamic(Data)).expiryDateStr),\n        DataExpiryTime=tostring(parse_json(todynamic(Data)).expiryTime),\n        DataNetworkquarantine=tostring(parse_json(todynamic(Data)).networkquarantine),\n        DataRuleCreationTime=tostring(parse_json(todynamic(Data)).ruleCreationTime),\n        DataUuid=Uuid,\n        DataGroup=tostring(parse_json(todynamic(Data)).group),\n        DataRuleDescription=tostring(parse_json(todynamic(Data)).ruleDescription),\n        EventType=tostring(parse_json(todynamic(AlertInfo)).eventType),\n        DataRuleExpirationMode=tostring(parse_json(todynamic(Data)).ruleExpirationMode),\n        DataRuleQueryDetails=tostring(parse_json(todynamic(Data)).ruleQueryDetails),\n        DataRuleQueryType=tostring(parse_json(todynamic(Data)).ruleQueryType),\n        DataRuleSeverity=tostring(parse_json(todynamic(Data)).ruleSeverity),\n        DataSystem=tostring(parse_json(todynamic(Data)).system),\n        DataOptionalGroups=tostring(parse_json(todynamic(Data)).optionalGroups),\n        DataCreatedAt=tostring(parse_json(todynamic(Data)).createdAt),\n        DataDownloadUrl=tostring(parse_json(todynamic(Data)).downloadUrl),\n        DataFilePath=tostring(parse_json(todynamic(Data)).filePath),\n        DataFilename=tostring(parse_json(todynamic(Data)).filename),\n        DataUploadedFilename=tostring(parse_json(todynamic(Data)).uploadedFilename),\n        DataNewValue=tostring(parse_json(todynamic(Data)).newValue),\n        DataPolicyId=tostring(parse_json(todynamic(Data)).policyId),\n        DataPolicyName=tostring(parse_json(todynamic(Data)).policyName),\n        DataShouldReboot=tostring(parse_json(todynamic(Data)).shouldReboot),\n        DataRoleName=tostring(parse_json(todynamic(Data)).roleName),\n        DataScopeLevelName=tostring(parse_json(todynamic(Data)).scopeLevelName),\n        ActiveDirectoryComputerDistinguishedName=tostring(parse_json(todynamic(ActiveDirectory)).computerDistinguishedName),\n        ActiveDirectoryComputerMemberOf=tostring(parse_json(todynamic(ActiveDirectory)).computerMemberOf),\n        ActiveDirectoryLastUserDistinguishedName=tostring(parse_json(todynamic(ActiveDirectory)).lastUserDistinguishedName),\n        ActiveDirectoryLastUserMemberOf=tostring(parse_json(todynamic(ActiveDirectory)).lastUserMemberOf),\n        SrcDvcDomain=Domain,\n        AlertInfo=tostring(AlertInfo),\n        FirewallEnabled=column_ifexists('FirewallEnabled',''),\n        IsUninstalled=column_ifexists('IsUninstalled',''),\n        EncryptedApplications=column_ifexists('EncryptedApplications',''),\n        OsStartTime=column_ifexists('OsStartTime',''),\n        InRemoteShellSession=column_ifexists('InRemoteShellSession',''),\n        ThreatRebootRequired=column_ifexists('ThreatRebootRequired',''),\n        IsPendingUninstall=column_ifexists('IsPendingUninstall',''),\n        IsUpToDate=column_ifexists('IsUpToDate',''),\n        IsDecommissioned=column_ifexists('IsDecommissioned',''),\n        IsActive=column_ifexists('IsActive',''),\n        Infected=column_ifexists('Infected',''),\n        AllowRemoteShell=column_ifexists('AllowRemoteShell',''),\n        LocationEnabled=column_ifexists('LocationEnabled',''),\n        SrcDvcModelName=ModelName,\n        NetworkQuarantineEnabled=column_ifexists('NetworkQuarantineEnabled',''),\n        SrcDvcOs=OsName,\n        SourceProcessInfo,\n        RuleInfo,\n        TargetProcessInfo,\n        ContainerInfo,\n        EventCreationTime=CreatedAt,\n        RemoteProfilingState=column_ifexists('RemoteProfilingState','')\n        | project\n        TimeGenerated, \n        EventVendor,\n        EventProduct,\n        AccountName,\n        SourceParentProcessInfo,\n        TargetProcessInfo,\n        ActivityType,\n        EventCreationTime,\n        DataAccountName,\n        DataFullScopeDetails,\n        DataScopeLevel,\n        DataScopeName,\n        DataSiteId,\n        SourceProcessInfo,\n        DataSiteName,\n        SrcUserName,\n        EventId,\n        EventOriginalMessage,\n        SiteId,\n        SiteName,\n        UpdatedAt,\n        UserIdentity,\n        EventType,\n        DataByUser,\n        DataRole,\n        DataUserScope,\n        EventTypeDetailed,\n        DataSource,\n        DataExpiryDateStr,\n        DataExpiryTime,\n        DataNetworkquarantine,\n        DataRuleCreationTime,\n        DataRuleDescription,\n        DataRuleExpirationMode,\n        DataRuleId,\n        DataRuleName,\n        DataRuleQueryDetails,\n        DataRuleQueryType,\n        DataRuleSeverity,\n        DataScopeId,\n        DataStatus,\n        DataSystemUser,\n        DataTreatasthreat,\n        DataUserId,\n        DataUserName,\n        EventSubStatus,\n        AgentId,\n        DataComputerName,\n        DataExternalIp,\n        DataGroupName,\n        DataSystem,\n        DataUuid,\n        GroupId,\n        GroupName,\n        DataGroup,\n        DataOptionalGroups,\n        DataCreatedAt,\n        DataDownloadUrl,\n        DataFilePath,\n        DataFilename,\n        DataUploadedFilename,\n        Comments,\n        DataNewValue,\n        DataPolicyId,\n        DataPolicyName,\n        DataNewValueb,\n        DataShouldReboot,\n        DataRoleName,\n        DataScopeLevelName,\n        ActiveDirectoryComputerDistinguishedName,\n        ActiveDirectoryComputerMemberOf,\n        ActiveDirectoryLastUserDistinguishedName,\n        ActiveDirectoryLastUserMemberOf,\n        ActiveThreats=toreal(activeThreats_d),\n        AgentVersion,\n        AllowRemoteShell,\n        AppsVulnerabilityStatus,\n        ComputerName,\n        ConsoleMigrationStatus,\n        CoreCount=toreal(coreCount_d),\n        CpuCount=toreal(cpuCount_d),\n        CpuId,\n        SrcDvcDomain,\n        EncryptedApplications,\n        ExternalId,\n        ExternalIp,\n        FirewallEnabled,\n        GroupIp,\n        InRemoteShellSession,\n        Infected,\n        InstallerType,\n        IsActive,\n        IsDecommissioned,\n        IsPendingUninstall,\n        IsUninstalled,\n        IsUpToDate,\n        LastActiveDate=tostring(LastActiveDate_datetime),\n        LastIpToMgmt,\n        LastLoggedInUserName,\n        LicenseKey,\n        LocationEnabled,\n        LocationType,\n        Locations,\n        MachineType,\n        MitigationMode,\n        MitigationModeSuspicious,\n        SrcDvcModelName,\n        NetworkInterfaces,\n        NetworkQuarantineEnabled,\n        NetworkStatus,\n        OperationalState,\n        OsArch,\n        SrcDvcOs,\n        OsRevision,\n        OsStartTime,\n        OsType,\n        RangerStatus,\n        RangerVersion,\n        RegisteredAt=tostring(RegisteredAt_datetime),\n        RemoteProfilingState,\n        ScanFinishedAt=tostring(ScanFinishedAt_datetime),\n        ScanStartedAt=tostring(ScanStartedAt_datetime),\n        ScanStatus,\n        ThreatRebootRequired,\n        TotalMemory=toreal(totalMemory_d),\n        UserActionsNeeded,\n        Uuid,\n        Creator,\n        CreatorId,\n        Inherits,\n        IsDefault,\n        Name,\n        AlertInfo,\n        RuleInfo,\n        ContainerInfo,\n        RegistrationToken,\n        TotalAgents=totalAgents_d,\n        Type;\n    };\n    SentinelOne_view\n",
                "functionParameters": "",
                "version": 2,
                "tags": [
                    {
                        "name": "description",
                        "value": ""
                    }
                ]
            }
        },
        {
            "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
            "apiVersion": "2022-01-01-preview",
            "location": "[parameters('workspace-location')]",
            "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('Parser-', last(split(resourceId('Microsoft.OperationalInsights/workspaces/savedSearches', parameters('workspace'), 'SentinelOne'),'/'))))]",
            "dependsOn": [
                "[resourceId('Microsoft.OperationalInsights/workspaces/savedSearches', parameters('workspace'), 'SentinelOne')]"
            ],
            "properties": {
                "parentId": "[resourceId('Microsoft.OperationalInsights/workspaces/savedSearches', parameters('workspace'), 'SentinelOne')]",
                "contentId": "SentinelOne-Parser",
                "kind": "Parser",
                "version": "1.0.1",
                "source": {
                    "kind": "Solution",
                    "name": "SentinelOne",
                    "sourceId": "azuresentinel.azure-sentinel-solution-sentinelone"
                },
                "author": {
                    "name": "Microsoft",
                    "email": "support@microsoft.com"
                },
                "support": {
                    "name": "Microsoft Corporation",
                    "email": "support@microsoft.com",
                    "tier": "Microsoft",
                    "link": "https://support.microsoft.com"
                }
            }
        },
        {
            "type": "Microsoft.OperationalInsights/workspaces/providers/contentTemplates",
            "apiVersion": "2023-04-01-preview",
            "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat(parameters('workspace'),'-ar-',uniquestring('382f37b3-b49a-492f-b436-a4717c8c5c3e')))]",
            "location": "[parameters('workspace-location')]",
            "dependsOn": [
                "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/contentPackages', 'azuresentinel.azure-sentinel-solution-sentinelone')]"
            ],
            "properties": {
                "description": "Detects admin user login from new location (IP address).",
                "mainTemplate": {
                    "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
                    "contentVersion": "1.0.1",
                    "parameters": {},
                    "variables": {},
                    "resources": [
                        {
                            "type": "Microsoft.SecurityInsights/AlertRuleTemplates",
                            "name": "382f37b3-b49a-492f-b436-a4717c8c5c3e",
                            "apiVersion": "2023-02-01-preview",
                            "kind": "Scheduled",
                            "location": "[parameters('workspace-location')]",
                            "properties": {
                                "description": "Detects admin user login from new location (IP address).",
                                "displayName": "Sentinel One - Admin login from new location",
                                "enabled": false,
                                "query": "let lback_period = 14d;\nlet lback_time = 1h;\nSentinelOne\n| where TimeGenerated between(ago(lback_period)..ago(lback_time))\n| where ActivityType == 27\n| where DataRole =~ 'Admin'\n| extend SrcIpAddr = extract(@'Address\\s(\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3})', 1, EventOriginalMessage)\n| where isnotempty(SrcIpAddr)\n| summarize ip_lst = makeset(SrcIpAddr) by SrcUserName\n| join (SentinelOne\n        | where ActivityType == 27\n        | where DataRole =~ 'Admin'\n        | extend SrcIpAddr = extract(@'Address\\s(\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3})', 1, EventOriginalMessage)\n        | where isnotempty(SrcIpAddr)) on SrcUserName\n| where ip_lst !has SrcIpAddr\n| extend AccountCustomEntity = SrcUserName, IPCustomEntity = SrcIpAddr\n",
                                "queryFrequency": "PT1H",
                                "queryPeriod": "P14D",
                                "severity": "High",
                                "suppressionDuration": "PT1H",
                                "suppressionEnabled": false,
                                "triggerOperator": "GreaterThan",
                                "triggerThreshold": 0,
                                "status": "Available",
                                "requiredDataConnectors": [
                                    {
                                        "connectorId": "SentinelOne",
                                        "dataTypes": [
                                            "SentinelOne"
                                        ]
                                    }
                                ],
                                "tactics": [
                                    "InitialAccess",
                                    "PrivilegeEscalation"
                                ],
                                "techniques": [
                                    "T1078"
                                ],
                                "entityMappings": [
                                    {
                                        "fieldMappings": [
                                            {
                                                "columnName": "AccountCustomEntity",
                                                "identifier": "Name"
                                            }
                                        ],
                                        "entityType": "Account"
                                    },
                                    {
                                        "fieldMappings": [
                                            {
                                                "columnName": "IPCustomEntity",
                                                "identifier": "Address"
                                            }
                                        ],
                                        "entityType": "IP"
                                    }
                                ]
                            }
                        },
                        {
                            "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
                            "apiVersion": "2022-01-01-preview",
                            "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('AnalyticsRule-', last(split(resourceId('Microsoft.SecurityInsights/AlertRuleTemplates', '382f37b3-b49a-492f-b436-a4717c8c5c3e'),'/'))))]",
                            "properties": {
                                "description": "SentinelOne Analytics Rule 1",
                                "parentId": "[resourceId('Microsoft.SecurityInsights/AlertRuleTemplates', '382f37b3-b49a-492f-b436-a4717c8c5c3e')]",
                                "contentId": "382f37b3-b49a-492f-b436-a4717c8c5c3e",
                                "kind": "AnalyticsRule",
                                "version": "1.0.1",
                                "source": {
                                    "kind": "Solution",
                                    "name": "SentinelOne",
                                    "sourceId": "azuresentinel.azure-sentinel-solution-sentinelone"
                                },
                                "author": {
                                    "name": "Microsoft",
                                    "email": "support@microsoft.com"
                                },
                                "support": {
                                    "name": "Microsoft Corporation",
                                    "email": "support@microsoft.com",
                                    "tier": "Microsoft",
                                    "link": "https://support.microsoft.com"
                                }
                            }
                        }
                    ]
                },
                "packageKind": "Solution",
                "packageVersion": "3.0.6",
                "packageName": "SentinelOne",
                "packageId": "azuresentinel.azure-sentinel-solution-sentinelone",
                "contentSchemaVersion": "3.0.0",
                "contentId": "382f37b3-b49a-492f-b436-a4717c8c5c3e",
                "contentKind": "AnalyticsRule",
                "displayName": "Sentinel One - Admin login from new location",
                "contentProductId": "azuresentinel.azure-sentinel-solution-sentinelone-ar-qckni3jdgoblc",
                "id": "azuresentinel.azure-sentinel-solution-sentinelone-ar-qckni3jdgoblc",
                "version": "1.0.1",
                "isDeprecated": false,
                "dependencies": {
                    "operator": "AND",
                    "criteria": [
                        {
                            "contentKind": "DataType",
                            "contentId": "SentinelOne"
                        },
                        {
                            "contentKind": "DataConnector",
                            "contentId": "SentinelOne"
                        }
                    ]
                }
            }
        },
        {
            "type": "Microsoft.OperationalInsights/workspaces/providers/contentTemplates",
            "apiVersion": "2023-04-01-preview",
            "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat(parameters('workspace'),'-ar-',uniquestring('4ad87e4a-d045-4c6b-9652-c9de27fcb442')))]",
            "location": "[parameters('workspace-location')]",
            "dependsOn": [
                "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/contentPackages', 'azuresentinel.azure-sentinel-solution-sentinelone')]"
            ],
            "properties": {
                "description": "Detects when agent was uninstalled from multiple hosts.",
                "mainTemplate": {
                    "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
                    "contentVersion": "1.0.2",
                    "parameters": {},
                    "variables": {},
                    "resources": [
                        {
                            "type": "Microsoft.SecurityInsights/AlertRuleTemplates",
                            "name": "4ad87e4a-d045-4c6b-9652-c9de27fcb442",
                            "apiVersion": "2023-02-01-preview",
                            "kind": "Scheduled",
                            "location": "[parameters('workspace-location')]",
                            "properties": {
                                "description": "Detects when agent was uninstalled from multiple hosts.",
                                "displayName": "Sentinel One - Agent uninstalled from multiple hosts",
                                "enabled": false,
                                "query": "SentinelOne\n| where ActivityType == 51\n| summarize count() by DataComputerName, bin(TimeGenerated, 30m)\n| where count_ > 1\n",
                                "queryFrequency": "PT1H",
                                "queryPeriod": "PT1H",
                                "severity": "High",
                                "suppressionDuration": "PT1H",
                                "suppressionEnabled": false,
                                "triggerOperator": "GreaterThan",
                                "triggerThreshold": 0,
                                "status": "Available",
                                "requiredDataConnectors": [
                                    {
                                        "connectorId": "SentinelOne",
                                        "dataTypes": [
                                            "SentinelOne"
                                        ]
                                    }
                                ],
                                "tactics": [
                                    "DefenseEvasion"
                                ],
                                "techniques": [
                                    "T1070"
                                ],
                                "entityMappings": [
                                    {
                                        "fieldMappings": [
                                            {
                                                "columnName": "DataComputerName",
                                                "identifier": "HostName"
                                            }
                                        ],
                                        "entityType": "Host"
                                    }
                                ]
                            }
                        },
                        {
                            "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
                            "apiVersion": "2022-01-01-preview",
                            "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('AnalyticsRule-', last(split(resourceId('Microsoft.SecurityInsights/AlertRuleTemplates', '4ad87e4a-d045-4c6b-9652-c9de27fcb442'),'/'))))]",
                            "properties": {
                                "description": "SentinelOne Analytics Rule 2",
                                "parentId": "[resourceId('Microsoft.SecurityInsights/AlertRuleTemplates', '4ad87e4a-d045-4c6b-9652-c9de27fcb442')]",
                                "contentId": "4ad87e4a-d045-4c6b-9652-c9de27fcb442",
                                "kind": "AnalyticsRule",
                                "version": "1.0.2",
                                "source": {
                                    "kind": "Solution",
                                    "name": "SentinelOne",
                                    "sourceId": "azuresentinel.azure-sentinel-solution-sentinelone"
                                },
                                "author": {
                                    "name": "Microsoft",
                                    "email": "support@microsoft.com"
                                },
                                "support": {
                                    "name": "Microsoft Corporation",
                                    "email": "support@microsoft.com",
                                    "tier": "Microsoft",
                                    "link": "https://support.microsoft.com"
                                }
                            }
                        }
                    ]
                },
                "packageKind": "Solution",
                "packageVersion": "3.0.6",
                "packageName": "SentinelOne",
                "packageId": "azuresentinel.azure-sentinel-solution-sentinelone",
                "contentSchemaVersion": "3.0.0",
                "contentId": "4ad87e4a-d045-4c6b-9652-c9de27fcb442",
                "contentKind": "AnalyticsRule",
                "displayName": "Sentinel One - Agent uninstalled from multiple hosts",
                "contentProductId": "azuresentinel.azure-sentinel-solution-sentinelone-ar-uav5ornr5qbla",
                "id": "azuresentinel.azure-sentinel-solution-sentinelone-ar-uav5ornr5qbla",
                "version": "1.0.2",
                "isDeprecated": false,
                "dependencies": {
                    "operator": "AND",
                    "criteria": [
                        {
                            "contentKind": "DataType",
                            "contentId": "SentinelOne"
                        },
                        {
                            "contentKind": "DataConnector",
                            "contentId": "SentinelOne"
                        }
                    ]
                }
            }
        },
        {
            "type": "Microsoft.OperationalInsights/workspaces/providers/contentTemplates",
            "apiVersion": "2023-04-01-preview",
            "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat(parameters('workspace'),'-ar-',uniquestring('5f37de91-ff2b-45fb-9eda-49e9f76a3942')))]",
            "location": "[parameters('workspace-location')]",
            "dependsOn": [
                "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/contentPackages', 'azuresentinel.azure-sentinel-solution-sentinelone')]"
            ],
            "properties": {
                "description": "Detects when alert from custom rule received.",
                "mainTemplate": {
                    "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
                    "contentVersion": "1.0.2",
                    "parameters": {},
                    "variables": {},
                    "resources": [
                        {
                            "type": "Microsoft.SecurityInsights/AlertRuleTemplates",
                            "name": "5f37de91-ff2b-45fb-9eda-49e9f76a3942",
                            "apiVersion": "2023-02-01-preview",
                            "kind": "Scheduled",
                            "location": "[parameters('workspace-location')]",
                            "properties": {
                                "description": "Detects when alert from custom rule received.",
                                "displayName": "Sentinel One - Alert from custom rule",
                                "enabled": false,
                                "query": "SentinelOne\n| where ActivityType == 3608\n| extend RuleName = extract(@'Custom Rule:\\s(.*?)\\sin Group', 1, EventOriginalMessage)\n| extend DstHostname = extract(@'detected on\\s(\\S+)\\.', 1, EventOriginalMessage)\n| extend HostCustomEntity = DstHostname\n",
                                "queryFrequency": "PT1H",
                                "queryPeriod": "PT1H",
                                "severity": "High",
                                "suppressionDuration": "PT1H",
                                "suppressionEnabled": false,
                                "triggerOperator": "GreaterThan",
                                "triggerThreshold": 0,
                                "status": "Available",
                                "requiredDataConnectors": [
                                    {
                                        "connectorId": "SentinelOne",
                                        "dataTypes": [
                                            "SentinelOne"
                                        ]
                                    }
                                ],
                                "tactics": [
                                    "InitialAccess"
                                ],
                                "techniques": [
                                    "T1190"
                                ],
                                "entityMappings": [
                                    {
                                        "fieldMappings": [
                                            {
                                                "columnName": "HostCustomEntity",
                                                "identifier": "HostName"
                                            }
                                        ],
                                        "entityType": "Host"
                                    }
                                ]
                            }
                        },
                        {
                            "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
                            "apiVersion": "2022-01-01-preview",
                            "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('AnalyticsRule-', last(split(resourceId('Microsoft.SecurityInsights/AlertRuleTemplates', '5f37de91-ff2b-45fb-9eda-49e9f76a3942'),'/'))))]",
                            "properties": {
                                "description": "SentinelOne Analytics Rule 3",
                                "parentId": "[resourceId('Microsoft.SecurityInsights/AlertRuleTemplates', '5f37de91-ff2b-45fb-9eda-49e9f76a3942')]",
                                "contentId": "5f37de91-ff2b-45fb-9eda-49e9f76a3942",
                                "kind": "AnalyticsRule",
                                "version": "1.0.2",
                                "source": {
                                    "kind": "Solution",
                                    "name": "SentinelOne",
                                    "sourceId": "azuresentinel.azure-sentinel-solution-sentinelone"
                                },
                                "author": {
                                    "name": "Microsoft",
                                    "email": "support@microsoft.com"
                                },
                                "support": {
                                    "name": "Microsoft Corporation",
                                    "email": "support@microsoft.com",
                                    "tier": "Microsoft",
                                    "link": "https://support.microsoft.com"
                                }
                            }
                        }
                    ]
                },
                "packageKind": "Solution",
                "packageVersion": "3.0.6",
                "packageName": "SentinelOne",
                "packageId": "azuresentinel.azure-sentinel-solution-sentinelone",
                "contentSchemaVersion": "3.0.0",
                "contentId": "5f37de91-ff2b-45fb-9eda-49e9f76a3942",
                "contentKind": "AnalyticsRule",
                "displayName": "Sentinel One - Alert from custom rule",
                "contentProductId": "azuresentinel.azure-sentinel-solution-sentinelone-ar-j7pwzhpp7heki",
                "id": "azuresentinel.azure-sentinel-solution-sentinelone-ar-j7pwzhpp7heki",
                "version": "1.0.2",
                "isDeprecated": false,
                "dependencies": {
                    "operator": "AND",
                    "criteria": [
                        {
                            "contentKind": "DataType",
                            "contentId": "SentinelOne"
                        },
                        {
                            "contentKind": "DataConnector",
                            "contentId": "SentinelOne"
                        }
                    ]
                }
            }
        },
        {
            "type": "Microsoft.OperationalInsights/workspaces/providers/contentTemplates",
            "apiVersion": "2023-04-01-preview",
            "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat(parameters('workspace'),'-ar-',uniquestring('de339761-2298-4b37-8f1b-80ebd4f0b5f6')))]",
            "location": "[parameters('workspace-location')]",
            "dependsOn": [
                "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/contentPackages', 'azuresentinel.azure-sentinel-solution-sentinelone')]"
            ],
            "properties": {
                "description": "Detects when blacklist hash was deleted.",
                "mainTemplate": {
                    "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
                    "contentVersion": "1.0.0",
                    "parameters": {},
                    "variables": {},
                    "resources": [
                        {
                            "type": "Microsoft.SecurityInsights/AlertRuleTemplates",
                            "name": "de339761-2298-4b37-8f1b-80ebd4f0b5f6",
                            "apiVersion": "2023-02-01-preview",
                            "kind": "Scheduled",
                            "location": "[parameters('workspace-location')]",
                            "properties": {
                                "description": "Detects when blacklist hash was deleted.",
                                "displayName": "Sentinel One - Blacklist hash deleted",
                                "enabled": false,
                                "query": "SentinelOne\n| where ActivityType == 3020\n| project EventCreationTime, SrcUserName, Hash=EventSubStatus\n| extend AccountCustomEntity = SrcUserName, HashCustomEntity = Hash, HashAlgorithmCustomEntity = \"SHA1\"\n",
                                "queryFrequency": "PT1H",
                                "queryPeriod": "PT1H",
                                "severity": "Medium",
                                "suppressionDuration": "PT1H",
                                "suppressionEnabled": false,
                                "triggerOperator": "GreaterThan",
                                "triggerThreshold": 0,
                                "status": "Available",
                                "requiredDataConnectors": [
                                    {
                                        "connectorId": "SentinelOne",
                                        "dataTypes": [
                                            "SentinelOne"
                                        ]
                                    }
                                ],
                                "tactics": [
                                    "DefenseEvasion"
                                ],
                                "techniques": [
                                    "T1070"
                                ],
                                "entityMappings": [
                                    {
                                        "fieldMappings": [
                                            {
                                                "columnName": "AccountCustomEntity",
                                                "identifier": "Name"
                                            }
                                        ],
                                        "entityType": "Account"
                                    },
                                    {
                                        "fieldMappings": [
                                            {
                                                "columnName": "HashCustomEntity",
                                                "identifier": "Value"
                                            },
                                            {
                                                "columnName": "HashAlgorithmCustomEntity",
                                                "identifier": "Algorithm"
                                            }
                                        ],
                                        "entityType": "FileHash"
                                    }
                                ]
                            }
                        },
                        {
                            "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
                            "apiVersion": "2022-01-01-preview",
                            "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('AnalyticsRule-', last(split(resourceId('Microsoft.SecurityInsights/AlertRuleTemplates', 'de339761-2298-4b37-8f1b-80ebd4f0b5f6'),'/'))))]",
                            "properties": {
                                "description": "SentinelOne Analytics Rule 4",
                                "parentId": "[resourceId('Microsoft.SecurityInsights/AlertRuleTemplates', 'de339761-2298-4b37-8f1b-80ebd4f0b5f6')]",
                                "contentId": "de339761-2298-4b37-8f1b-80ebd4f0b5f6",
                                "kind": "AnalyticsRule",
                                "version": "1.0.0",
                                "source": {
                                    "kind": "Solution",
                                    "name": "SentinelOne",
                                    "sourceId": "azuresentinel.azure-sentinel-solution-sentinelone"
                                },
                                "author": {
                                    "name": "Microsoft",
                                    "email": "support@microsoft.com"
                                },
                                "support": {
                                    "name": "Microsoft Corporation",
                                    "email": "support@microsoft.com",
                                    "tier": "Microsoft",
                                    "link": "https://support.microsoft.com"
                                }
                            }
                        }
                    ]
                },
                "packageKind": "Solution",
                "packageVersion": "3.0.6",
                "packageName": "SentinelOne",
                "packageId": "azuresentinel.azure-sentinel-solution-sentinelone",
                "contentSchemaVersion": "3.0.0",
                "contentId": "de339761-2298-4b37-8f1b-80ebd4f0b5f6",
                "contentKind": "AnalyticsRule",
                "displayName": "Sentinel One - Blacklist hash deleted",
                "contentProductId": "azuresentinel.azure-sentinel-solution-sentinelone-ar-fq5gsl5qtinh6",
                "id": "azuresentinel.azure-sentinel-solution-sentinelone-ar-fq5gsl5qtinh6",
                "version": "1.0.0",
                "isDeprecated": false,
                "dependencies": {
                    "operator": "AND",
                    "criteria": [
                        {
                            "contentKind": "DataType",
                            "contentId": "SentinelOne"
                        },
                        {
                            "contentKind": "DataConnector",
                            "contentId": "SentinelOne"
                        }
                    ]
                }
            }
        },
        {
            "type": "Microsoft.OperationalInsights/workspaces/providers/contentTemplates",
            "apiVersion": "2023-04-01-preview",
            "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat(parameters('workspace'),'-ar-',uniquestring('4224409f-a7bf-45eb-a931-922d79575a05')))]",
            "location": "[parameters('workspace-location')]",
            "dependsOn": [
                "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/contentPackages', 'azuresentinel.azure-sentinel-solution-sentinelone')]"
            ],
            "properties": {
                "description": "Detects when new exclusion added.",
                "mainTemplate": {
                    "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
                    "contentVersion": "1.0.0",
                    "parameters": {},
                    "variables": {},
                    "resources": [
                        {
                            "type": "Microsoft.SecurityInsights/AlertRuleTemplates",
                            "name": "4224409f-a7bf-45eb-a931-922d79575a05",
                            "apiVersion": "2023-02-01-preview",
                            "kind": "Scheduled",
                            "location": "[parameters('workspace-location')]",
                            "properties": {
                                "description": "Detects when new exclusion added.",
                                "displayName": "Sentinel One - Exclusion added",
                                "enabled": false,
                                "query": "SentinelOne\n| where EventOriginalMessage has_all ('added', 'exclusion')\n| project EventCreationTime, SrcUserName, EventOriginalMessage\n| extend AccountCustomEntity = SrcUserName\n",
                                "queryFrequency": "PT1H",
                                "queryPeriod": "PT1H",
                                "severity": "Medium",
                                "suppressionDuration": "PT1H",
                                "suppressionEnabled": false,
                                "triggerOperator": "GreaterThan",
                                "triggerThreshold": 0,
                                "status": "Available",
                                "requiredDataConnectors": [
                                    {
                                        "connectorId": "SentinelOne",
                                        "dataTypes": [
                                            "SentinelOne"
                                        ]
                                    }
                                ],
                                "tactics": [
                                    "DefenseEvasion"
                                ],
                                "techniques": [
                                    "T1070"
                                ],
                                "entityMappings": [
                                    {
                                        "fieldMappings": [
                                            {
                                                "columnName": "AccountCustomEntity",
                                                "identifier": "Name"
                                            }
                                        ],
                                        "entityType": "Account"
                                    }
                                ]
                            }
                        },
                        {
                            "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
                            "apiVersion": "2022-01-01-preview",
                            "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('AnalyticsRule-', last(split(resourceId('Microsoft.SecurityInsights/AlertRuleTemplates', '4224409f-a7bf-45eb-a931-922d79575a05'),'/'))))]",
                            "properties": {
                                "description": "SentinelOne Analytics Rule 5",
                                "parentId": "[resourceId('Microsoft.SecurityInsights/AlertRuleTemplates', '4224409f-a7bf-45eb-a931-922d79575a05')]",
                                "contentId": "4224409f-a7bf-45eb-a931-922d79575a05",
                                "kind": "AnalyticsRule",
                                "version": "1.0.0",
                                "source": {
                                    "kind": "Solution",
                                    "name": "SentinelOne",
                                    "sourceId": "azuresentinel.azure-sentinel-solution-sentinelone"
                                },
                                "author": {
                                    "name": "Microsoft",
                                    "email": "support@microsoft.com"
                                },
                                "support": {
                                    "name": "Microsoft Corporation",
                                    "email": "support@microsoft.com",
                                    "tier": "Microsoft",
                                    "link": "https://support.microsoft.com"
                                }
                            }
                        }
                    ]
                },
                "packageKind": "Solution",
                "packageVersion": "3.0.6",
                "packageName": "SentinelOne",
                "packageId": "azuresentinel.azure-sentinel-solution-sentinelone",
                "contentSchemaVersion": "3.0.0",
                "contentId": "4224409f-a7bf-45eb-a931-922d79575a05",
                "contentKind": "AnalyticsRule",
                "displayName": "Sentinel One - Exclusion added",
                "contentProductId": "azuresentinel.azure-sentinel-solution-sentinelone-ar-jz676kkz5euls",
                "id": "azuresentinel.azure-sentinel-solution-sentinelone-ar-jz676kkz5euls",
                "version": "1.0.0",
                "isDeprecated": false,
                "dependencies": {
                    "operator": "AND",
                    "criteria": [
                        {
                            "contentKind": "DataType",
                            "contentId": "SentinelOne"
                        },
                        {
                            "contentKind": "DataConnector",
                            "contentId": "SentinelOne"
                        }
                    ]
                }
            }
        },
        {
            "type": "Microsoft.OperationalInsights/workspaces/providers/contentTemplates",
            "apiVersion": "2023-04-01-preview",
            "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat(parameters('workspace'),'-ar-',uniquestring('47e427e6-61bc-4e24-8d16-a12871b9f939')))]",
            "location": "[parameters('workspace-location')]",
            "dependsOn": [
                "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/contentPackages', 'azuresentinel.azure-sentinel-solution-sentinelone')]"
            ],
            "properties": {
                "description": "Detects when multiple alerts received from same host.",
                "mainTemplate": {
                    "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
                    "contentVersion": "1.0.2",
                    "parameters": {},
                    "variables": {},
                    "resources": [
                        {
                            "type": "Microsoft.SecurityInsights/AlertRuleTemplates",
                            "name": "47e427e6-61bc-4e24-8d16-a12871b9f939",
                            "apiVersion": "2023-02-01-preview",
                            "kind": "Scheduled",
                            "location": "[parameters('workspace-location')]",
                            "properties": {
                                "description": "Detects when multiple alerts received from same host.",
                                "displayName": "Sentinel One - Multiple alerts on host",
                                "enabled": false,
                                "query": "SentinelOne\n| where ActivityType == 3608\n| extend RuleName = extract(@'Custom Rule:\\s(.*?)\\sin Group', 1, EventOriginalMessage)\n| extend DstHostname = extract(@'detected on\\s(\\S+)\\.', 1, EventOriginalMessage)\n| summarize count() by DstHostname, bin(TimeGenerated, 15m)\n| where count_ > 1\n| extend HostCustomEntity = DstHostname\n",
                                "queryFrequency": "PT1H",
                                "queryPeriod": "PT1H",
                                "severity": "High",
                                "suppressionDuration": "PT1H",
                                "suppressionEnabled": false,
                                "triggerOperator": "GreaterThan",
                                "triggerThreshold": 0,
                                "status": "Available",
                                "requiredDataConnectors": [
                                    {
                                        "connectorId": "SentinelOne",
                                        "dataTypes": [
                                            "SentinelOne"
                                        ]
                                    }
                                ],
                                "tactics": [
                                    "InitialAccess"
                                ],
                                "techniques": [
                                    "T1190"
                                ],
                                "entityMappings": [
                                    {
                                        "fieldMappings": [
                                            {
                                                "columnName": "HostCustomEntity",
                                                "identifier": "HostName"
                                            }
                                        ],
                                        "entityType": "Host"
                                    }
                                ]
                            }
                        },
                        {
                            "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
                            "apiVersion": "2022-01-01-preview",
                            "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('AnalyticsRule-', last(split(resourceId('Microsoft.SecurityInsights/AlertRuleTemplates', '47e427e6-61bc-4e24-8d16-a12871b9f939'),'/'))))]",
                            "properties": {
                                "description": "SentinelOne Analytics Rule 6",
                                "parentId": "[resourceId('Microsoft.SecurityInsights/AlertRuleTemplates', '47e427e6-61bc-4e24-8d16-a12871b9f939')]",
                                "contentId": "47e427e6-61bc-4e24-8d16-a12871b9f939",
                                "kind": "AnalyticsRule",
                                "version": "1.0.2",
                                "source": {
                                    "kind": "Solution",
                                    "name": "SentinelOne",
                                    "sourceId": "azuresentinel.azure-sentinel-solution-sentinelone"
                                },
                                "author": {
                                    "name": "Microsoft",
                                    "email": "support@microsoft.com"
                                },
                                "support": {
                                    "name": "Microsoft Corporation",
                                    "email": "support@microsoft.com",
                                    "tier": "Microsoft",
                                    "link": "https://support.microsoft.com"
                                }
                            }
                        }
                    ]
                },
                "packageKind": "Solution",
                "packageVersion": "3.0.6",
                "packageName": "SentinelOne",
                "packageId": "azuresentinel.azure-sentinel-solution-sentinelone",
                "contentSchemaVersion": "3.0.0",
                "contentId": "47e427e6-61bc-4e24-8d16-a12871b9f939",
                "contentKind": "AnalyticsRule",
                "displayName": "Sentinel One - Multiple alerts on host",
                "contentProductId": "azuresentinel.azure-sentinel-solution-sentinelone-ar-mf5w5tqlsl3mm",
                "id": "azuresentinel.azure-sentinel-solution-sentinelone-ar-mf5w5tqlsl3mm",
                "version": "1.0.2",
                "isDeprecated": false,
                "dependencies": {
                    "operator": "AND",
                    "criteria": [
                        {
                            "contentKind": "DataType",
                            "contentId": "SentinelOne"
                        },
                        {
                            "contentKind": "DataConnector",
                            "contentId": "SentinelOne"
                        }
                    ]
                }
            }
        },
        {
            "type": "Microsoft.OperationalInsights/workspaces/providers/contentTemplates",
            "apiVersion": "2023-04-01-preview",
            "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat(parameters('workspace'),'-ar-',uniquestring('e73d293d-966c-47ec-b8e0-95255755f12c')))]",
            "location": "[parameters('workspace-location')]",
            "dependsOn": [
                "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/contentPackages', 'azuresentinel.azure-sentinel-solution-sentinelone')]"
            ],
            "properties": {
                "description": "Detects when new admin user is created.",
                "mainTemplate": {
                    "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
                    "contentVersion": "1.0.0",
                    "parameters": {},
                    "variables": {},
                    "resources": [
                        {
                            "type": "Microsoft.SecurityInsights/AlertRuleTemplates",
                            "name": "e73d293d-966c-47ec-b8e0-95255755f12c",
                            "apiVersion": "2023-02-01-preview",
                            "kind": "Scheduled",
                            "location": "[parameters('workspace-location')]",
                            "properties": {
                                "description": "Detects when new admin user is created.",
                                "displayName": "Sentinel One - New admin created",
                                "enabled": false,
                                "query": "SentinelOne\n| where ActivityType == 23\n| extend AccountCustomEntity = SrcUserName\n",
                                "queryFrequency": "PT1H",
                                "queryPeriod": "PT1H",
                                "severity": "Medium",
                                "suppressionDuration": "PT1H",
                                "suppressionEnabled": false,
                                "triggerOperator": "GreaterThan",
                                "triggerThreshold": 0,
                                "status": "Available",
                                "requiredDataConnectors": [
                                    {
                                        "connectorId": "SentinelOne",
                                        "dataTypes": [
                                            "SentinelOne"
                                        ]
                                    }
                                ],
                                "tactics": [
                                    "PrivilegeEscalation"
                                ],
                                "techniques": [
                                    "T1078"
                                ],
                                "entityMappings": [
                                    {
                                        "fieldMappings": [
                                            {
                                                "columnName": "AccountCustomEntity",
                                                "identifier": "Name"
                                            }
                                        ],
                                        "entityType": "Account"
                                    }
                                ]
                            }
                        },
                        {
                            "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
                            "apiVersion": "2022-01-01-preview",
                            "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('AnalyticsRule-', last(split(resourceId('Microsoft.SecurityInsights/AlertRuleTemplates', 'e73d293d-966c-47ec-b8e0-95255755f12c'),'/'))))]",
                            "properties": {
                                "description": "SentinelOne Analytics Rule 7",
                                "parentId": "[resourceId('Microsoft.SecurityInsights/AlertRuleTemplates', 'e73d293d-966c-47ec-b8e0-95255755f12c')]",
                                "contentId": "e73d293d-966c-47ec-b8e0-95255755f12c",
                                "kind": "AnalyticsRule",
                                "version": "1.0.0",
                                "source": {
                                    "kind": "Solution",
                                    "name": "SentinelOne",
                                    "sourceId": "azuresentinel.azure-sentinel-solution-sentinelone"
                                },
                                "author": {
                                    "name": "Microsoft",
                                    "email": "support@microsoft.com"
                                },
                                "support": {
                                    "name": "Microsoft Corporation",
                                    "email": "support@microsoft.com",
                                    "tier": "Microsoft",
                                    "link": "https://support.microsoft.com"
                                }
                            }
                        }
                    ]
                },
                "packageKind": "Solution",
                "packageVersion": "3.0.6",
                "packageName": "SentinelOne",
                "packageId": "azuresentinel.azure-sentinel-solution-sentinelone",
                "contentSchemaVersion": "3.0.0",
                "contentId": "e73d293d-966c-47ec-b8e0-95255755f12c",
                "contentKind": "AnalyticsRule",
                "displayName": "Sentinel One - New admin created",
                "contentProductId": "azuresentinel.azure-sentinel-solution-sentinelone-ar-zu5qghlejy6lm",
                "id": "azuresentinel.azure-sentinel-solution-sentinelone-ar-zu5qghlejy6lm",
                "version": "1.0.0",
                "isDeprecated": false,
                "dependencies": {
                    "operator": "AND",
                    "criteria": [
                        {
                            "contentKind": "DataType",
                            "contentId": "SentinelOne"
                        },
                        {
                            "contentKind": "DataConnector",
                            "contentId": "SentinelOne"
                        }
                    ]
                }
            }
        },
        {
            "type": "Microsoft.OperationalInsights/workspaces/providers/contentTemplates",
            "apiVersion": "2023-04-01-preview",
            "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat(parameters('workspace'),'-ar-',uniquestring('e171b587-22bd-46ec-b96c-7c99024847a7')))]",
            "location": "[parameters('workspace-location')]",
            "dependsOn": [
                "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/contentPackages', 'azuresentinel.azure-sentinel-solution-sentinelone')]"
            ],
            "properties": {
                "description": "Detects when a rule was deleted.",
                "mainTemplate": {
                    "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
                    "contentVersion": "1.0.0",
                    "parameters": {},
                    "variables": {},
                    "resources": [
                        {
                            "type": "Microsoft.SecurityInsights/AlertRuleTemplates",
                            "name": "e171b587-22bd-46ec-b96c-7c99024847a7",
                            "apiVersion": "2023-02-01-preview",
                            "kind": "Scheduled",
                            "location": "[parameters('workspace-location')]",
                            "properties": {
                                "description": "Detects when a rule was deleted.",
                                "displayName": "Sentinel One - Rule deleted",
                                "enabled": false,
                                "query": "SentinelOne\n| where ActivityType == 3602\n| project EventCreationTime, DataRuleName, DataRuleQueryDetails, DataUserName\n| extend AccountCustomEntity = DataUserName\n",
                                "queryFrequency": "PT1H",
                                "queryPeriod": "PT1H",
                                "severity": "Medium",
                                "suppressionDuration": "PT1H",
                                "suppressionEnabled": false,
                                "triggerOperator": "GreaterThan",
                                "triggerThreshold": 0,
                                "status": "Available",
                                "requiredDataConnectors": [
                                    {
                                        "connectorId": "SentinelOne",
                                        "dataTypes": [
                                            "SentinelOne"
                                        ]
                                    }
                                ],
                                "tactics": [
                                    "DefenseEvasion"
                                ],
                                "techniques": [
                                    "T1070"
                                ],
                                "entityMappings": [
                                    {
                                        "fieldMappings": [
                                            {
                                                "columnName": "AccountCustomEntity",
                                                "identifier": "Name"
                                            }
                                        ],
                                        "entityType": "Account"
                                    }
                                ]
                            }
                        },
                        {
                            "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
                            "apiVersion": "2022-01-01-preview",
                            "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('AnalyticsRule-', last(split(resourceId('Microsoft.SecurityInsights/AlertRuleTemplates', 'e171b587-22bd-46ec-b96c-7c99024847a7'),'/'))))]",
                            "properties": {
                                "description": "SentinelOne Analytics Rule 8",
                                "parentId": "[resourceId('Microsoft.SecurityInsights/AlertRuleTemplates', 'e171b587-22bd-46ec-b96c-7c99024847a7')]",
                                "contentId": "e171b587-22bd-46ec-b96c-7c99024847a7",
                                "kind": "AnalyticsRule",
                                "version": "1.0.0",
                                "source": {
                                    "kind": "Solution",
                                    "name": "SentinelOne",
                                    "sourceId": "azuresentinel.azure-sentinel-solution-sentinelone"
                                },
                                "author": {
                                    "name": "Microsoft",
                                    "email": "support@microsoft.com"
                                },
                                "support": {
                                    "name": "Microsoft Corporation",
                                    "email": "support@microsoft.com",
                                    "tier": "Microsoft",
                                    "link": "https://support.microsoft.com"
                                }
                            }
                        }
                    ]
                },
                "packageKind": "Solution",
                "packageVersion": "3.0.6",
                "packageName": "SentinelOne",
                "packageId": "azuresentinel.azure-sentinel-solution-sentinelone",
                "contentSchemaVersion": "3.0.0",
                "contentId": "e171b587-22bd-46ec-b96c-7c99024847a7",
                "contentKind": "AnalyticsRule",
                "displayName": "Sentinel One - Rule deleted",
                "contentProductId": "azuresentinel.azure-sentinel-solution-sentinelone-ar-pja4fuzemn2ey",
                "id": "azuresentinel.azure-sentinel-solution-sentinelone-ar-pja4fuzemn2ey",
                "version": "1.0.0",
                "isDeprecated": false,
                "dependencies": {
                    "operator": "AND",
                    "criteria": [
                        {
                            "contentKind": "DataType",
                            "contentId": "SentinelOne"
                        },
                        {
                            "contentKind": "DataConnector",
                            "contentId": "SentinelOne"
                        }
                    ]
                }
            }
        },
        {
            "type": "Microsoft.OperationalInsights/workspaces/providers/contentTemplates",
            "apiVersion": "2023-04-01-preview",
            "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat(parameters('workspace'),'-ar-',uniquestring('84e210dd-8982-4398-b6f3-264fd72d036c')))]",
            "location": "[parameters('workspace-location')]",
            "dependsOn": [
                "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/contentPackages', 'azuresentinel.azure-sentinel-solution-sentinelone')]"
            ],
            "properties": {
                "description": "Detects when a rule was disabled.",
                "mainTemplate": {
                    "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
                    "contentVersion": "1.0.0",
                    "parameters": {},
                    "variables": {},
                    "resources": [
                        {
                            "type": "Microsoft.SecurityInsights/AlertRuleTemplates",
                            "name": "84e210dd-8982-4398-b6f3-264fd72d036c",
                            "apiVersion": "2023-02-01-preview",
                            "kind": "Scheduled",
                            "location": "[parameters('workspace-location')]",
                            "properties": {
                                "description": "Detects when a rule was disabled.",
                                "displayName": "Sentinel One - Rule disabled",
                                "enabled": false,
                                "query": "SentinelOne\n| where ActivityType == 3603\n| project EventCreationTime, DataRuleName, DataRuleQueryDetails, DataUserName\n| extend AccountCustomEntity = DataUserName\n",
                                "queryFrequency": "PT1H",
                                "queryPeriod": "PT1H",
                                "severity": "Medium",
                                "suppressionDuration": "PT1H",
                                "suppressionEnabled": false,
                                "triggerOperator": "GreaterThan",
                                "triggerThreshold": 0,
                                "status": "Available",
                                "requiredDataConnectors": [
                                    {
                                        "connectorId": "SentinelOne",
                                        "dataTypes": [
                                            "SentinelOne"
                                        ]
                                    }
                                ],
                                "tactics": [
                                    "DefenseEvasion"
                                ],
                                "techniques": [
                                    "T1070"
                                ],
                                "entityMappings": [
                                    {
                                        "fieldMappings": [
                                            {
                                                "columnName": "AccountCustomEntity",
                                                "identifier": "Name"
                                            }
                                        ],
                                        "entityType": "Account"
                                    }
                                ]
                            }
                        },
                        {
                            "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
                            "apiVersion": "2022-01-01-preview",
                            "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('AnalyticsRule-', last(split(resourceId('Microsoft.SecurityInsights/AlertRuleTemplates', '84e210dd-8982-4398-b6f3-264fd72d036c'),'/'))))]",
                            "properties": {
                                "description": "SentinelOne Analytics Rule 9",
                                "parentId": "[resourceId('Microsoft.SecurityInsights/AlertRuleTemplates', '84e210dd-8982-4398-b6f3-264fd72d036c')]",
                                "contentId": "84e210dd-8982-4398-b6f3-264fd72d036c",
                                "kind": "AnalyticsRule",
                                "version": "1.0.0",
                                "source": {
                                    "kind": "Solution",
                                    "name": "SentinelOne",
                                    "sourceId": "azuresentinel.azure-sentinel-solution-sentinelone"
                                },
                                "author": {
                                    "name": "Microsoft",
                                    "email": "support@microsoft.com"
                                },
                                "support": {
                                    "name": "Microsoft Corporation",
                                    "email": "support@microsoft.com",
                                    "tier": "Microsoft",
                                    "link": "https://support.microsoft.com"
                                }
                            }
                        }
                    ]
                },
                "packageKind": "Solution",
                "packageVersion": "3.0.6",
                "packageName": "SentinelOne",
                "packageId": "azuresentinel.azure-sentinel-solution-sentinelone",
                "contentSchemaVersion": "3.0.0",
                "contentId": "84e210dd-8982-4398-b6f3-264fd72d036c",
                "contentKind": "AnalyticsRule",
                "displayName": "Sentinel One - Rule disabled",
                "contentProductId": "azuresentinel.azure-sentinel-solution-sentinelone-ar-jskvnkvd4yfjw",
                "id": "azuresentinel.azure-sentinel-solution-sentinelone-ar-jskvnkvd4yfjw",
                "version": "1.0.0",
                "isDeprecated": false,
                "dependencies": {
                    "operator": "AND",
                    "criteria": [
                        {
                            "contentKind": "DataType",
                            "contentId": "SentinelOne"
                        },
                        {
                            "contentKind": "DataConnector",
                            "contentId": "SentinelOne"
                        }
                    ]
                }
            }
        },
        {
            "type": "Microsoft.OperationalInsights/workspaces/providers/contentTemplates",
            "apiVersion": "2023-04-01-preview",
            "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat(parameters('workspace'),'-ar-',uniquestring('5586d378-1bce-4d9b-9ac8-e7271c9d5a9a')))]",
            "location": "[parameters('workspace-location')]",
            "dependsOn": [
                "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/contentPackages', 'azuresentinel.azure-sentinel-solution-sentinelone')]"
            ],
            "properties": {
                "description": "Detects when same custom rule was triggered on different hosts.",
                "mainTemplate": {
                    "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
                    "contentVersion": "1.0.2",
                    "parameters": {},
                    "variables": {},
                    "resources": [
                        {
                            "type": "Microsoft.SecurityInsights/AlertRuleTemplates",
                            "name": "5586d378-1bce-4d9b-9ac8-e7271c9d5a9a",
                            "apiVersion": "2023-02-01-preview",
                            "kind": "Scheduled",
                            "location": "[parameters('workspace-location')]",
                            "properties": {
                                "description": "Detects when same custom rule was triggered on different hosts.",
                                "displayName": "Sentinel One - Same custom rule triggered on different hosts",
                                "enabled": false,
                                "query": "SentinelOne\n| where ActivityType == 3608\n| extend RuleName = extract(@'Custom Rule:\\s(.*?)\\sin Group', 1, EventOriginalMessage)\n| extend DstHostname = extract(@'detected on\\s(\\S+)\\.', 1, EventOriginalMessage)\n| summarize hosts = makeset(DstHostname) by RuleName, bin(TimeGenerated, 15m)\n| where array_length(hosts) > 1\n| extend HostCustomEntity = hosts\n",
                                "queryFrequency": "PT1H",
                                "queryPeriod": "PT1H",
                                "severity": "High",
                                "suppressionDuration": "PT1H",
                                "suppressionEnabled": false,
                                "triggerOperator": "GreaterThan",
                                "triggerThreshold": 0,
                                "status": "Available",
                                "requiredDataConnectors": [
                                    {
                                        "connectorId": "SentinelOne",
                                        "dataTypes": [
                                            "SentinelOne"
                                        ]
                                    }
                                ],
                                "tactics": [
                                    "InitialAccess",
                                    "LateralMovement"
                                ],
                                "techniques": [
                                    "T1190",
                                    "T1210"
                                ],
                                "entityMappings": [
                                    {
                                        "fieldMappings": [
                                            {
                                                "columnName": "HostCustomEntity",
                                                "identifier": "HostName"
                                            }
                                        ],
                                        "entityType": "Host"
                                    }
                                ]
                            }
                        },
                        {
                            "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
                            "apiVersion": "2022-01-01-preview",
                            "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('AnalyticsRule-', last(split(resourceId('Microsoft.SecurityInsights/AlertRuleTemplates', '5586d378-1bce-4d9b-9ac8-e7271c9d5a9a'),'/'))))]",
                            "properties": {
                                "description": "SentinelOne Analytics Rule 10",
                                "parentId": "[resourceId('Microsoft.SecurityInsights/AlertRuleTemplates', '5586d378-1bce-4d9b-9ac8-e7271c9d5a9a')]",
                                "contentId": "5586d378-1bce-4d9b-9ac8-e7271c9d5a9a",
                                "kind": "AnalyticsRule",
                                "version": "1.0.2",
                                "source": {
                                    "kind": "Solution",
                                    "name": "SentinelOne",
                                    "sourceId": "azuresentinel.azure-sentinel-solution-sentinelone"
                                },
                                "author": {
                                    "name": "Microsoft",
                                    "email": "support@microsoft.com"
                                },
                                "support": {
                                    "name": "Microsoft Corporation",
                                    "email": "support@microsoft.com",
                                    "tier": "Microsoft",
                                    "link": "https://support.microsoft.com"
                                }
                            }
                        }
                    ]
                },
                "packageKind": "Solution",
                "packageVersion": "3.0.6",
                "packageName": "SentinelOne",
                "packageId": "azuresentinel.azure-sentinel-solution-sentinelone",
                "contentSchemaVersion": "3.0.0",
                "contentId": "5586d378-1bce-4d9b-9ac8-e7271c9d5a9a",
                "contentKind": "AnalyticsRule",
                "displayName": "Sentinel One - Same custom rule triggered on different hosts",
                "contentProductId": "azuresentinel.azure-sentinel-solution-sentinelone-ar-qry73bbq2y5tm",
                "id": "azuresentinel.azure-sentinel-solution-sentinelone-ar-qry73bbq2y5tm",
                "version": "1.0.2",
                "isDeprecated": false,
                "dependencies": {
                    "operator": "AND",
                    "criteria": [
                        {
                            "contentKind": "DataType",
                            "contentId": "SentinelOne"
                        },
                        {
                            "contentKind": "DataConnector",
                            "contentId": "SentinelOne"
                        }
                    ]
                }
            }
        },
        {
            "type": "Microsoft.OperationalInsights/workspaces/providers/contentTemplates",
            "apiVersion": "2023-04-01-preview",
            "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat(parameters('workspace'),'-ar-',uniquestring('51999097-60f4-42c0-bee8-fa28160e5583')))]",
            "location": "[parameters('workspace-location')]",
            "dependsOn": [
                "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/contentPackages', 'azuresentinel.azure-sentinel-solution-sentinelone')]"
            ],
            "properties": {
                "description": "Detects when a user viewed agent's passphrase.",
                "mainTemplate": {
                    "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
                    "contentVersion": "1.0.0",
                    "parameters": {},
                    "variables": {},
                    "resources": [
                        {
                            "type": "Microsoft.SecurityInsights/AlertRuleTemplates",
                            "name": "51999097-60f4-42c0-bee8-fa28160e5583",
                            "apiVersion": "2023-02-01-preview",
                            "kind": "Scheduled",
                            "location": "[parameters('workspace-location')]",
                            "properties": {
                                "description": "Detects when a user viewed agent's passphrase.",
                                "displayName": "Sentinel One - User viewed agent's passphrase",
                                "enabled": false,
                                "query": "SentinelOne\n| where ActivityType == 64\n| extend AccountCustomEntity = SrcUserName, HostCustomEntity = DataComputerName\n",
                                "queryFrequency": "PT1H",
                                "queryPeriod": "PT1H",
                                "severity": "Medium",
                                "suppressionDuration": "PT1H",
                                "suppressionEnabled": false,
                                "triggerOperator": "GreaterThan",
                                "triggerThreshold": 0,
                                "status": "Available",
                                "requiredDataConnectors": [
                                    {
                                        "connectorId": "SentinelOne",
                                        "dataTypes": [
                                            "SentinelOne"
                                        ]
                                    }
                                ],
                                "tactics": [
                                    "CredentialAccess"
                                ],
                                "techniques": [
                                    "T1555"
                                ],
                                "entityMappings": [
                                    {
                                        "fieldMappings": [
                                            {
                                                "columnName": "AccountCustomEntity",
                                                "identifier": "Name"
                                            }
                                        ],
                                        "entityType": "Account"
                                    },
                                    {
                                        "fieldMappings": [
                                            {
                                                "columnName": "HostCustomEntity",
                                                "identifier": "HostName"
                                            }
                                        ],
                                        "entityType": "Host"
                                    }
                                ]
                            }
                        },
                        {
                            "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
                            "apiVersion": "2022-01-01-preview",
                            "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('AnalyticsRule-', last(split(resourceId('Microsoft.SecurityInsights/AlertRuleTemplates', '51999097-60f4-42c0-bee8-fa28160e5583'),'/'))))]",
                            "properties": {
                                "description": "SentinelOne Analytics Rule 11",
                                "parentId": "[resourceId('Microsoft.SecurityInsights/AlertRuleTemplates', '51999097-60f4-42c0-bee8-fa28160e5583')]",
                                "contentId": "51999097-60f4-42c0-bee8-fa28160e5583",
                                "kind": "AnalyticsRule",
                                "version": "1.0.0",
                                "source": {
                                    "kind": "Solution",
                                    "name": "SentinelOne",
                                    "sourceId": "azuresentinel.azure-sentinel-solution-sentinelone"
                                },
                                "author": {
                                    "name": "Microsoft",
                                    "email": "support@microsoft.com"
                                },
                                "support": {
                                    "name": "Microsoft Corporation",
                                    "email": "support@microsoft.com",
                                    "tier": "Microsoft",
                                    "link": "https://support.microsoft.com"
                                }
                            }
                        }
                    ]
                },
                "packageKind": "Solution",
                "packageVersion": "3.0.6",
                "packageName": "SentinelOne",
                "packageId": "azuresentinel.azure-sentinel-solution-sentinelone",
                "contentSchemaVersion": "3.0.0",
                "contentId": "51999097-60f4-42c0-bee8-fa28160e5583",
                "contentKind": "AnalyticsRule",
                "displayName": "Sentinel One - User viewed agent's passphrase",
                "contentProductId": "azuresentinel.azure-sentinel-solution-sentinelone-ar-3kuhcer5nlewi",
                "id": "azuresentinel.azure-sentinel-solution-sentinelone-ar-3kuhcer5nlewi",
                "version": "1.0.0",
                "isDeprecated": false,
                "dependencies": {
                    "operator": "AND",
                    "criteria": [
                        {
                            "contentKind": "DataType",
                            "contentId": "SentinelOne"
                        },
                        {
                            "contentKind": "DataConnector",
                            "contentId": "SentinelOne"
                        }
                    ]
                }
            }
        },
        {
            "type": "Microsoft.OperationalInsights/workspaces/providers/contentTemplates",
            "apiVersion": "2023-04-01-preview",
            "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat(parameters('workspace'),'-hq-',uniquestring('7fc83c11-1d80-4d1e-9d4b-4f48bbf77abe')))]",
            "location": "[parameters('workspace-location')]",
            "dependsOn": [
                "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/contentPackages', 'azuresentinel.azure-sentinel-solution-sentinelone')]"
            ],
            "properties": {
                "description": "Query shows agent which are not updated to the latest version.",
                "mainTemplate": {
                    "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
                    "contentVersion": "1.0.0",
                    "parameters": {},
                    "variables": {},
                    "resources": [
                        {
                            "type": "Microsoft.OperationalInsights/savedSearches",
                            "apiVersion": "2022-10-01",
                            "name": "SentinelOne_Hunting_Query_1",
                            "location": "[parameters('workspace-location')]",
                            "properties": {
                                "eTag": "*",
                                "displayName": "Sentinel One - Agent not updated",
                                "category": "Hunting Queries",
                                "query": "//Latest agent version can be checked in Management Console>Sentinels>Packages\nlet upd_ver = dynamic(['21.7.4.1043', '21.7.4.5853', '21.10.3.3', '21.12.1.5913']);\nSentinelOne\n| where TimeGenerated > ago(24h)\n| where EventType =~ 'Agents.'\n| where AgentVersion !in (upd_ver)\n| extend HostCustomEntity = ComputerName\n",
                                "version": 2,
                                "tags": [
                                    {
                                        "name": "description",
                                        "value": "Query shows agent which are not updated to the latest version."
                                    },
                                    {
                                        "name": "tactics",
                                        "value": "DefenseEvasion"
                                    },
                                    {
                                        "name": "techniques",
                                        "value": "T1070"
                                    }
                                ]
                            }
                        },
                        {
                            "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
                            "apiVersion": "2022-01-01-preview",
                            "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('HuntingQuery-', last(split(resourceId('Microsoft.OperationalInsights/savedSearches', '7fc83c11-1d80-4d1e-9d4b-4f48bbf77abe'),'/'))))]",
                            "properties": {
                                "description": "SentinelOne Hunting Query 1",
                                "parentId": "[resourceId('Microsoft.OperationalInsights/savedSearches', '7fc83c11-1d80-4d1e-9d4b-4f48bbf77abe')]",
                                "contentId": "7fc83c11-1d80-4d1e-9d4b-4f48bbf77abe",
                                "kind": "HuntingQuery",
                                "version": "1.0.0",
                                "source": {
                                    "kind": "Solution",
                                    "name": "SentinelOne",
                                    "sourceId": "azuresentinel.azure-sentinel-solution-sentinelone"
                                },
                                "author": {
                                    "name": "Microsoft",
                                    "email": "support@microsoft.com"
                                },
                                "support": {
                                    "name": "Microsoft Corporation",
                                    "email": "support@microsoft.com",
                                    "tier": "Microsoft",
                                    "link": "https://support.microsoft.com"
                                }
                            }
                        }
                    ]
                },
                "packageKind": "Solution",
                "packageVersion": "3.0.6",
                "packageName": "SentinelOne",
                "packageId": "azuresentinel.azure-sentinel-solution-sentinelone",
                "contentSchemaVersion": "3.0.0",
                "contentId": "7fc83c11-1d80-4d1e-9d4b-4f48bbf77abe",
                "contentKind": "HuntingQuery",
                "displayName": "Sentinel One - Agent not updated",
                "contentProductId": "azuresentinel.azure-sentinel-solution-sentinelone-hq-hx63algozznji",
                "id": "azuresentinel.azure-sentinel-solution-sentinelone-hq-hx63algozznji",
                "version": "1.0.0",
                "isDeprecated": false
            }
        },
        {
            "type": "Microsoft.OperationalInsights/workspaces/providers/contentTemplates",
            "apiVersion": "2023-04-01-preview",
            "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat(parameters('workspace'),'-hq-',uniquestring('4b2ed4b6-10bf-4b2c-b31e-ae51b575dfd4')))]",
            "location": "[parameters('workspace-location')]",
            "dependsOn": [
                "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/contentPackages', 'azuresentinel.azure-sentinel-solution-sentinelone')]"
            ],
            "properties": {
                "description": "Query shows agent properties.",
                "mainTemplate": {
                    "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
                    "contentVersion": "1.0.0",
                    "parameters": {},
                    "variables": {},
                    "resources": [
                        {
                            "type": "Microsoft.OperationalInsights/savedSearches",
                            "apiVersion": "2022-10-01",
                            "name": "SentinelOne_Hunting_Query_2",
                            "location": "[parameters('workspace-location')]",
                            "properties": {
                                "eTag": "*",
                                "displayName": "Sentinel One - Agent status",
                                "category": "Hunting Queries",
                                "query": "SentinelOne\n| where TimeGenerated > ago(24h)\n| where EventType =~ 'Agents.'\n| extend Properties = pack('IsActive', IsActive,'ActiveThreats',ActiveThreats,'FirewallEnabled',FirewallEnabled,'Infected',Infected,'IsUpToDate',IsUpToDate,'MitigationMode',MitigationMode,'MitigationModeSuspicious',MitigationModeSuspicious,'NetworkStatus',NetworkStatus)\n| summarize max(TimeGenerated) by ComputerName, tostring(Properties)\n| extend HostCustomEntity = ComputerName\n",
                                "version": 2,
                                "tags": [
                                    {
                                        "name": "description",
                                        "value": "Query shows agent properties."
                                    },
                                    {
                                        "name": "tactics",
                                        "value": "DefenseEvasion"
                                    },
                                    {
                                        "name": "techniques",
                                        "value": "T1070"
                                    }
                                ]
                            }
                        },
                        {
                            "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
                            "apiVersion": "2022-01-01-preview",
                            "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('HuntingQuery-', last(split(resourceId('Microsoft.OperationalInsights/savedSearches', '4b2ed4b6-10bf-4b2c-b31e-ae51b575dfd4'),'/'))))]",
                            "properties": {
                                "description": "SentinelOne Hunting Query 2",
                                "parentId": "[resourceId('Microsoft.OperationalInsights/savedSearches', '4b2ed4b6-10bf-4b2c-b31e-ae51b575dfd4')]",
                                "contentId": "4b2ed4b6-10bf-4b2c-b31e-ae51b575dfd4",
                                "kind": "HuntingQuery",
                                "version": "1.0.0",
                                "source": {
                                    "kind": "Solution",
                                    "name": "SentinelOne",
                                    "sourceId": "azuresentinel.azure-sentinel-solution-sentinelone"
                                },
                                "author": {
                                    "name": "Microsoft",
                                    "email": "support@microsoft.com"
                                },
                                "support": {
                                    "name": "Microsoft Corporation",
                                    "email": "support@microsoft.com",
                                    "tier": "Microsoft",
                                    "link": "https://support.microsoft.com"
                                }
                            }
                        }
                    ]
                },
                "packageKind": "Solution",
                "packageVersion": "3.0.6",
                "packageName": "SentinelOne",
                "packageId": "azuresentinel.azure-sentinel-solution-sentinelone",
                "contentSchemaVersion": "3.0.0",
                "contentId": "4b2ed4b6-10bf-4b2c-b31e-ae51b575dfd4",
                "contentKind": "HuntingQuery",
                "displayName": "Sentinel One - Agent status",
                "contentProductId": "azuresentinel.azure-sentinel-solution-sentinelone-hq-ezuz3mzxfdui6",
                "id": "azuresentinel.azure-sentinel-solution-sentinelone-hq-ezuz3mzxfdui6",
                "version": "1.0.0",
                "isDeprecated": false
            }
        },
        {
            "type": "Microsoft.OperationalInsights/workspaces/providers/contentTemplates",
            "apiVersion": "2023-04-01-preview",
            "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat(parameters('workspace'),'-hq-',uniquestring('660e92b5-1ef6-471f-b753-44a34af82c41')))]",
            "location": "[parameters('workspace-location')]",
            "dependsOn": [
                "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/contentPackages', 'azuresentinel.azure-sentinel-solution-sentinelone')]"
            ],
            "properties": {
                "description": "Query shows alert triggers (e.g. files, processes, etc.).",
                "mainTemplate": {
                    "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
                    "contentVersion": "1.0.0",
                    "parameters": {},
                    "variables": {},
                    "resources": [
                        {
                            "type": "Microsoft.OperationalInsights/savedSearches",
                            "apiVersion": "2022-10-01",
                            "name": "SentinelOne_Hunting_Query_3",
                            "location": "[parameters('workspace-location')]",
                            "properties": {
                                "eTag": "*",
                                "displayName": "Sentinel One - Alert triggers (files, processes, strings)",
                                "category": "Hunting Queries",
                                "query": "SentinelOne\n| where TimeGenerated > ago(24h)\n| where ActivityType == 3608\n| order by EventCreationTime\n| extend trigger = extract(@'Alert created for\\s+(.*?)\\sfrom Custom', 1, EventOriginalMessage)\n| extend MalwareCustomEntity = trigger\n",
                                "version": 2,
                                "tags": [
                                    {
                                        "name": "description",
                                        "value": "Query shows alert triggers (e.g. files, processes, etc.)."
                                    },
                                    {
                                        "name": "tactics",
                                        "value": "InitialAccess"
                                    },
                                    {
                                        "name": "techniques",
                                        "value": "T1204"
                                    }
                                ]
                            }
                        },
                        {
                            "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
                            "apiVersion": "2022-01-01-preview",
                            "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('HuntingQuery-', last(split(resourceId('Microsoft.OperationalInsights/savedSearches', '660e92b5-1ef6-471f-b753-44a34af82c41'),'/'))))]",
                            "properties": {
                                "description": "SentinelOne Hunting Query 3",
                                "parentId": "[resourceId('Microsoft.OperationalInsights/savedSearches', '660e92b5-1ef6-471f-b753-44a34af82c41')]",
                                "contentId": "660e92b5-1ef6-471f-b753-44a34af82c41",
                                "kind": "HuntingQuery",
                                "version": "1.0.0",
                                "source": {
                                    "kind": "Solution",
                                    "name": "SentinelOne",
                                    "sourceId": "azuresentinel.azure-sentinel-solution-sentinelone"
                                },
                                "author": {
                                    "name": "Microsoft",
                                    "email": "support@microsoft.com"
                                },
                                "support": {
                                    "name": "Microsoft Corporation",
                                    "email": "support@microsoft.com",
                                    "tier": "Microsoft",
                                    "link": "https://support.microsoft.com"
                                }
                            }
                        }
                    ]
                },
                "packageKind": "Solution",
                "packageVersion": "3.0.6",
                "packageName": "SentinelOne",
                "packageId": "azuresentinel.azure-sentinel-solution-sentinelone",
                "contentSchemaVersion": "3.0.0",
                "contentId": "660e92b5-1ef6-471f-b753-44a34af82c41",
                "contentKind": "HuntingQuery",
                "displayName": "Sentinel One - Alert triggers (files, processes, strings)",
                "contentProductId": "azuresentinel.azure-sentinel-solution-sentinelone-hq-zyx6bqeferpzy",
                "id": "azuresentinel.azure-sentinel-solution-sentinelone-hq-zyx6bqeferpzy",
                "version": "1.0.0",
                "isDeprecated": false
            }
        },
        {
            "type": "Microsoft.OperationalInsights/workspaces/providers/contentTemplates",
            "apiVersion": "2023-04-01-preview",
            "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat(parameters('workspace'),'-hq-',uniquestring('e45ff570-e8a6-4f8e-9c08-7ee92ef86060')))]",
            "location": "[parameters('workspace-location')]",
            "dependsOn": [
                "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/contentPackages', 'azuresentinel.azure-sentinel-solution-sentinelone')]"
            ],
            "properties": {
                "description": "Query searches for hosts wich were not scanned recently.",
                "mainTemplate": {
                    "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
                    "contentVersion": "1.0.0",
                    "parameters": {},
                    "variables": {},
                    "resources": [
                        {
                            "type": "Microsoft.OperationalInsights/savedSearches",
                            "apiVersion": "2022-10-01",
                            "name": "SentinelOne_Hunting_Query_4",
                            "location": "[parameters('workspace-location')]",
                            "properties": {
                                "eTag": "*",
                                "displayName": "Sentinel One - Hosts not scanned recently",
                                "category": "Hunting Queries",
                                "query": "let scanned_agents = SentinelOne\n| where TimeGenerated > ago(24h)\n| where ActivityType == 92\n| order by TimeGenerated\n| summarize makeset(DataComputerName);\nSentinelOne\n| where TimeGenerated > ago(24h)\n| where EventType =~ 'Agents.'\n| where ComputerName !in (scanned_agents)\n| extend HostCustomEntity = ComputerName\n",
                                "version": 2,
                                "tags": [
                                    {
                                        "name": "description",
                                        "value": "Query searches for hosts wich were not scanned recently."
                                    },
                                    {
                                        "name": "tactics",
                                        "value": "DefenseEvasion"
                                    },
                                    {
                                        "name": "techniques",
                                        "value": "T1070"
                                    }
                                ]
                            }
                        },
                        {
                            "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
                            "apiVersion": "2022-01-01-preview",
                            "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('HuntingQuery-', last(split(resourceId('Microsoft.OperationalInsights/savedSearches', 'e45ff570-e8a6-4f8e-9c08-7ee92ef86060'),'/'))))]",
                            "properties": {
                                "description": "SentinelOne Hunting Query 4",
                                "parentId": "[resourceId('Microsoft.OperationalInsights/savedSearches', 'e45ff570-e8a6-4f8e-9c08-7ee92ef86060')]",
                                "contentId": "e45ff570-e8a6-4f8e-9c08-7ee92ef86060",
                                "kind": "HuntingQuery",
                                "version": "1.0.0",
                                "source": {
                                    "kind": "Solution",
                                    "name": "SentinelOne",
                                    "sourceId": "azuresentinel.azure-sentinel-solution-sentinelone"
                                },
                                "author": {
                                    "name": "Microsoft",
                                    "email": "support@microsoft.com"
                                },
                                "support": {
                                    "name": "Microsoft Corporation",
                                    "email": "support@microsoft.com",
                                    "tier": "Microsoft",
                                    "link": "https://support.microsoft.com"
                                }
                            }
                        }
                    ]
                },
                "packageKind": "Solution",
                "packageVersion": "3.0.6",
                "packageName": "SentinelOne",
                "packageId": "azuresentinel.azure-sentinel-solution-sentinelone",
                "contentSchemaVersion": "3.0.0",
                "contentId": "e45ff570-e8a6-4f8e-9c08-7ee92ef86060",
                "contentKind": "HuntingQuery",
                "displayName": "Sentinel One - Hosts not scanned recently",
                "contentProductId": "azuresentinel.azure-sentinel-solution-sentinelone-hq-srrl6bxy3j262",
                "id": "azuresentinel.azure-sentinel-solution-sentinelone-hq-srrl6bxy3j262",
                "version": "1.0.0",
                "isDeprecated": false
            }
        },
        {
            "type": "Microsoft.OperationalInsights/workspaces/providers/contentTemplates",
            "apiVersion": "2023-04-01-preview",
            "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat(parameters('workspace'),'-hq-',uniquestring('9c3a38e4-0975-4f96-82ee-90ce68bec76a')))]",
            "location": "[parameters('workspace-location')]",
            "dependsOn": [
                "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/contentPackages', 'azuresentinel.azure-sentinel-solution-sentinelone')]"
            ],
            "properties": {
                "description": "Query shows new rules.",
                "mainTemplate": {
                    "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
                    "contentVersion": "1.0.0",
                    "parameters": {},
                    "variables": {},
                    "resources": [
                        {
                            "type": "Microsoft.OperationalInsights/savedSearches",
                            "apiVersion": "2022-10-01",
                            "name": "SentinelOne_Hunting_Query_5",
                            "location": "[parameters('workspace-location')]",
                            "properties": {
                                "eTag": "*",
                                "displayName": "Sentinel One - New rules",
                                "category": "Hunting Queries",
                                "query": "SentinelOne\n| where TimeGenerated > ago(24h)\n| where ActivityType == 3600\n| order by EventCreationTime\n| project EventCreationTime, DataRuleName, DataRuleQueryDetails, DataStatus, DataUserName\n| extend AccountCustomEntity = DataUserName\n",
                                "version": 2,
                                "tags": [
                                    {
                                        "name": "description",
                                        "value": "Query shows new rules."
                                    },
                                    {
                                        "name": "tactics",
                                        "value": "DefenseEvasion"
                                    },
                                    {
                                        "name": "techniques",
                                        "value": "T1562"
                                    }
                                ]
                            }
                        },
                        {
                            "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
                            "apiVersion": "2022-01-01-preview",
                            "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('HuntingQuery-', last(split(resourceId('Microsoft.OperationalInsights/savedSearches', '9c3a38e4-0975-4f96-82ee-90ce68bec76a'),'/'))))]",
                            "properties": {
                                "description": "SentinelOne Hunting Query 5",
                                "parentId": "[resourceId('Microsoft.OperationalInsights/savedSearches', '9c3a38e4-0975-4f96-82ee-90ce68bec76a')]",
                                "contentId": "9c3a38e4-0975-4f96-82ee-90ce68bec76a",
                                "kind": "HuntingQuery",
                                "version": "1.0.0",
                                "source": {
                                    "kind": "Solution",
                                    "name": "SentinelOne",
                                    "sourceId": "azuresentinel.azure-sentinel-solution-sentinelone"
                                },
                                "author": {
                                    "name": "Microsoft",
                                    "email": "support@microsoft.com"
                                },
                                "support": {
                                    "name": "Microsoft Corporation",
                                    "email": "support@microsoft.com",
                                    "tier": "Microsoft",
                                    "link": "https://support.microsoft.com"
                                }
                            }
                        }
                    ]
                },
                "packageKind": "Solution",
                "packageVersion": "3.0.6",
                "packageName": "SentinelOne",
                "packageId": "azuresentinel.azure-sentinel-solution-sentinelone",
                "contentSchemaVersion": "3.0.0",
                "contentId": "9c3a38e4-0975-4f96-82ee-90ce68bec76a",
                "contentKind": "HuntingQuery",
                "displayName": "Sentinel One - New rules",
                "contentProductId": "azuresentinel.azure-sentinel-solution-sentinelone-hq-7qr3ttiktbjmm",
                "id": "azuresentinel.azure-sentinel-solution-sentinelone-hq-7qr3ttiktbjmm",
                "version": "1.0.0",
                "isDeprecated": false
            }
        },
        {
            "type": "Microsoft.OperationalInsights/workspaces/providers/contentTemplates",
            "apiVersion": "2023-04-01-preview",
            "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat(parameters('workspace'),'-hq-',uniquestring('8d1ca735-e29a-4bea-a2ec-93162790b686')))]",
            "location": "[parameters('workspace-location')]",
            "dependsOn": [
                "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/contentPackages', 'azuresentinel.azure-sentinel-solution-sentinelone')]"
            ],
            "properties": {
                "description": "Query shows deleted rules.",
                "mainTemplate": {
                    "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
                    "contentVersion": "1.0.0",
                    "parameters": {},
                    "variables": {},
                    "resources": [
                        {
                            "type": "Microsoft.OperationalInsights/savedSearches",
                            "apiVersion": "2022-10-01",
                            "name": "SentinelOne_Hunting_Query_6",
                            "location": "[parameters('workspace-location')]",
                            "properties": {
                                "eTag": "*",
                                "displayName": "Sentinel One - Deleted rules",
                                "category": "Hunting Queries",
                                "query": "SentinelOne\n| where TimeGenerated > ago(24h)\n| where ActivityType == 3602\n| order by EventCreationTime\n| project EventCreationTime, DataRuleName, DataRuleQueryDetails, DataStatus, DataUserName\n| extend AccountCustomEntity = DataUserName\n",
                                "version": 2,
                                "tags": [
                                    {
                                        "name": "description",
                                        "value": "Query shows deleted rules."
                                    },
                                    {
                                        "name": "tactics",
                                        "value": "DefenseEvasion"
                                    },
                                    {
                                        "name": "techniques",
                                        "value": "T1070"
                                    }
                                ]
                            }
                        },
                        {
                            "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
                            "apiVersion": "2022-01-01-preview",
                            "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('HuntingQuery-', last(split(resourceId('Microsoft.OperationalInsights/savedSearches', '8d1ca735-e29a-4bea-a2ec-93162790b686'),'/'))))]",
                            "properties": {
                                "description": "SentinelOne Hunting Query 6",
                                "parentId": "[resourceId('Microsoft.OperationalInsights/savedSearches', '8d1ca735-e29a-4bea-a2ec-93162790b686')]",
                                "contentId": "8d1ca735-e29a-4bea-a2ec-93162790b686",
                                "kind": "HuntingQuery",
                                "version": "1.0.0",
                                "source": {
                                    "kind": "Solution",
                                    "name": "SentinelOne",
                                    "sourceId": "azuresentinel.azure-sentinel-solution-sentinelone"
                                },
                                "author": {
                                    "name": "Microsoft",
                                    "email": "support@microsoft.com"
                                },
                                "support": {
                                    "name": "Microsoft Corporation",
                                    "email": "support@microsoft.com",
                                    "tier": "Microsoft",
                                    "link": "https://support.microsoft.com"
                                }
                            }
                        }
                    ]
                },
                "packageKind": "Solution",
                "packageVersion": "3.0.6",
                "packageName": "SentinelOne",
                "packageId": "azuresentinel.azure-sentinel-solution-sentinelone",
                "contentSchemaVersion": "3.0.0",
                "contentId": "8d1ca735-e29a-4bea-a2ec-93162790b686",
                "contentKind": "HuntingQuery",
                "displayName": "Sentinel One - Deleted rules",
                "contentProductId": "azuresentinel.azure-sentinel-solution-sentinelone-hq-g64irfpgjtp42",
                "id": "azuresentinel.azure-sentinel-solution-sentinelone-hq-g64irfpgjtp42",
                "version": "1.0.0",
                "isDeprecated": false
            }
        },
        {
            "type": "Microsoft.OperationalInsights/workspaces/providers/contentTemplates",
            "apiVersion": "2023-04-01-preview",
            "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat(parameters('workspace'),'-hq-',uniquestring('17c77743-8bdb-4d29-a3cb-a7a08676122f')))]",
            "location": "[parameters('workspace-location')]",
            "dependsOn": [
                "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/contentPackages', 'azuresentinel.azure-sentinel-solution-sentinelone')]"
            ],
            "properties": {
                "description": "Query searches for hosts with completed full scan.",
                "mainTemplate": {
                    "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
                    "contentVersion": "1.0.0",
                    "parameters": {},
                    "variables": {},
                    "resources": [
                        {
                            "type": "Microsoft.OperationalInsights/savedSearches",
                            "apiVersion": "2022-10-01",
                            "name": "SentinelOne_Hunting_Query_7",
                            "location": "[parameters('workspace-location')]",
                            "properties": {
                                "eTag": "*",
                                "displayName": "Sentinel One - Scanned hosts",
                                "category": "Hunting Queries",
                                "query": "SentinelOne\n| where TimeGenerated > ago(24h)\n| where ActivityType == 92\n| order by TimeGenerated\n| project EventCreationTime, DataComputerName\n| extend HostCustomEntity = DataComputerName\n",
                                "version": 2,
                                "tags": [
                                    {
                                        "name": "description",
                                        "value": "Query searches for hosts with completed full scan."
                                    },
                                    {
                                        "name": "tactics",
                                        "value": "DefenseEvasion"
                                    },
                                    {
                                        "name": "techniques",
                                        "value": "T1070"
                                    }
                                ]
                            }
                        },
                        {
                            "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
                            "apiVersion": "2022-01-01-preview",
                            "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('HuntingQuery-', last(split(resourceId('Microsoft.OperationalInsights/savedSearches', '17c77743-8bdb-4d29-a3cb-a7a08676122f'),'/'))))]",
                            "properties": {
                                "description": "SentinelOne Hunting Query 7",
                                "parentId": "[resourceId('Microsoft.OperationalInsights/savedSearches', '17c77743-8bdb-4d29-a3cb-a7a08676122f')]",
                                "contentId": "17c77743-8bdb-4d29-a3cb-a7a08676122f",
                                "kind": "HuntingQuery",
                                "version": "1.0.0",
                                "source": {
                                    "kind": "Solution",
                                    "name": "SentinelOne",
                                    "sourceId": "azuresentinel.azure-sentinel-solution-sentinelone"
                                },
                                "author": {
                                    "name": "Microsoft",
                                    "email": "support@microsoft.com"
                                },
                                "support": {
                                    "name": "Microsoft Corporation",
                                    "email": "support@microsoft.com",
                                    "tier": "Microsoft",
                                    "link": "https://support.microsoft.com"
                                }
                            }
                        }
                    ]
                },
                "packageKind": "Solution",
                "packageVersion": "3.0.6",
                "packageName": "SentinelOne",
                "packageId": "azuresentinel.azure-sentinel-solution-sentinelone",
                "contentSchemaVersion": "3.0.0",
                "contentId": "17c77743-8bdb-4d29-a3cb-a7a08676122f",
                "contentKind": "HuntingQuery",
                "displayName": "Sentinel One - Scanned hosts",
                "contentProductId": "azuresentinel.azure-sentinel-solution-sentinelone-hq-ngnc32i53j43u",
                "id": "azuresentinel.azure-sentinel-solution-sentinelone-hq-ngnc32i53j43u",
                "version": "1.0.0",
                "isDeprecated": false
            }
        },
        {
            "type": "Microsoft.OperationalInsights/workspaces/providers/contentTemplates",
            "apiVersion": "2023-04-01-preview",
            "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat(parameters('workspace'),'-hq-',uniquestring('acd0a127-461e-48c8-96fa-27d14595abe0')))]",
            "location": "[parameters('workspace-location')]",
            "dependsOn": [
                "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/contentPackages', 'azuresentinel.azure-sentinel-solution-sentinelone')]"
            ],
            "properties": {
                "description": "Query shows sources (hosts) by alert count.",
                "mainTemplate": {
                    "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
                    "contentVersion": "1.0.0",
                    "parameters": {},
                    "variables": {},
                    "resources": [
                        {
                            "type": "Microsoft.OperationalInsights/savedSearches",
                            "apiVersion": "2022-10-01",
                            "name": "SentinelOne_Hunting_Query_8",
                            "location": "[parameters('workspace-location')]",
                            "properties": {
                                "eTag": "*",
                                "displayName": "Sentinel One - Sources by alert count",
                                "category": "Hunting Queries",
                                "query": "SentinelOne\n| where TimeGenerated > ago(24h)\n| where ActivityType == 3608\n| extend DstHostname = extract(@'detected on\\s(\\S+)\\.', 1, EventOriginalMessage)\n| summarize count() by DstHostname\n| extend HostCustomEntity = DstHostname\n",
                                "version": 2,
                                "tags": [
                                    {
                                        "name": "description",
                                        "value": "Query shows sources (hosts) by alert count."
                                    },
                                    {
                                        "name": "tactics",
                                        "value": "InitialAccess"
                                    },
                                    {
                                        "name": "techniques",
                                        "value": "T1204"
                                    }
                                ]
                            }
                        },
                        {
                            "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
                            "apiVersion": "2022-01-01-preview",
                            "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('HuntingQuery-', last(split(resourceId('Microsoft.OperationalInsights/savedSearches', 'acd0a127-461e-48c8-96fa-27d14595abe0'),'/'))))]",
                            "properties": {
                                "description": "SentinelOne Hunting Query 8",
                                "parentId": "[resourceId('Microsoft.OperationalInsights/savedSearches', 'acd0a127-461e-48c8-96fa-27d14595abe0')]",
                                "contentId": "acd0a127-461e-48c8-96fa-27d14595abe0",
                                "kind": "HuntingQuery",
                                "version": "1.0.0",
                                "source": {
                                    "kind": "Solution",
                                    "name": "SentinelOne",
                                    "sourceId": "azuresentinel.azure-sentinel-solution-sentinelone"
                                },
                                "author": {
                                    "name": "Microsoft",
                                    "email": "support@microsoft.com"
                                },
                                "support": {
                                    "name": "Microsoft Corporation",
                                    "email": "support@microsoft.com",
                                    "tier": "Microsoft",
                                    "link": "https://support.microsoft.com"
                                }
                            }
                        }
                    ]
                },
                "packageKind": "Solution",
                "packageVersion": "3.0.6",
                "packageName": "SentinelOne",
                "packageId": "azuresentinel.azure-sentinel-solution-sentinelone",
                "contentSchemaVersion": "3.0.0",
                "contentId": "acd0a127-461e-48c8-96fa-27d14595abe0",
                "contentKind": "HuntingQuery",
                "displayName": "Sentinel One - Sources by alert count",
                "contentProductId": "azuresentinel.azure-sentinel-solution-sentinelone-hq-kgffpcs75qcxu",
                "id": "azuresentinel.azure-sentinel-solution-sentinelone-hq-kgffpcs75qcxu",
                "version": "1.0.0",
                "isDeprecated": false
            }
        },
        {
            "type": "Microsoft.OperationalInsights/workspaces/providers/contentTemplates",
            "apiVersion": "2023-04-01-preview",
            "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat(parameters('workspace'),'-hq-',uniquestring('f3a7cedd-6fc3-4661-a0ad-c1738e531917')))]",
            "location": "[parameters('workspace-location')]",
            "dependsOn": [
                "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/contentPackages', 'azuresentinel.azure-sentinel-solution-sentinelone')]"
            ],
            "properties": {
                "description": "Query shows uninstalled agents.",
                "mainTemplate": {
                    "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
                    "contentVersion": "1.0.0",
                    "parameters": {},
                    "variables": {},
                    "resources": [
                        {
                            "type": "Microsoft.OperationalInsights/savedSearches",
                            "apiVersion": "2022-10-01",
                            "name": "SentinelOne_Hunting_Query_9",
                            "location": "[parameters('workspace-location')]",
                            "properties": {
                                "eTag": "*",
                                "displayName": "Sentinel One - Uninstalled agents",
                                "category": "Hunting Queries",
                                "query": "SentinelOne\n| where TimeGenerated > ago(24h)\n| where ActivityType == 31\n| extend HostCustomEntity = DataComputerName\n",
                                "version": 2,
                                "tags": [
                                    {
                                        "name": "description",
                                        "value": "Query shows uninstalled agents."
                                    },
                                    {
                                        "name": "tactics",
                                        "value": "DefenseEvasion"
                                    },
                                    {
                                        "name": "techniques",
                                        "value": "T1070"
                                    }
                                ]
                            }
                        },
                        {
                            "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
                            "apiVersion": "2022-01-01-preview",
                            "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('HuntingQuery-', last(split(resourceId('Microsoft.OperationalInsights/savedSearches', 'f3a7cedd-6fc3-4661-a0ad-c1738e531917'),'/'))))]",
                            "properties": {
                                "description": "SentinelOne Hunting Query 9",
                                "parentId": "[resourceId('Microsoft.OperationalInsights/savedSearches', 'f3a7cedd-6fc3-4661-a0ad-c1738e531917')]",
                                "contentId": "f3a7cedd-6fc3-4661-a0ad-c1738e531917",
                                "kind": "HuntingQuery",
                                "version": "1.0.0",
                                "source": {
                                    "kind": "Solution",
                                    "name": "SentinelOne",
                                    "sourceId": "azuresentinel.azure-sentinel-solution-sentinelone"
                                },
                                "author": {
                                    "name": "Microsoft",
                                    "email": "support@microsoft.com"
                                },
                                "support": {
                                    "name": "Microsoft Corporation",
                                    "email": "support@microsoft.com",
                                    "tier": "Microsoft",
                                    "link": "https://support.microsoft.com"
                                }
                            }
                        }
                    ]
                },
                "packageKind": "Solution",
                "packageVersion": "3.0.6",
                "packageName": "SentinelOne",
                "packageId": "azuresentinel.azure-sentinel-solution-sentinelone",
                "contentSchemaVersion": "3.0.0",
                "contentId": "f3a7cedd-6fc3-4661-a0ad-c1738e531917",
                "contentKind": "HuntingQuery",
                "displayName": "Sentinel One - Uninstalled agents",
                "contentProductId": "azuresentinel.azure-sentinel-solution-sentinelone-hq-eziopqnnvqh46",
                "id": "azuresentinel.azure-sentinel-solution-sentinelone-hq-eziopqnnvqh46",
                "version": "1.0.0",
                "isDeprecated": false
            }
        },
        {
            "type": "Microsoft.OperationalInsights/workspaces/providers/contentTemplates",
            "apiVersion": "2023-04-01-preview",
            "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat(parameters('workspace'),'-hq-',uniquestring('56500e23-4e64-45a5-a444-98a1acb2f700')))]",
            "location": "[parameters('workspace-location')]",
            "dependsOn": [
                "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/contentPackages', 'azuresentinel.azure-sentinel-solution-sentinelone')]"
            ],
            "properties": {
                "description": "Query shows users by alert count.",
                "mainTemplate": {
                    "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
                    "contentVersion": "1.0.0",
                    "parameters": {},
                    "variables": {},
                    "resources": [
                        {
                            "type": "Microsoft.OperationalInsights/savedSearches",
                            "apiVersion": "2022-10-01",
                            "name": "SentinelOne_Hunting_Query_10",
                            "location": "[parameters('workspace-location')]",
                            "properties": {
                                "eTag": "*",
                                "displayName": "Sentinel One - Users by alert count",
                                "category": "Hunting Queries",
                                "query": "SentinelOne\n| where TimeGenerated > ago(24h)\n| where ActivityType == 3608\n| extend DstHostname = extract(@'detected on\\s(\\S+)\\.', 1, EventOriginalMessage)\n| join (SentinelOne \n      | where EventType =~ 'Agents.'\n      | where isnotempty(LastLoggedInUserName)\n      | project DstHostname=ComputerName, LastLoggedInUserName) on DstHostname\n| summarize count() by LastLoggedInUserName\n| extend AccountCustomEntity = LastLoggedInUserName\n",
                                "version": 2,
                                "tags": [
                                    {
                                        "name": "description",
                                        "value": "Query shows users by alert count."
                                    },
                                    {
                                        "name": "tactics",
                                        "value": "InitialAccess"
                                    },
                                    {
                                        "name": "techniques",
                                        "value": "T1204"
                                    }
                                ]
                            }
                        },
                        {
                            "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
                            "apiVersion": "2022-01-01-preview",
                            "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('HuntingQuery-', last(split(resourceId('Microsoft.OperationalInsights/savedSearches', '56500e23-4e64-45a5-a444-98a1acb2f700'),'/'))))]",
                            "properties": {
                                "description": "SentinelOne Hunting Query 10",
                                "parentId": "[resourceId('Microsoft.OperationalInsights/savedSearches', '56500e23-4e64-45a5-a444-98a1acb2f700')]",
                                "contentId": "56500e23-4e64-45a5-a444-98a1acb2f700",
                                "kind": "HuntingQuery",
                                "version": "1.0.0",
                                "source": {
                                    "kind": "Solution",
                                    "name": "SentinelOne",
                                    "sourceId": "azuresentinel.azure-sentinel-solution-sentinelone"
                                },
                                "author": {
                                    "name": "Microsoft",
                                    "email": "support@microsoft.com"
                                },
                                "support": {
                                    "name": "Microsoft Corporation",
                                    "email": "support@microsoft.com",
                                    "tier": "Microsoft",
                                    "link": "https://support.microsoft.com"
                                }
                            }
                        }
                    ]
                },
                "packageKind": "Solution",
                "packageVersion": "3.0.6",
                "packageName": "SentinelOne",
                "packageId": "azuresentinel.azure-sentinel-solution-sentinelone",
                "contentSchemaVersion": "3.0.0",
                "contentId": "56500e23-4e64-45a5-a444-98a1acb2f700",
                "contentKind": "HuntingQuery",
                "displayName": "Sentinel One - Users by alert count",
                "contentProductId": "azuresentinel.azure-sentinel-solution-sentinelone-hq-3qjxvgam2xp56",
                "id": "azuresentinel.azure-sentinel-solution-sentinelone-hq-3qjxvgam2xp56",
                "version": "1.0.0",
                "isDeprecated": false
            }
        },
        {
            "type": "Microsoft.OperationalInsights/workspaces/providers/contentPackages",
            "apiVersion": "2023-04-01-preview",
            "location": "[parameters('workspace-location')]",
            "properties": {
                "version": "3.0.6",
                "kind": "Solution",
                "contentSchemaVersion": "3.0.0",
                "displayName": "SentinelOne",
                "publisherDisplayName": "Microsoft Sentinel, Microsoft Corporation",
                "descriptionHtml": "<p><b>Note:</b> Please refer to the following before installing the solution:</p><p>\u2022 Review the solution <a target=\"_blank href=\">Release Notes</a></p><p>The <a target=\"_blank\" href=\"https://www.sentinelone.com/\" rel=\"noopener\">SentinelOne</a> solution provides ability to bring SentinelOne events to your Microsoft Sentinel Workspace to inform and to examine potential security risks, analyze your team's use of collaboration, diagnose configuration problems and more.</p><p><b>Underlying Microsoft Technologies used:</b></p><p>This solution takes a dependency on the following technologies, and some of these dependencies either may be in <a target=\"_blank\" href=\"https://azure.microsoft.com/support/legal/preview-supplemental-terms/\" rel=\"noopener\">Preview</a> state or might result in additional ingestion or operational costs:</p><p>a. <a target=\"_blank\" href=\"https://docs.microsoft.com/azure/azure-monitor/logs/data-collector-api?WT.mc_id=Portal-fx\" rel=\"noopener\">Azure Monitor HTTP Data Collector API</a></p><p>b. <a target=\"_blank\" href=\"https://azure.microsoft.com/services/functions/#overview\" rel=\"noopener\">Azure Functions</a></p><p><b>Data Connectors:</b> 1, <b>Parsers:</b> 1, <b>Workbooks:</b> 1, <b>Analytic Rules:</b> 11, <b>Hunting Queries:</b> 10</p><p><a target=\"_blank\" href=\"https://aka.ms/azuresentinel\" rel=\"noopener\">Learn more about Microsoft Sentinel</a> | <a target=\"_blank\" href=\"https://aka.ms/azuresentinelsolutionsdoc\" rel=\"noopener\">Learn more about Solutions</a></p>",
                "contentKind": "Solution",
                "contentProductId": "azuresentinel.azure-sentinel-solution-sentinelone-sl-i65e75jmihqn6",
                "id": "azuresentinel.azure-sentinel-solution-sentinelone-sl-i65e75jmihqn6",
                "icon": "https://store-images.s-microsoft.com/image/apps.64133.de7b62cd-dc4b-44e8-ba88-e15abade5b01.d5ef45e2-268d-4824-92bc-96afd798aac3.7cf9eadc-d371-4415-a897-1abee4fee9c9",
                "contentId": "azuresentinel.azure-sentinel-solution-sentinelone",
                "parentId": "azuresentinel.azure-sentinel-solution-sentinelone",
                "source": {
                    "kind": "Solution",
                    "name": "SentinelOne",
                    "sourceId": "azuresentinel.azure-sentinel-solution-sentinelone"
                },
                "author": {
                    "name": "Microsoft",
                    "email": "support@microsoft.com"
                },
                "support": {
                    "name": "Microsoft Corporation",
                    "email": "support@microsoft.com",
                    "tier": "Microsoft",
                    "link": "https://support.microsoft.com"
                },
                "dependencies": {
                    "operator": "AND",
                    "criteria": [
                        {
                            "kind": "DataConnector",
                            "contentId": "SentinelOneCCPConnections",
                            "version": "1.0.0"
                        },
                        {
                            "kind": "DataConnector",
                            "contentId": "SentinelOne",
                            "version": "1.0.0"
                        },
                        {
                            "kind": "Workbook",
                            "contentId": "SentinelOneWorkbook",
                            "version": "1.0.0"
                        },
                        {
                            "kind": "Parser",
                            "contentId": "SentinelOne-Parser",
                            "version": "1.0.1"
                        },
                        {
                            "kind": "AnalyticsRule",
                            "contentId": "382f37b3-b49a-492f-b436-a4717c8c5c3e",
                            "version": "1.0.1"
                        },
                        {
                            "kind": "AnalyticsRule",
                            "contentId": "4ad87e4a-d045-4c6b-9652-c9de27fcb442",
                            "version": "1.0.2"
                        },
                        {
                            "kind": "AnalyticsRule",
                            "contentId": "5f37de91-ff2b-45fb-9eda-49e9f76a3942",
                            "version": "1.0.2"
                        },
                        {
                            "kind": "AnalyticsRule",
                            "contentId": "de339761-2298-4b37-8f1b-80ebd4f0b5f6",
                            "version": "1.0.0"
                        },
                        {
                            "kind": "AnalyticsRule",
                            "contentId": "4224409f-a7bf-45eb-a931-922d79575a05",
                            "version": "1.0.0"
                        },
                        {
                            "kind": "AnalyticsRule",
                            "contentId": "47e427e6-61bc-4e24-8d16-a12871b9f939",
                            "version": "1.0.2"
                        },
                        {
                            "kind": "AnalyticsRule",
                            "contentId": "e73d293d-966c-47ec-b8e0-95255755f12c",
                            "version": "1.0.0"
                        },
                        {
                            "kind": "AnalyticsRule",
                            "contentId": "e171b587-22bd-46ec-b96c-7c99024847a7",
                            "version": "1.0.0"
                        },
                        {
                            "kind": "AnalyticsRule",
                            "contentId": "84e210dd-8982-4398-b6f3-264fd72d036c",
                            "version": "1.0.0"
                        },
                        {
                            "kind": "AnalyticsRule",
                            "contentId": "5586d378-1bce-4d9b-9ac8-e7271c9d5a9a",
                            "version": "1.0.2"
                        },
                        {
                            "kind": "AnalyticsRule",
                            "contentId": "51999097-60f4-42c0-bee8-fa28160e5583",
                            "version": "1.0.0"
                        },
                        {
                            "kind": "HuntingQuery",
                            "contentId": "7fc83c11-1d80-4d1e-9d4b-4f48bbf77abe",
                            "version": "1.0.0"
                        },
                        {
                            "kind": "HuntingQuery",
                            "contentId": "4b2ed4b6-10bf-4b2c-b31e-ae51b575dfd4",
                            "version": "1.0.0"
                        },
                        {
                            "kind": "HuntingQuery",
                            "contentId": "660e92b5-1ef6-471f-b753-44a34af82c41",
                            "version": "1.0.0"
                        },
                        {
                            "kind": "HuntingQuery",
                            "contentId": "e45ff570-e8a6-4f8e-9c08-7ee92ef86060",
                            "version": "1.0.0"
                        },
                        {
                            "kind": "HuntingQuery",
                            "contentId": "9c3a38e4-0975-4f96-82ee-90ce68bec76a",
                            "version": "1.0.0"
                        },
                        {
                            "kind": "HuntingQuery",
                            "contentId": "8d1ca735-e29a-4bea-a2ec-93162790b686",
                            "version": "1.0.0"
                        },
                        {
                            "kind": "HuntingQuery",
                            "contentId": "17c77743-8bdb-4d29-a3cb-a7a08676122f",
                            "version": "1.0.0"
                        },
                        {
                            "kind": "HuntingQuery",
                            "contentId": "acd0a127-461e-48c8-96fa-27d14595abe0",
                            "version": "1.0.0"
                        },
                        {
                            "kind": "HuntingQuery",
                            "contentId": "f3a7cedd-6fc3-4661-a0ad-c1738e531917",
                            "version": "1.0.0"
                        },
                        {
                            "kind": "HuntingQuery",
                            "contentId": "56500e23-4e64-45a5-a444-98a1acb2f700",
                            "version": "1.0.0"
                        }
                    ]
                },
                "firstPublishDate": "2024-11-26",
                "providers": [
                    "SentinelOne"
                ],
                "categories": {
                    "domains": [
                        "Security - Threat Protection"
                    ]
                },
                "isPreview": false,
                "isDeprecated": false,
                "migratedToPackageId": null
            },
            "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/', 'azuresentinel.azure-sentinel-solution-sentinelone')]"
        }
    ],
    "variables": {}
}
