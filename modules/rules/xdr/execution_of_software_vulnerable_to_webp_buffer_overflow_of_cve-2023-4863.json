{
    "kind": "Scheduled",
    "properties": {
        "description": "This query looks at device, process, and network events from Defender for Endpoint that may be vulnerable to buffer overflow defined in CVE-2023-4863. Results are not an indicator of malicious activity.",
        "displayName": "Execution of software vulnerable to webp buffer overflow of CVE-2023-4863",
        "enabled": true,
        "query": "//CVE-2023-4863 Process activity with .webp files on devices where CVE-2023-4863 is unpatched\n//This query shows all process activity with .webp files on vulnerable machines and is not an indicator of malicious activity\nlet VulnDevices = DeviceTvmSoftwareVulnerabilities\n    | where CveId == \"CVE-2023-4863\"\n    | distinct DeviceId;\nunion DeviceProcessEvents, DeviceNetworkEvents, DeviceEvents\n| where DeviceId in (VulnDevices) and InitiatingProcessCommandLine has(\".webp\") or ProcessCommandLine has(\".webp\")",
        "queryFrequency": "PT1H",
        "queryPeriod": "PT1H",
        "severity": "Informational",
        "suppressionDuration": "PT1H",
        "suppressionEnabled": false,
        "triggerOperator": "GreaterThan",
        "triggerThreshold": 0,
        "tactics": [
            "Execution"
        ],
        "techniques": [
            "T1203"
        ],
        "entityMappings": [
            {
                "fieldMappings": [
                    {
                        "columnName": "DeviceName",
                        "identifier": "HostName"
                    }
                ],
                "entityType": "Host"
            },
            {
                "fieldMappings": [
                    {
                        "columnName": "AccountName",
                        "identifier": "FullName"
                    }
                ],
                "entityType": "Account"
            },
            {
                "fieldMappings": [
                    {
                        "columnName": "ProcessId",
                        "identifier": "ProcessId"
                    }
                ],
                "entityType": "Process"
            },
            {
                "fieldMappings": [
                    {
                        "columnName": "InitiatingProcessId",
                        "identifier": "ProcessId"
                    }
                ],
                "entityType": "Process"
            },
            {
                "fieldMappings": [
                    {
                        "columnName": "ProcessCommandLine",
                        "identifier": "CommandLine"
                    }
                ],
                "entityType": "Process"
            }
        ],
        "eventGroupingSettings": {
            "aggregationKind": "SingleAlert"
        },
        "alertDetailsOverride": {
            "alertDynamicProperties": [],
            "alertDisplayNameFormat": "Possible exploitation of CVE-2023-4863"
        },
        "incidentConfiguration": {
            "createIncident": false,
            "groupingConfiguration": {
                "reopenClosedIncident": false,
                "lookbackDuration": "PT5H",
                "enabled": false,
                "groupByEntities": [
                    "Account"
                ],
                "matchingMethod": "Selected"
            }
        },
        "alertRuleTemplateName": "26e81021-2de6-4442-a74a-a77885e96911",
        "templateVersion": "1.0.0"
    }
}
